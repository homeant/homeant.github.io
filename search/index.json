[{"content":"moviepilot åˆ·æµæ•™ç¨‹ å‡†å¤‡å·¥ä½œ å‡†å¤‡è®¤è¯åˆä½œtoken æ‰“å¼€çˆ±è¯­é£é£è·å–token å®‰è£… moviepilot ç¼–å†™ docker compose æ–‡ä»¶ æ–°å»ºdocker-compose.ymlæ–‡ä»¶\n1 vi docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 services: moviepilot: stdin_open: true tty: true container_name: moviepilot-v2 hostname: moviepilot-v2 networks: - trim-default ports: - 3000:3000 # æ˜ å°„çš„ç«¯å£ volumes: - æŒ‚è½½çš„æ–‡ä»¶ç›®å½•:/media environment: - NGINX_PORT=3000 - PORT=3001 - PUID=0 - PGID=0 - UMASK=000 - TZ=Asia/Shanghai - AUTH_SITE=iyuu - IYUU_SIGN=iyuuå¾®ä¿¡æ‰«ç åï¼Œå…¬æ€»å·å›å¤ä½ çš„token - SUPERUSER=admin - API_TOKEN=åç»­è°ƒç”¨mpçš„api_tokenï¼Œ16ä½ä»¥ä¸Š restart: always image: jxxghp/moviepilot-v2:latest # mpçš„é•œåƒ networks: trim-default: external: true å¯åŠ¨ mp 1 docker compose -f docker-compose.yml up -d æŸ¥çœ‹ mp ç™»å½•å¯†ç  1 docker logs moviepilot-v2 | grep \u0026#39;å¯†ç \u0026#39; 1 INFO: 294b007932ef_2_0_0.py - ã€è¶…çº§ç®¡ç†å‘˜åˆå§‹å¯†ç ã€‘lthJL2ATiVNTQPVCuj31lg è¯·ç™»å½•ç³»ç»Ÿååœ¨è®¾å®šä¸­ä¿®æ”¹ã€‚ æ³¨ï¼šè¯¥å¯†ç åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·æ³¨æ„ä¿å­˜ã€‚ æ£€æŸ¥ IYUU æ˜¯å¦è®¤è¯æˆåŠŸ 1 docker logs moviepilot-v2 | grep \u0026#39;iyuu ç”¨æˆ·\u0026#39; 1 INFO: modules_initializer.py - iyuu ç”¨æˆ·è®¤è¯æˆåŠŸï¼ é…ç½® mp æµè§ˆå™¨æ‰“å¼€ï¼Œå¹¶è¾“å…¥mpè®¿é—®åœ°å€è¿›è¡Œç™»å½•\né…ç½®ç«™ç‚¹ æ‰“å¼€å·¦ä¾§èœå•ç«™ç‚¹ç®¡ç†\u0026gt; å³ä¸‹è§’+ è¿›è¡Œç«™ç‚¹é…ç½® æ³¨æ„ï¼š\né¦’å¤´ç«™ç‚¹éœ€è¦é€‰æ‹©APIé…ç½®æ–¹å¼ å…¶ä»–ç«™ç‚¹é€‰æ‹©COOKIEé…ç½®æ–¹å¼ï¼Œæ¯”å¦‚å†°æ¿€å‡Œã€é˜¿ç«¥æœ¨ã€æ˜æ•™ç­‰ è·å– Authorization 1ã€ç™»å½•é¦’å¤´ç«™ç‚¹ï¼Œåœ¨æµè§ˆå™¨ä¸­æŒ‰F12é”®ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·\n2ã€åˆ·æ–°é¡µé¢ï¼Œç‚¹å‡»å¼€å‘è€…å·¥å…·ä¸­çš„ç½‘ç»œ(network)\u0026gt;è¿‡æ»¤æ¡ä»¶é€‰æ‹©Feteh/XHR\u0026gt;é€‰æ‹©ä¸‹é¢ä»»æ„ä¸€ä¸ªè¯·æ±‚å¹¶ç‚¹å‡»\n3ã€åœ¨è¯·æ±‚å¤´ä¸­æ‰¾åˆ°Authorizationï¼Œå¤åˆ¶Authorizationçš„å€¼\nè·å– API_EKY 1ã€ç™»å½•é¦’å¤´ç«™ç‚¹\n2ã€ä¾æ¬¡ç‚¹å‡»å¯¼èˆªæ§åˆ¶å°\u0026gt;å®éªŒå®¤\n3ã€åœ¨å®éªŒå®¤é¡µé¢ä¸­æ‰¾åˆ°å­˜å–ä»¤ç‰Œï¼Œå¦‚æœæ²¡æœ‰ç‚¹å‡»å»ºç«‹å­˜å–ä»¤ç‰Œï¼Œç„¶åå¤åˆ¶\nè·å– Cookie 1ã€ç™»å½•å…¶ä»–ç«™ç‚¹ï¼Œæ¯”å¦‚å†°æ¿€å‡Œã€é˜¿ç«¥æœ¨ã€æ˜æ•™ç­‰\n2ã€åœ¨æµè§ˆå™¨ä¸­æŒ‰F12é”®ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·\n3ã€åˆ·æ–°é¡µé¢ï¼Œç‚¹å‡»å¼€å‘è€…å·¥å…·ä¸­çš„ç½‘ç»œ(network)\u0026gt;è¿‡æ»¤æ¡ä»¶é€‰æ‹©å…¨éƒ¨\u0026gt;é€‰æ‹©ä¸‹é¢ä»»æ„ä¸€ä¸ªè¯·æ±‚å¹¶ç‚¹å‡»\n4ã€åœ¨è¯·æ±‚å¤´ä¸­æ‰¾åˆ°Cookieï¼Œå¤åˆ¶Cookieçš„å€¼\né…ç½®å®Œæˆåç‚¹å‡»ä¿å­˜\né…ç½®ä¸‹è½½å™¨ 1ã€ç‚¹å‡»å·¦ä¾§å¯¼èˆªè®¾å®šï¼Œä¸‹æ‹‰é¡µé¢æ‰¾åˆ°ä¸‹è½½\n2ã€ç‚¹å‡»ä¸‹è½½å™¨æ¨¡å—ä¸­çš„+æ·»åŠ å¯¹åº”çš„ä¸‹è½½å™¨ï¼Œæ²¡æœ‰çš„éœ€è¦æå‰å®‰è£…\n3ã€æ·»åŠ ä½ ä¸‹è½½å™¨çš„åœ°å€ã€åœ°å€ã€ç”¨æˆ·ååŠå¯†ç \n4ã€ç‚¹å‡»ä¿å­˜\né…ç½®åˆ·æµå·¥å…· 1ã€ä¾æ¬¡ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ’ä»¶\u0026gt;æ’ä»¶å¸‚åœº\n2ã€ç‚¹å‡»ç«™ç‚¹åˆ·æµï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®‰è£…è¯¥æ’ä»¶ï¼Œç­‰å¾…å®‰è£…å®Œæˆ\n3ã€ç‚¹å‡»å¤´éƒ¨å¯¼èˆªæˆ‘çš„æ’ä»¶ï¼Œç‚¹å‡»ç«™ç‚¹åˆ·æµå³ä¸‹è§’çš„...\u0026gt;é…ç½®\n4ã€åœ¨é…ç½®é¡µé¢ä¸­é€‰æ‹©åˆšåˆšé…ç½®å¥½çš„åˆ·æµç«™ç‚¹ï¼Œå¹¶é€‰æ‹©å¯¹åº”çš„ä¸‹è½½å™¨\n5ã€å·¦ä¸Šè§’é€‰æ‹©å¯ç”¨æ’ä»¶ï¼Œç‚¹å‡»ä¿å­˜\nå¥½äº†ï¼Œé…ç½®åˆ°è¿™é‡Œï¼Œä½ ç°åœ¨å¯ä»¥è‡ªåŠ¨è¿›è¡Œåˆ·æµäº†\n","date":"2024-11-10T08:53:17Z","permalink":"https://tianhui.xin/p/moviepilot/","title":"moviepilot åˆ·æµæ•™ç¨‹"},{"content":"åœ¨ç›®å‰çš„éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œé€šå¸¸ä¼šå°†Spring Booté¡¹ç›®éƒ¨ç½²åœ¨Kuberneteså®¹å™¨ä¸­ï¼› ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥ç»†è¯´ä¸€ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨Spring Boot Adminç›‘æ§åœ¨Kubernetesä¸Šè¿è¡Œçš„Spring Bootåº”ç”¨ç¨‹åºã€‚\nkubernetesä¸‹éƒ¨ç½²çš„æ¶æ„å¾€å¾€æ˜¯è¿™æ ·çš„ï¼š æœåŠ¡employee-serviceéƒ¨ç½²åœ¨å‘½åç©ºé—´aä¸­ï¼Œdepartment-serviceéƒ¨ç½²åœ¨å‘½åç©ºé—´bä¸­ï¼Œè€Œorganization-serviceéƒ¨ç½²åœ¨å‘½åç©ºé—´cä¸­ï¼Œ Spring Boot Adminä¹Ÿä½¿ç”¨Spring Bootå¯åŠ¨ï¼Œå¹¶é»˜è®¤éƒ¨ç½²åœ¨å‘½åç©ºé—´ä¸­ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡kubernetesçš„Apiå¯¹æœåŠ¡è¿›è¡Œç®¡ç†å’Œç›‘æ§ã€‚ PSï¼šå›¾æ˜¯æˆ‘æŠ„çš„ğŸ˜œ\nå¯åŠ¨Spring Boot Admin Server å¼•å…¥ç›¸å…³ä¾èµ– åœ¨SBAä¸­ï¼Œå·²ç»é›†æˆäº†kubernetes,å¦‚æœéœ€è¦é€šè¿‡kubernetesæ¥å‘ç°æœåŠ¡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠkubernetes-clientåŒ…åŠ å…¥åˆ°é¡¹ç›®ä¸­ï¼ŒSpringCloudå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†spring-cloud-starter-kubernetes-client\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34; ?\u0026gt; \u0026lt;project\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;spring-boot.version\u0026gt;2.6.1\u0026lt;/spring-boot.version\u0026gt; \u0026lt;spring-cloud.version\u0026gt;2021.0.0\u0026lt;/spring-cloud.version\u0026gt; \u0026lt;!-- SBA çš„æœ€æ–°ç‰ˆæœ¬ å®é™…æƒ…å†µ å’Œ spring boot çš„ç‰ˆæœ¬å·åº”è¯¥ä¸€è‡´ï¼Œç›®å‰æ²¡æœ‰å‘ç°ä¸å…¼å®¹çš„æƒ…å†µ --\u0026gt; \u0026lt;spring-boot-admin.version\u0026gt;2.5.5\u0026lt;/spring-boot-admin.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring-boot.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;de.codecentric\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-admin-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring-boot-admin.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring-cloud.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;de.codecentric\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-admin-server-cloud\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;de.codecentric\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-admin-server-ui\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-kubernetes-client\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; å¯åŠ¨ç±»é…ç½® @EnableAdminServer å¯ç”¨SBA ServeræœåŠ¡ EnableDiscoveryClient å¯ç”¨æœåŠ¡å‘ç°çš„èƒ½åŠ› EnableScheduling å¯ç”¨å®šæ—¶ä»»åŠ¡ï¼Œè¿™ä¸ªå¾ˆå…³é”®ï¼Œä¸ç„¶ä½ ä¼šå‘ç°å¯åŠ¨çš„æœåŠ¡ï¼Œæ— æ³•åœ¨SBAä¸­æ˜¾ç¤º 1 2 3 4 5 6 7 8 9 @SpringBootApplication @EnableAdminServer // å¯ç”¨ SBA Server æœåŠ¡ @EnableDiscoveryClient // å¯ç”¨æœåŠ¡å‘ç° @EnableScheduling // å¯ç”¨å®šæ—¶å™¨ public class OpsAdminCloudServerApplication { public static void main(String[] args) { SpringApplication.run(OpsAdminCloudServerApplication.class, args); } } Spring Boot Admin Server é…ç½® æ—¢ç„¶æˆ‘ä»¬ä½¿ç”¨kubernetesæ¥å‘ç°æœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¯¹kubernetesçš„å±æ€§è¿›è¡Œé…ç½®\nspring.cloud.kubernetes.discovery.service-labels é€šè¿‡ Services çš„ meta ä¸­åŒ¹é…å¯¹åº”çš„æ ‡è®°ï¼Œä¸æ»¡è¶³çš„åˆ™ä¼šè¢«æ’é™¤ spring.cloud.kubernetes.discovery.primary-port-name å½“ç»™ NodePort æŒ‡å®šå¤šä¸ªå¤šä¸ªç«¯å£æ—¶ï¼Œé€šè¿‡nameæ¥ç¡®è®¤ä½¿ç”¨å“ªä¸ªç«¯å£ä½œä¸ºä¸»ç«¯å£ spring.cloud.kubernetes.client.namespace æŒ‡å®šæœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´ spring.cloud.kubernetes.discovery.all-namespaces å½“ç„¶ï¼Œå¦‚æœä½ ä¸æƒ³æŒ‡å®šå‘½åç©ºé—´ï¼Œä¹Ÿå¯ä»¥è®¾ç½®è¯¥å±æ€§ä¸ºtrueï¼Œç¨‹åºä¼šæ‰¾åˆ°æ‰€æœ‰å‘½åç©ºé—´ä¸‹æ»¡è¶³service-labelsçš„å®ä¾‹ spring.boot.admin.discovery.converter.management-context-path å¦‚æœå®ä¾‹çš„actuatoråœ°å€è¢«ä¿®æ”¹ï¼Œéœ€è¦é…ç½®è¯¥å±æ€§ï¼Œé»˜è®¤å€¼ /actuatorï¼› è¯¥é…ç½®ä¸ºå…¨å±€é…ç½®ï¼Œå‡è®¾æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„context-path,éœ€è¦ç¼–è¾‘kubernetesæ–‡ä»¶ï¼Œmetadata.labelsä¸­é…ç½®management.context-path spring.boot.admin.discovery.converter.health-endpoint-path å¦‚æœå®ä¾‹çš„healthåœ°å€è¢«ä¿®æ”¹ï¼Œéœ€è¦é…ç½®è¯¥å±æ€§ï¼Œé»˜è®¤å€¼ /healthï¼› è¯¥é…ç½®ä¸ºå…¨å±€é…ç½®ï¼Œå¦‚æœæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„å¥åº·æ£€æŸ¥,éœ€è¦ç¼–è¾‘kubernetesæ–‡ä»¶ï¼Œmetadata.labelsä¸­é…ç½®health.path 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 spring: cloud: kubernetes: discovery: service-labels: # é€šè¿‡ Services çš„ meta ä¸­åŒ¹é…å¯¹åº”çš„æ ‡è®°ï¼Œä¸æ»¡è¶³çš„åˆ™ä¼šè¢«æ’é™¤ spa-admin: enabled primary-port-name: http # nodePort æŒ‡å®šå¤šä¸ªå¤šä¸ªç«¯å£æ—¶ï¼Œé€šè¿‡nameæ¥ç¡®è®¤ä½¿ç”¨å“ªä¸ªç«¯å£è¯·æ±‚ client: namespace: production # æŒ‡å®šå‘½åç©ºé—´ boot: application: name: spring-boot-admin-kubernetes # æœåŠ¡å admin: context-path: admin # Spring Boot Admin çš„ é¡µé¢æˆ– api çš„è·¯å¾„å‰ç¼€ discovery: converter: management-context-path: /actuator # è®¿é—®å®ä¾‹ çš„ Spring Boot actuator çš„æ ¹è·¯å¾„ health-endpoint-path: /health # è®¿é—®å®ä¾‹ å¥åº·æ£€æŸ¥çš„åœ°å€ å®ä¾‹é…ç½® ç¼–å†™kubernetesæ–‡ä»¶ åœ¨metadata.labelså±æ€§ä¸‹æ·»åŠ spa-admin: enabledï¼Œæ–¹ä¾¿SPAè¿‡æ»¤å®ä¾‹ï¼Œå¯¹åº”SPAé…ç½®ä¸­çš„spring.cloud.kubernetes.discovery.service-labels åœ¨spec.portsä¸­é…ç½®ç«¯å£ä¿¡æ¯ï¼Œnameçš„å€¼ä¸ºhttpï¼Œå¯¹åº”SPAé…ç½®ä¸­çš„spring.cloud.kubernetes.discovery.primary-port-name 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 kind: Service apiVersion: v1 metadata: name: admin-user-server namespace: production labels: name: sadmin-user-server app: admin-user-server version: production spa-admin: enabled spec: type: NodePort ports: - protocol: TCP name: http targetPort: 8080 port: 8080 nodePort: 32000 selector: app: admin-user-server åŠ å…¥ç›¸å…³ä¾èµ– æ·»åŠ spring-boot-starter-actuatorï¼Œç»™å®ä¾‹èµ‹äºˆactuatorèƒ½åŠ› é€šè¿‡spring-boot-maven-pluginæ’ä»¶ï¼Œå¯ä»¥ä¸ºactuatorçš„infoæ¥å£æä¾›æ›´å¤šçš„ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;project \u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-actuator\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;build-info\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; é…ç½®actuator 1 2 3 4 5 6 7 8 9 10 11 spring: application: name: admin-user-server management: endpoints: web: exposure: include: \u0026#34;*\u0026#34; endpoint: health: show-details: ALWAYS æ•ˆæœå›¾ å†™åœ¨æœ€å ç å­—ä¸æ˜“ï¼Œå› ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œéš¾å…æœ‰ç–æ¼å’Œé”™è¯¯ä¹‹å¤„ï¼Œå¦‚å‘ç°bugæˆ–è€…æœ‰æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ï¼Œä¸åæ„Ÿæ¿€\n","date":"2022-01-02T22:00:00Z","image":"https://image.tianhui.xin/spring/boot/admin/spring-boot-admin-on-kubernetes.png?x-oss-process=style/make","permalink":"https://tianhui.xin/p/spring-boot-admin-on-kubernetes/","title":"Spring Boot Admin On Kubernetes"},{"content":"@Conditionalæ˜¯Spring4æ–°æä¾›çš„æ³¨è§£ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŒ‰ç…§ä¸€å®šæ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶å°±å°†beanæ³¨å†Œåˆ°å®¹å™¨ã€‚\nContidional ä»‹ç» Conditionalæ˜¯ç”±SpringFrameworkæä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œä½äº org.springframework.context.annotation åŒ…å†…ï¼Œå®šä¹‰å¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 @Retention(RetentionPolicy.RUNTIME) @Target({ElementType.TYPE, ElementType.METHOD}) public @interface Conditional { Class\u0026lt;? extends Condition\u0026gt;[] value(); } æˆ‘ä»¬å¯ä»¥å°† Spring çš„@Conditionalæ³¨è§£ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nå¯ä»¥ä½œä¸ºç±»çº§åˆ«çš„æ³¨è§£ç›´æ¥æˆ–è€…é—´æ¥çš„ä¸@Componentç›¸å…³è”ï¼ŒåŒ…æ‹¬@Configurationç±»ï¼› å¯ä»¥ä½œä¸ºå…ƒæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨ç¼–å†™æ„é€ æ€§æ³¨è§£ï¼› ä½œä¸ºæ–¹æ³•çº§åˆ«çš„æ³¨è§£ï¼Œä½œç”¨åœ¨ä»»ä½•@Beanæ–¹æ³•ä¸Šã€‚ Condition æ¥å£ Condition å°†åœ¨å³å°†æ³¨å†Œ Bean å®šä¹‰ä¹‹å‰è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å®ƒçš„ matches() æ–¹æ³•è¿”å›å€¼åŠ¨æ€å†³å®šæ˜¯å¦æ³¨å†Œç»„ä»¶ï¼ˆtrue-å…è®¸æ³¨å†Œï¼›false-ä¸å…è®¸æ³¨å†Œï¼‰ã€‚\n1 2 3 public interface Condition { boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata); } æ³¨æ„ï¼šCondition å¿…é¡»éµå¾ªä¸ BeanFactoryPostProcessor ç›¸åŒçš„é™åˆ¶ï¼Œå¹¶æ³¨æ„æ°¸è¿œä¸è¦ä¸ bean å®ä¾‹äº¤äº’ã€‚å¯¹äºä¸ @Configuration bean äº¤äº’çš„æ¡ä»¶çš„æ›´ç»†ç²’åº¦æ§åˆ¶ï¼Œè¯·è€ƒè™‘å®ç° ConfigurationCondition æ¥å£ã€‚\nContidional ç”³æ˜ æŸä¸ª@Configurationæ³¨è§£çš„é…ç½®ç±»ä¸Š æŸä¸ª@Configurationæ³¨è§£é…ç½®ç±»ä¸­å¸¦æœ‰@Beanæ³¨è§£çš„æ–¹æ³•ä¸Š ä»»ä½•ç”¨@Componentã€@Serviceã€@Repositoryæˆ–@Controlleræ³¨é‡Šå£°æ˜çš„ Bean 1 2 3 4 5 @Configuration @Conditional(IsDevEnvCondition.class) class DevEnvLoggingConfiguration { // ... } 1 2 3 4 5 6 7 8 9 @Configuration class DevEnvLoggingConfiguration { @Bean @Conditional(IsDevEnvCondition.class) LoggingService loggingService() { return new LoggingService(); } } 1 2 3 4 5 @Service @Conditional(IsDevEnvCondition.class) class LoggingService { // ... } Contidional å®æˆ˜ è‡ªå®šä¹‰æ¡ä»¶ æ£€æŸ¥ Java ç‰ˆæœ¬æ˜¯å¦ä¸º 8\n1 2 3 4 5 6 class Java8Condition implements Condition { @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) { return JavaVersion.getJavaVersion().equals(JavaVersion.EIGHT); } } å°† Java8Condition ä½œä¸º @Conditional æ³¨é‡Šä¸­çš„ä¸€ä¸ªå±æ€§ï¼š\n1 2 3 4 5 @Service @Conditional(Java8Condition.class) public class Java8DependedService { // ... } å¸¸è§çš„æ¡ä»¶æ³¨è§£ ConditionalOnProperty valueå±æ€§ï¼ŒæŒ‡å®šè¦æ£€æŸ¥çš„é…ç½®å±æ€§; haveValueå±æ€§ï¼Œå®šä¹‰è¿™ä¸ªæ¡ä»¶æ‰€éœ€çš„å€¼ï¼› matchIfMissingå±æ€§ï¼Œå¦‚æœç¼ºå°‘å‚æ•°ï¼Œæ˜¯å¦åº”è¯¥åŒ¹é…æ¡ä»¶ã€‚ 1 2 3 4 5 6 7 8 @Service @ConditionalOnProperty( value=\u0026#34;logging.enabled\u0026#34;, havingValue = \u0026#34;true\u0026#34;, matchIfMissing = true) class LoggingService { // ... } ConditionalOnExpression ç›¸æ¯”è¾ƒå‰é¢çš„Beanï¼ŒClassæ˜¯å¦å­˜åœ¨ï¼Œé…ç½®å‚æ•°æ˜¯å¦å­˜åœ¨æˆ–è€…æœ‰æŸä¸ªå€¼è€Œè¨€ï¼Œè¿™ä¸ªä¾èµ–SPELè¡¨è¾¾å¼çš„ï¼Œå°±æ˜¾å¾—æ›´åŠ çš„é«˜çº§äº†ï¼› å…¶ä¸»è¦å°±æ˜¯æ‰§è¡ŒSpelè¡¨è¾¾å¼ï¼Œæ ¹æ®è¿”å›çš„true/falseæ¥åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶\n1 2 3 4 5 6 7 @Service @ConditionalOnExpression( \u0026#34;${logging.enabled:true} and \u0026#39;${logging.level}\u0026#39;.equals(\u0026#39;DEBUG\u0026#39;)\u0026#34; ) class LoggingService { // ... } ConditionalOnBean åªæœ‰åœ¨å®¹å™¨ä¸­æ³¨å†Œäº†æŸä¸ªbean,è¯¥æ¡ä»¶æ‰èµ·ä½œç”¨\n1 2 3 4 5 @Service @ConditionalOnBean(CustomLoggingConfiguration.class) class LoggingService { // ... } Contidional è¿›é˜¶ å¤šé‡æ³¨è§£æ¡ä»¶ æ­¤å¤„demoå®ç°æ»¡è¶³æŸä¸ªç¯å¢ƒå˜é‡æ—¶è¯¥æ¡ä»¶æ‰èƒ½ç”Ÿæ•ˆ\nåˆ›å»ºæ³¨è§£ç±» Env\n1 2 3 4 5 6 @Target({ElementType.TYPE, ElementType.METHOD}) @Retention(RetentionPolicy.RUNTIME) @Documented public @interface Env { String[] value(); } åˆ›å»º Condition å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class EnvCondition implements Condition { @Override public boolean matches(ConditionContext conditionContext, AnnotatedTypeMetadata metadata) { // æŸ¥æ‰¾@EnvConditionä½œç”¨çš„æ–¹æ³•æˆ–è€…ç±»ä¸Šçš„@Envæ³¨è§£ Map\u0026lt;String, Object\u0026gt; annotationAttributes = metadata.getAnnotationAttributes(Env.class.getName()); if (annotationAttributes != null) { String[] envList = (String[]) annotationAttributes.get(\u0026#34;value\u0026#34;); // è·å–é…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œé€šè¿‡Javaå¯åŠ¨å‚æ•°(vm options)é…ç½® -Denv=dev String env = context.getEnvironment().getProperty(\u0026#34;env\u0026#34;); return Arrays.stream(envList).anyMatch(r -\u0026gt; Objects.equals(r, env)); } return false; } } è‡ªå®šä¹‰æ¡ä»¶ä½¿ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 @Configuration public class DemoConfiguration{ @Env(\u0026#34;dev\u0026#34;) @EnvCondition public EnvBean envBean(){ // ... } @Env(\u0026#34;prod\u0026#34;) @EnvCondition public EnvBean prodBean(){ // ... } } å†™åœ¨æœ€å ç å­—ä¸æ˜“ï¼Œå› ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œéš¾å…æœ‰ç–æ¼å’Œé”™è¯¯ä¹‹å¤„ï¼Œå¦‚å‘ç°bugæˆ–è€…æœ‰æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ï¼Œä¸åæ„Ÿæ¿€\n","date":"2021-09-16T18:30:52.905+08:00","permalink":"https://tianhui.xin/p/spring-conditional%E8%AF%A6%E8%A7%A3/","title":"Spring Conditionalè¯¦è§£"},{"content":"å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ æ˜¯å¦é‡åˆ°éœ€è¦å¯¹DBæ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ï¼Œå­˜å‚¨çš„æ—¶å€™è°ƒç”¨åŠ å¯†æ–¹æ³•ï¼ŒæŸ¥è¯¢çš„æ—¶å€™å¯¹ç»“æœè¿›è¡Œè§£å¯†ï¼Œ å—¯ï¼Ÿè¿™åº”è¯¥æ˜¯ä¸€ä¸ªç—›è‹¦çš„è¿‡ç¨‹ï¼Œå¥½å§ï¼Œä»Šæ™šç»™å¤§å®¶å®‰åˆ©ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·data-shieldï¼Œé’ˆå¯¹mybatisæ¶æ„ï¼Œå¯¹æ•°æ®åœ¨è¿›è¡Œå†™å…¥æ—¶åŠ å¯†ï¼ŒæŸ¥è¯¢è§£å¯†ï¼Œä¸ºä½ çš„æ•°æ®ä¿é©¾æŠ¤èˆª, æˆ‘æƒ³ä½ ä¸€å®šä¼šçˆ±ä¸Šå®ƒ\ndata-shield data-shieldçš„å®ç°é‡‡ç”¨mybatisçš„Interceptorå®ç°ï¼Œä¸ä»…å®ç°çš„å¸¸è§„çš„æŸ¥è¯¢å’Œæ›´æ–°ï¼Œä¹Ÿé’ˆå¯¹Cursoræ¨¡å¼ä¸‹çš„æŸ¥è¯¢æ“ä½œï¼Œ å¯¹ä¸šåŠ¡ä»£ç æ— ä»»ä½•æµ¸å…¥æ€§ï¼Œåªéœ€è¦åœ¨éœ€è¦åŠ å¯†çš„å­—æ®µï¼Œæ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼Œå…¨ç¨‹å¸®ä½ å®Œæˆæ•°æ®çš„åŠ å¯†åŠè§£å¯†æ“ä½œï¼ŒçœŸæ˜¯å¼€å‘ä¸€å¤§åˆ©å™¨ï¼Œè¯ä¸å¤šè¯´ï¼Œ è¿›å…¥ä»Šæ—¥çš„æ­£é¢˜\npom.xmlé…ç½® 1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.github.homeant\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;data-shield-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; yamlé…ç½® 1 2 3 4 5 6 app: data: shield: enable: true strategy: aes #æ”¯æŒAES/DESæ¨¡å¼ key: AD42F6697B035B7580E4FEF93BE20BAD ä¸šåŠ¡å­—æ®µé…ç½® ä¸ºéœ€è¦å¤„ç†çš„ä¸šåŠ¡å­—æ®µæ·»åŠ @TableFieldæ³¨è§£,åªæ”¯æŒStringç±»å‹\nencrypt: ä¿®æ”¹è¿‡ç¨‹æ˜¯å¦éœ€è¦åŠ å¯†,é»˜è®¤ä¸ºfalse\ndecode: æŸ¥è¯¢è¿‡ç¨‹æ˜¯å¦éœ€è¦è§£å¯†,é»˜è®¤ä¸ºfalse\nasserts: decodeä¸ºtrueæ—¶ï¼Œé’ˆå¯¹æŸäº›æ•°æ®(å†å²æ•°æ®)æä¾›æ–­è¨€,é»˜è®¤å€¼DefaultAssert.class(encrypt=true,decode=true)\n1 2 3 4 5 6 7 8 9 @Data public class User { private Integer id; private String username; @TableField(encrypt = true,decode = true,assertion=Base64Assert.class) private String phone; } ä»£ç è°ƒç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 public class Test{ @Autowired private UserMapper userMapper; @Autowired private SqlSessionFactory sqlSessionFactory; /** * RSA åŠ å¯†æ¨¡å¼ä¼šå¯¼è‡´å¯†æ–‡è¿‡é•¿ï¼Œä¸æ¨èä½¿ç”¨ */ @Test public void test() { User user = new User(); user.setUsername(\u0026#34;tom\u0026#34;); user.setPassword(\u0026#34;p@ssw0rd1234567\u0026#34;); userMapper.insert(user); DataShieldHelper.dataMasking(); Optional\u0026lt;User\u0026gt; optional = userMapper.selectOn(user.getId()); DataShieldHelper.clearDataMasking(); optional.ifPresent(r -\u0026gt; { log.debug(\u0026#34;user:{}\u0026#34;, r); }); } @Test public void cursorTest() throws IOException { try (SqlSession sqlSession = sqlSessionFactory.openSession(); Cursor\u0026lt;User\u0026gt; userCursor = sqlSession.getMapper(UserMapper.class).selectList()) { Iterator\u0026lt;User\u0026gt; iterator = userCursor.iterator(); while (iterator.hasNext()){ log.info(\u0026#34;user:{}\u0026#34;,iterator.next()); } } } } 1 2 3 4 5 6 7 2021-04-03 16:23:16.604 DEBUG 3020 --- [ main] c.g.h.d.shield.mapper.UserMapper.insert : ==\u0026gt; Preparing: insert into t_user (username,password) values ( ?, ?) 2021-04-03 16:23:16.629 DEBUG 3020 --- [ main] c.g.h.d.shield.mapper.UserMapper.insert : ==\u0026gt; Parameters: tom(String), L0wfhbKDAELRnj03GtjKoQ==(String) 2021-04-03 16:23:16.651 DEBUG 3020 --- [ main] c.g.h.d.shield.mapper.UserMapper.insert : \u0026lt;== Updates: 1 2021-04-03 16:23:16.675 DEBUG 3020 --- [ main] c.g.h.d.s.mapper.UserMapper.selectOn : ==\u0026gt; Preparing: select id,username,password from t_user where id = ? 2021-04-03 16:23:16.675 DEBUG 3020 --- [ main] c.g.h.d.s.mapper.UserMapper.selectOn : ==\u0026gt; Parameters: 75(Integer) 2021-04-03 16:23:23.313 DEBUG 3020 --- [ main] c.g.h.d.s.mapper.UserMapper.selectOn : \u0026lt;== Total: 1 2021-04-03 16:23:26.166 DEBUG 3020 --- [ main] com.github.homeant.data.shield.DataTest : user:User(id=75, username=tom, password=p@ssw0rd1234567) 1 2 3 4 5 6 7 8 mysql\u0026gt; select * from t_user; +----+----------+--------------------------+ | id | username | password | +----+----------+--------------------------+ | 74 | tom | L0wfhbKDAELRnj03GtjKoQ== | | 75 | tom | L0wfhbKDAELRnj03GtjKoQ== | +----+----------+--------------------------+ 2 rows in set (0.03 sec) ä»£ç åœ°å€\n","date":"2021-04-03T18:30:52.905+08:00","permalink":"https://tianhui.xin/p/mybatis%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86/","title":"mybatiså¯¹æ•°æ®è¿›è¡ŒåŠ å¯†"},{"content":"åœ¨spring cloudä½“ç³»ä¸­,æœ‰å¾ˆå¤šçš„æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ,æ¯”å¦‚æœ€æ—©çš„eurekaä»¥åŠconsulã€ZooKeeper,é…ç½®ä¸­å¿ƒæœ‰ spring cloud config åŠ æºç¨‹çš„apollo config,ä»Šå¤©æˆ‘ä»¬è¦è¯´çš„æ˜¯é˜¿é‡Œæ–°ç§€Nacosæ¥ä½œä¸ºé…ç½®ä¸­å¿ƒæˆ–è€…æ³¨å†Œä¸­å¿ƒ\nNacosæ˜¯ä»€ä¹ˆ Nacos is committed to help you discover, configure, and manage your microservices. It provides a set of simple and useful features enabling you to realize dynamic service discovery, service configuration, service metadata and traffic management.\nNacos makes it easier and faster to construct, deliver and manage your microservices platform. It is the infrastructure that supports a service-centered modern application architecture with a microservices or cloud-native approach.\nNacos è‡´åŠ›äºå¸®åŠ©æ‚¨å‘ç°ã€é…ç½®å’Œç®¡ç†å¾®æœåŠ¡.Nacos æä¾›äº†ä¸€ç»„ç®€å•æ˜“ç”¨çš„ç‰¹æ€§é›†,å¸®åŠ©æ‚¨å¿«é€Ÿå®ç°åŠ¨æ€æœåŠ¡å‘ç°ã€æœåŠ¡é…ç½®ã€æœåŠ¡å…ƒæ•°æ®åŠæµé‡ç®¡ç†.\nNacos å¸®åŠ©æ‚¨æ›´æ•æ·å’Œå®¹æ˜“åœ°æ„å»ºã€äº¤ä»˜å’Œç®¡ç†å¾®æœåŠ¡å¹³å°. Nacos æ˜¯æ„å»ºä»¥æœåŠ¡ä¸ºä¸­å¿ƒçš„ç°ä»£åº”ç”¨æ¶æ„ (ä¾‹å¦‚å¾®æœåŠ¡èŒƒå¼ã€äº‘åŸç”ŸèŒƒå¼) çš„æœåŠ¡åŸºç¡€è®¾æ–½.\nNacoså®˜ç½‘\nå‡†å¤‡ å®‰è£…Nacos server ä¸‹è½½åœ°å€\nåŠ¨æ‰‹èƒ½åŠ›å¼ºçš„å°ä¼™ä¼´å¯ä»¥å°è¯•è‡ªå·±ç¼–è¯‘,éœ€è¦æå‰é…ç½®JavaåŠMaven\n1 2 3 4 5 6 7 git clone https://github.com/alibaba/nacos.git cd nacos/ mvn -Prelease-nacos -Dmaven.test.skip=true clean install -U ls -al distribution/target/ // change the $version to your actual path cd distribution/target/nacos-server-$version/nacos/bin å¯åŠ¨Nacos server Linux/Unix/Mac å¯åŠ¨å‘½ä»¤(standaloneä»£è¡¨ç€å•æœºæ¨¡å¼è¿è¡Œ,éé›†ç¾¤æ¨¡å¼):\n1 sh startup.sh -m standalone å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ubuntuç³»ç»Ÿ,æˆ–è€…è¿è¡Œè„šæœ¬æŠ¥é”™æç¤º[[ç¬¦å·æ‰¾ä¸åˆ°,å¯å°è¯•å¦‚ä¸‹è¿è¡Œï¼š\n1 bash startup.sh -m standalone Windows 1 cmd startup.cmd ä½ ä¹Ÿå¯ä»¥ç›´æ¥åŒå‡»startup.cmdè¿è¡Œ\nå¦‚ä½•åœ¨spring cloud ä¸­ä½¿ç”¨ ä½œä¸ºé…ç½®ä¸­å¿ƒä½¿ç”¨ å¼•å…¥ä¾èµ– ä¸ºäº†æ–¹ä¾¿ç®¡ç†Spring cloudåŠnacosç‰ˆæœ¬,å¯ä»¥æå‰åœ¨çˆ¶çº§é¡¹ç›®ä¸­é…ç½®dependencyManagement\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.8.RELEASE\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;Hoxton.SR6\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-alibaba-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; 1 2 3 4 5 6 7 8 9 10 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-nacos-config\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; é…ç½®nacos server application.ymlä¸­æ·»åŠ spring.application.nameåŠspring.cloud.nacos.server-addr\n1 2 3 4 5 6 spring: application: name: spring-boot-nacos-config cloud: nacos: server-addr: localhost:127.0.0.1:8848 spring.application.name æ˜¯ç»„æˆnacos é…ç½®ç®¡ç†dataIdå­—æ®µçš„ä¸€éƒ¨åˆ† spring.cloud.nacos.server-addr nacos çš„åœ°å€ å®Œæ•´çš„dataIdåœ¨spring cloud nacosä¸­ä¸º${prefix}-${spring.profile.active}.${file-extension} prefix é»˜è®¤ä¸º spring.application.name çš„å€¼,ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.prefixæ¥é…ç½®. spring.profile.active å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profile,è¯¦æƒ…å¯ä»¥å‚è€ƒ Spring Bootæ–‡æ¡£. æ³¨æ„ï¼šå½“ spring.profile.active ä¸ºç©ºæ—¶,å¯¹åº”çš„è¿æ¥ç¬¦ - ä¹Ÿå°†ä¸å­˜åœ¨,dataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ ${prefix}.${file-extension} file-exetension ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼,å¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.file-extension æ¥é…ç½®.ç›®å‰åªæ”¯æŒ properties å’Œ yaml ç±»å‹,é»˜è®¤ä¸ºproperties ç¼–å†™å¯åŠ¨ç±» 1 2 3 4 5 6 7 @SpringBootApplication public class NacosConfigApplication { public static void main(String[] args) { SpringApplication.run(NacosConfigApplication.class, args); } } ç¼–å†™Controller 1 2 3 4 5 6 7 8 9 10 11 12 @RestController @RefreshScope public class IndexController { @Value(\u0026#34;${nacosConfig}\u0026#34;) private String nacosCongig; @GetMapping(\u0026#34;/config\u0026#34;) public String test(){ return nacosCongig; } } æ·»åŠ é…ç½® è®¿é—®http://localhost:8848/nacos/ ç”¨æˆ·åå¯†ç nacos ç‚¹å‡»å·¦ä¾§èœå•é…ç½®ç®¡ç†\u0026gt;é…ç½®åˆ—è¡¨,åœ¨å³ä¾§ç‚¹å‡»+æ·»åŠ é…ç½® åœ¨è¾“å…¥é¡µå¡«å†™Data IDä¸ºæˆ‘ä»¬é…ç½®çš„spring.application.name é…ç½®æ ¼å¼é€‰æ‹©ä¸ºProperties,åœ¨é…ç½®å†…å®¹æ·»åŠ nacosConfig=hello å¦‚æœData IDå¡«å†™é”™è¯¯,æ˜¯æ— æ³•è·å–åˆ°å¯¹åº”é…ç½®çš„\næ·»åŠ å®Œæˆå,è¿”å›åˆ°é…ç½®ç®¡ç†,å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„é…ç½®\nå¯åŠ¨é¡¹ç›® è®¿é—®http://localhost:8080/config,æ­¤æ—¶é¡µé¢è¾“å‡ºhello,é‚£ä¹ˆæ­å–œä½ ,å¤§åŠŸå‘Šæˆ.\nä½œä¸ºæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒä½¿ç”¨ æ·»åŠ ä¾èµ– æ·»åŠ spring-cloud-starter-alibaba-nacos-discoveryå®ç°æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-nacos-config\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-nacos-discovery\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; å¯åŠ¨é¡¹ç›® æ­¤æ—¶,æˆ‘ä»¬åˆ°nacoså·¦ä¾§èœå•ä¸­ç‚¹å‡»æœåŠ¡ç®¡ç†\u0026gt;æœåŠ¡åˆ—è¡¨,å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšå¯åŠ¨çš„æœåŠ¡å·²ç»æˆåŠŸæ³¨å†Œåˆ°äº†åˆ—è¡¨ä¸­\nNacos config è§£è¯» é‚£ä¹ˆ,nacosæ˜¯å¦‚ä½•è·å–åˆ°é…ç½®åœ¨nacos serverçš„é…ç½®çš„å‘¢ æŸ¥çœ‹æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨spring-cloud-starter-alibaba-nacos-configæ¨¡å—ä¸­,nacosæ·»åŠ äº†com.alibaba.cloud.nacos.NacosConfigBootstrapConfigurationçš„è‡ªå¯åŠ¨, å…¶ä¸­NacosConfigPropertieså°±æ˜¯è·å–é…ç½®çš„å…³é”®,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 @Configuration( proxyBeanMethods = false ) @ConditionalOnProperty( name = {\u0026#34;spring.cloud.nacos.config.enabled\u0026#34;}, matchIfMissing = true ) public class NacosConfigBootstrapConfiguration { public NacosConfigBootstrapConfiguration() { } @Bean @ConditionalOnMissingBean public NacosConfigProperties nacosConfigProperties() { return new NacosConfigProperties(); } @Bean @ConditionalOnMissingBean public NacosConfigManager nacosConfigManager(NacosConfigProperties nacosConfigProperties) { return new NacosConfigManager(nacosConfigProperties); } // è·å–é…ç½® å®ç°org.springframework.cloud.bootstrap.config.PropertySourceLocatoræ¥å£ @Bean public NacosPropertySourceLocator nacosPropertySourceLocator(NacosConfigManager nacosConfigManager) { return new NacosPropertySourceLocator(nacosConfigManager); } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 @Order(0) // è®¾ç½®å¯åŠ¨é¡ºåº public class NacosPropertySourceLocator implements PropertySourceLocator { private static final Logger log = LoggerFactory.getLogger(NacosPropertySourceLocator.class); private static final String NACOS_PROPERTY_SOURCE_NAME = \u0026#34;NACOS\u0026#34;; private static final String SEP1 = \u0026#34;-\u0026#34;; private static final String DOT = \u0026#34;.\u0026#34;; private NacosPropertySourceBuilder nacosPropertySourceBuilder; private NacosConfigProperties nacosConfigProperties; private NacosConfigManager nacosConfigManager; /** @deprecated */ @Deprecated public NacosPropertySourceLocator(NacosConfigProperties nacosConfigProperties) { this.nacosConfigProperties = nacosConfigProperties; } public NacosPropertySourceLocator(NacosConfigManager nacosConfigManager) { this.nacosConfigManager = nacosConfigManager; this.nacosConfigProperties = nacosConfigManager.getNacosConfigProperties(); } // spring cloud ä¼šæ‰§è¡Œæ­¤æ–¹æ³• public PropertySource\u0026lt;?\u0026gt; locate(Environment env) { this.nacosConfigProperties.setEnvironment(env); // è·å–é…ç½®ä¸­å¿ƒ ConfigService configService = this.nacosConfigManager.getConfigService(); if (null == configService) { log.warn(\u0026#34;no instance of config service found, can\u0026#39;t load config from nacos\u0026#34;); return null; } else { long timeout = (long)this.nacosConfigProperties.getTimeout(); // è·å–é…ç½®çš„æ„é€ å™¨ æœ‰ é€šè¿‡loadNacosDataæ–¹æ³•è·å–é…ç½®ä¿¡æ¯ this.nacosPropertySourceBuilder = new NacosPropertySourceBuilder(configService, timeout); String name = this.nacosConfigProperties.getName(); String dataIdPrefix = this.nacosConfigProperties.getPrefix(); // datdId å‰ç¼€,æ²¡æœ‰å°±ç”¨spring.application.name if (StringUtils.isEmpty(dataIdPrefix)) { dataIdPrefix = name; } if (StringUtils.isEmpty(dataIdPrefix)) { dataIdPrefix = env.getProperty(\u0026#34;spring.application.name\u0026#34;); } // å£°æ˜nacosé…ç½®æ¥æº CompositePropertySource composite = new CompositePropertySource(\u0026#34;NACOS\u0026#34;); // è·å–å…¬å…±çš„é…ç½® é€šè¿‡ spring.cloud.nacos.config.sharedConfigs é…ç½® this.loadSharedConfiguration(composite); // è·å–æ‰©å±•çš„é…ç½® é€šè¿‡ spring.cloud.nacos.config.extensionConfigs é…ç½® this.loadExtConfiguration(composite); // è·å–å•å‰æœåŠ¡çš„é…ç½® this.loadApplicationConfiguration(composite, dataIdPrefix, this.nacosConfigProperties, env); return composite; } } private void loadSharedConfiguration(CompositePropertySource compositePropertySource) { List\u0026lt;Config\u0026gt; sharedConfigs = this.nacosConfigProperties.getSharedConfigs(); if (!CollectionUtils.isEmpty(sharedConfigs)) { this.checkConfiguration(sharedConfigs, \u0026#34;shared-configs\u0026#34;); this.loadNacosConfiguration(compositePropertySource, sharedConfigs); } } private void loadExtConfiguration(CompositePropertySource compositePropertySource) { List\u0026lt;Config\u0026gt; extConfigs = this.nacosConfigProperties.getExtensionConfigs(); if (!CollectionUtils.isEmpty(extConfigs)) { this.checkConfiguration(extConfigs, \u0026#34;extension-configs\u0026#34;); this.loadNacosConfiguration(compositePropertySource, extConfigs); } } private void loadApplicationConfiguration(CompositePropertySource compositePropertySource, String dataIdPrefix, NacosConfigProperties properties, Environment environment) { // è·å–é…ç½®ç±»å‹ String fileExtension = properties.getFileExtension(); String nacosGroup = properties.getGroup(); this.loadNacosDataIfPresent(compositePropertySource, dataIdPrefix, nacosGroup, fileExtension, true); this.loadNacosDataIfPresent(compositePropertySource, dataIdPrefix + \u0026#34;.\u0026#34; + fileExtension, nacosGroup, fileExtension, true); String[] var7 = environment.getActiveProfiles(); int var8 = var7.length; for(int var9 = 0; var9 \u0026lt; var8; ++var9) { String profile = var7[var9]; String dataId = dataIdPrefix + \u0026#34;-\u0026#34; + profile + \u0026#34;.\u0026#34; + fileExtension; this.loadNacosDataIfPresent(compositePropertySource, dataId, nacosGroup, fileExtension, true); } } private void loadNacosConfiguration(final CompositePropertySource composite, List\u0026lt;Config\u0026gt; configs) { Iterator var3 = configs.iterator(); while(var3.hasNext()) { Config config = (Config)var3.next(); String dataId = config.getDataId(); String fileExtension = dataId.substring(dataId.lastIndexOf(\u0026#34;.\u0026#34;) + 1); this.loadNacosDataIfPresent(composite, dataId, config.getGroup(), fileExtension, config.isRefresh()); } } private void checkConfiguration(List\u0026lt;Config\u0026gt; configs, String tips) { String[] dataIds = new String[configs.size()]; for(int i = 0; i \u0026lt; configs.size(); ++i) { String dataId = ((Config)configs.get(i)).getDataId(); if (dataId == null || dataId.trim().length() == 0) { throw new IllegalStateException(String.format(\u0026#34;the [ spring.cloud.nacos.config.%s[%s] ] must give a dataId\u0026#34;, tips, i)); } dataIds[i] = dataId; } NacosDataParserHandler.getInstance().checkDataId(dataIds); } private void loadNacosDataIfPresent(final CompositePropertySource composite, final String dataId, final String group, String fileExtension, boolean isRefreshable) { if (null != dataId \u0026amp;\u0026amp; dataId.trim().length() \u0026gt;= 1) { if (null != group \u0026amp;\u0026amp; group.trim().length() \u0026gt;= 1) { NacosPropertySource propertySource = this.loadNacosPropertySource(dataId, group, fileExtension, isRefreshable); this.addFirstPropertySource(composite, propertySource, false); } } } // è·å–é…ç½®,å­˜åœ¨å°±ç›´æ¥å–,ä¸å­˜åœ¨è°ƒç”¨config serverè·å– å…³æ³¨ this.nacosPropertySourceBuilder.build private NacosPropertySource loadNacosPropertySource(final String dataId, final String group, String fileExtension, boolean isRefreshable) { return NacosContextRefresher.getRefreshCount() != 0L \u0026amp;\u0026amp; !isRefreshable ? NacosPropertySourceRepository.getNacosPropertySource(dataId, group) : this.nacosPropertySourceBuilder.build(dataId, group, fileExtension, isRefreshable); } private void addFirstPropertySource(final CompositePropertySource composite, NacosPropertySource nacosPropertySource, boolean ignoreEmpty) { if (null != nacosPropertySource \u0026amp;\u0026amp; null != composite) { if (!ignoreEmpty || !((Map)nacosPropertySource.getSource()).isEmpty()) { composite.addFirstPropertySource(nacosPropertySource); } } } public void setNacosConfigManager(NacosConfigManager nacosConfigManager) { this.nacosConfigManager = nacosConfigManager; } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 public class NacosPropertySourceBuilder { private static final Logger log = LoggerFactory.getLogger(NacosPropertySourceBuilder.class); private static final Map\u0026lt;String, Object\u0026gt; EMPTY_MAP = new LinkedHashMap(); private ConfigService configService; private long timeout; public NacosPropertySourceBuilder(ConfigService configService, long timeout) { this.configService = configService; this.timeout = timeout; } public long getTimeout() { return this.timeout; } public void setTimeout(long timeout) { this.timeout = timeout; } public ConfigService getConfigService() { return this.configService; } public void setConfigService(ConfigService configService) { this.configService = configService; } NacosPropertySource build(String dataId, String group, String fileExtension, boolean isRefreshable) { Map\u0026lt;String, Object\u0026gt; p = this.loadNacosData(dataId, group, fileExtension); NacosPropertySource nacosPropertySource = new NacosPropertySource(group, dataId, p, new Date(), isRefreshable); NacosPropertySourceRepository.collectNacosPropertySource(nacosPropertySource); return nacosPropertySource; } // è·å–é…ç½® private Map\u0026lt;String, Object\u0026gt; loadNacosData(String dataId, String group, String fileExtension) { String data = null; try { // è¯·æ±‚config server é€šè¿‡dataIdå’Œgroupè·å–é…ç½® data = this.configService.getConfig(dataId, group, this.timeout); if (StringUtils.isEmpty(data)) { log.warn(\u0026#34;Ignore the empty nacos configuration and get it based on dataId[{}] \u0026amp; group[{}]\u0026#34;, dataId, group); return EMPTY_MAP; } if (log.isDebugEnabled()) { log.debug(String.format(\u0026#34;Loading nacos data, dataId: \u0026#39;%s\u0026#39;, group: \u0026#39;%s\u0026#39;, data: %s\u0026#34;, dataId, group, data)); } // é€šè¿‡é…ç½®ç±»å‹è§£æé…ç½®åˆ°map Map\u0026lt;String, Object\u0026gt; dataMap = NacosDataParserHandler.getInstance().parseNacosData(data, fileExtension); return dataMap == null ? EMPTY_MAP : dataMap; } catch (NacosException var6) { log.error(\u0026#34;get data from Nacos error,dataId:{}, \u0026#34;, dataId, var6); } catch (Exception var7) { log.error(\u0026#34;parse data from Nacos error,dataId:{},data:{},\u0026#34;, new Object[]{dataId, data, var7}); } return EMPTY_MAP; } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 public class NacosConfigService implements ConfigService { private static final Logger LOGGER = LogUtils.logger(NacosConfigService.class); private static final long POST_TIMEOUT = 3000L; private static final String EMPTY = \u0026#34;\u0026#34;; private HttpAgent agent; private ClientWorker worker; private String namespace; private String encode; private ConfigFilterChainManager configFilterChainManager = new ConfigFilterChainManager(); // è·å–é…ç½® private String getConfigInner(String tenant, String dataId, String group, long timeoutMs) throws NacosException { group = this.null2defaultGroup(group); ParamUtils.checkKeyParam(dataId, group); ConfigResponse cr = new ConfigResponse(); cr.setDataId(dataId); cr.setTenant(tenant); cr.setGroup(group); // è·å–æœ¬åœ°æ–‡ä»¶ä¸­çš„é…ç½® String content = LocalConfigInfoProcessor.getFailover(this.agent.getName(), dataId, group, tenant); if (content != null) { LOGGER.warn(\u0026#34;[{}] [get-config] get failover ok, dataId={}, group={}, tenant={}, config={}\u0026#34;, new Object[]{this.agent.getName(), dataId, group, tenant, ContentUtils.truncateContent(content)}); cr.setContent(content); this.configFilterChainManager.doFilter((IConfigRequest)null, cr); content = cr.getContent(); return content; } else { try { // ClientWorker å‘é€è¯·æ±‚è·å–é…ç½® String[] ct = this.worker.getServerConfig(dataId, group, tenant, timeoutMs); cr.setContent(ct[0]); this.configFilterChainManager.doFilter((IConfigRequest)null, cr); content = cr.getContent(); return content; } catch (NacosException var9) { if (403 == var9.getErrCode()) { throw var9; } else { LOGGER.warn(\u0026#34;[{}] [get-config] get from server error, dataId={}, group={}, tenant={}, msg={}\u0026#34;, new Object[]{this.agent.getName(), dataId, group, tenant, var9.toString()}); LOGGER.warn(\u0026#34;[{}] [get-config] get snapshot ok, dataId={}, group={}, tenant={}, config={}\u0026#34;, new Object[]{this.agent.getName(), dataId, group, tenant, ContentUtils.truncateContent(content)}); content = LocalConfigInfoProcessor.getSnapshot(this.agent.getName(), dataId, group, tenant); cr.setContent(content); this.configFilterChainManager.doFilter((IConfigRequest)null, cr); content = cr.getContent(); return content; } } } } } è·å–é…ç½®å…³é”®\ncurl get http://config-server:{port}/v1/cs/configs?dataId={dataId}\u0026amp;group={group}\u0026amp;tenant={tenant}\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 public class ClientWorker { //tenant é»˜è®¤ä¸ºç¯å¢ƒå˜é‡ tenant.id // é€šè¿‡é…ç½® nacos.use.cloud.namespace.parsing=true å¦‚æœteannt ä¸ºç©ºå– acm.namespace // é€šè¿‡é…ç½® nacos.use.cloud.namespace.parsing=fase å¦‚æœteannt ä¸ºç©ºå– ALIBABA_ALIWARE_NAMESPACE public String[] getServerConfig(String dataId, String group, String tenant, long readTimeout) throws NacosException { String[] ct = new String[2]; if (StringUtils.isBlank(group)) { group = \u0026#34;DEFAULT_GROUP\u0026#34;; } HttpResult result = null; try { List\u0026lt;String\u0026gt; params = null; if (StringUtils.isBlank(tenant)) { params = new ArrayList(Arrays.asList(\u0026#34;dataId\u0026#34;, dataId, \u0026#34;group\u0026#34;, group)); } else { params = new ArrayList(Arrays.asList(\u0026#34;dataId\u0026#34;, dataId, \u0026#34;group\u0026#34;, group, \u0026#34;tenant\u0026#34;, tenant)); } // curl get http://config-server:{port}/v1/cs/configs?dataId={dataId}\u0026amp;group={group}\u0026amp;tenant={tenant} result = this.agent.httpGet(\u0026#34;/v1/cs/configs\u0026#34;, (List)null, params, this.agent.getEncode(), readTimeout); } catch (IOException var10) { String message = String.format(\u0026#34;[%s] [sub-server] get server config exception, dataId=%s, group=%s, tenant=%s\u0026#34;, this.agent.getName(), dataId, group, tenant); LOGGER.error(message, var10); throw new NacosException(500, var10); } switch(result.code) { case 200: // å­˜å‚¨æ–‡ä»¶åˆ°æœ¬åœ°ç¼“å­˜ä¸­ LocalConfigInfoProcessor.saveSnapshot(this.agent.getName(), dataId, group, tenant, result.content); ct[0] = result.content; if (result.headers.containsKey(\u0026#34;Config-Type\u0026#34;)) { ct[1] = (String)((List)result.headers.get(\u0026#34;Config-Type\u0026#34;)).get(0); } else { ct[1] = ConfigType.TEXT.getType(); } return ct; case 403: LOGGER.error(\u0026#34;[{}] [sub-server-error] no right, dataId={}, group={}, tenant={}\u0026#34;, new Object[]{this.agent.getName(), dataId, group, tenant}); throw new NacosException(result.code, result.content); case 404: LocalConfigInfoProcessor.saveSnapshot(this.agent.getName(), dataId, group, tenant, (String)null); return ct; case 409: LOGGER.error(\u0026#34;[{}] [sub-server-error] get server config being modified concurrently, dataId={}, group={}, tenant={}\u0026#34;, new Object[]{this.agent.getName(), dataId, group, tenant}); throw new NacosException(409, \u0026#34;data being modified, dataId=\u0026#34; + dataId + \u0026#34;,group=\u0026#34; + group + \u0026#34;,tenant=\u0026#34; + tenant); default: LOGGER.error(\u0026#34;[{}] [sub-server-error] dataId={}, group={}, tenant={}, code={}\u0026#34;, new Object[]{this.agent.getName(), dataId, group, tenant, result.code}); throw new NacosException(result.code, \u0026#34;http error, code=\u0026#34; + result.code + \u0026#34;,dataId=\u0026#34; + dataId + \u0026#34;,group=\u0026#34; + group + \u0026#34;,tenant=\u0026#34; + tenant); } } } å¥½å•¦,ä»Šå¤©å°±è¯´åˆ°è¿™é‡Œ,å¦‚æœ‰ç–‘é—®å¯ä»¥è¯„è®ºåŒºç•™è¨€\nä»£ç åœ°å€\n","date":"2020-06-27T12:30:52.905+08:00","image":"https://image.tianhui.xin/spring-cloud/nacos.png?x-oss-process=style/make","permalink":"https://tianhui.xin/p/%E8%B7%9F%E6%88%91%E5%AD%A6springcloud-%E4%B9%8B-nacos/","title":"è·Ÿæˆ‘å­¦SpringCloud ä¹‹ nacos"},{"content":"åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ€»ä¼šé‡åˆ°Javaå¯¹è±¡ç›¸äº’è½¬æ¢,å‡ºäº†æœ€åŸå§‹åŠæœ€é«˜æ•ˆçš„get/setä¸€å—,Javaå¹³å°ä¸­,ä¹Ÿå‡ºç°äº†å¾ˆå¤šå¯¹è±¡è½¬æ¢å·¥å…·.\nä»Šå¤©æœ¬æ˜¯çˆ¶äº²èŠ‚,ä¹Ÿæ˜¯åœ°çƒç™¾å¹´ç½•è§çš„ä¸€æ¬¡æ—¥é£Ÿç°è±¡,æ™¨åˆ°ç‚¹å°±æŠ±ç€ç›¸æœºå‡ºé—¨,ç»“æœä¸“ä¸šåº¦ä¸å¤Ÿ,æ‹äº†ä¿©æœˆäº®å›æ¥; æœ‹å‹åœˆä¹Ÿæ˜¯æ™’ç–¯äº†,å„ç§å„æ ·çš„å¤ªé˜³,å¯¹éƒ½æ˜¯ä½ ä»¬çš„å¤ªé˜³; æ­¤æ—¶çš„æˆ‘å›åˆ°å®¶ä¸­,å·¦æ€å³æƒ³,è¿™ä¸ªå‘¨æœ«åˆè¦é¢“åºŸäº†å—,åˆ«ä»‹,å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´,å†™ä¼šæ–‡ç« å§ï¼›(TM\u0026hellip;.ä¸€å †åºŸè¯)\nå¥½å§,å’±è¿›å…¥ä»Šå¤©çš„æ­£é¢˜,Javaå¯¹è±¡è½¬æ¢å·¥å…·å“ªå®¶å¼ºï¼Ÿ é¦–å…ˆ,javaå¹³å°ä¸­æä¾›äº†å¾ˆå¤šçš„è½¬æ¢å·¥å…·,æ—¨åœ¨æä¾›å·¥ä½œæ•ˆç‡,æˆ‘ç»™å¤§å®¶åˆ—ä¸¾ä¸€ä¸‹\nBeanUtils\nDozer\nOrika\nMapStruct\nModelMapper\nJMapper\næ­¤å¤„æ’åä¸åˆ†å…ˆå,ä¸“ä¸šè¯„æµ‹\nä»€ä¹ˆæ˜¯MapStruct MapStruct is a code generator that greatly simplifies the implementation of mappings between Java bean types based on a convention over configuration approach. The generated mapping code uses plain method invocations and thus is fast, type-safe and easy to understand.\nå•¥æ„æ€ï¼Ÿå®˜æ–¹è¯´å®ƒæ˜¯ä¸ªä»£ç ç”Ÿæˆå™¨,ç”Ÿæˆçº¦å®šçš„Java beanå¯¹è±¡è½¬æ¢.é‡ç‚¹æ˜¯çº¯æ–¹æ³•è°ƒç”¨\nçº¯æ–¹æ³•è°ƒç”¨å®¹æˆ‘å…ˆä¹°ä¸ªå…³å­,5æ¯›,ä¸èƒ½å†å¤šäº†.\nè¿˜è®°å¾—æœ€åˆçš„BeanUtilså—,å¯¹äºåŒå±æ€§copy,å½“å¹´ç”¨çš„è´¼å—¨,æ…¢æ…¢çš„å·¥ä½œç»éªŒå’Œç¨‹åºçš„å¹¶å‘å‡ºç°,å‘ç°æ•ˆç‡å¹¶æ²¡æœ‰é‚£ä¹ˆé«˜;\nè¿˜æœ‰éåŒå±æ€§copy,ä¸­é€”æ¢äº†Nå¤š,æ¯”å¦‚å±…äºé…ç½®æ–‡ä»¶çš„Dozer,å†™ç€å¤æ‚çš„xmlé…ç½®.è¿™äº›æ¡†æ¶çš„èƒŒåæ— ä¸ä½¿ç”¨äº†Javaçš„åå°„æˆ–è€…ä»£ç†;\næ­¤æ—¶,è¦è¯´ä»Šå¤©çš„ä¸»è§’ä¹‹å‰,æˆ‘è§‰å¾—å’±åˆå¿…é¡»è¦å…ˆè¯´ä¸€ä¸‹,å¤§åé¼é¼çš„lombok,å¾ˆå¤šäººéƒ½è€³ç›®å…±æŸ“,æœ‰äº†å®ƒ,æˆ‘ä»¬å†ä¹Ÿä¸ç”¨å†™get/setäº†,å¥½å—¨å‘€!!!\né‚£ä¹ˆMapStructåˆèƒ½è®©æˆ‘ä»¬å°‘å†™ä»€ä¹ˆå‘¢,å¯¹,è¿™ä½åŒå­¦å¾ˆèªæ…§,ä¸éœ€è¦æˆ‘ä»¬å†™å¯¹è±¡è½¬æ¢æ—¶çš„get/setå•¦.\nMapStructäº®ç‚¹æ˜¯å•¥ Multi-layered applications often require to map between different object models (e.g. entities and DTOs). Writing such mapping code is a tedious and error-prone task. MapStruct aims at simplifying this work by automating it as much as possible.\nIn contrast to other mapping frameworks MapStruct generates bean mappings at compile-time which ensures a high performance, allows for fast developer feedback and thorough error checking.\nç¿»è¯‘å°±ç®—äº†,ç›´æ¥è¯´é‡ç‚¹,Java bean å±æ€§è½¬æ¢,è¿™æ ·çš„ä»£ç å†™å¤šäº†,çœ‹ç€å†—ä½™,è¿˜ä¸å¥½æ‰¾(å¯†å¯†éº»éº»),MapStructåœ¨ç¼–è¯‘çš„æ—¶å€™,å¸®ä½ ç”Ÿæˆå¯¹åº”çš„æ˜ å°„å…³ç³»,æä¾›å¼€å‘æ•ˆç‡.\nå¦‚ä½•ä½¿ç”¨ å¯¼å…¥å¯¹åº”ä¾èµ– 1.3.1.Finalçš„mapstruct-jdk8å·²ç»æŒ‡å‘mapstruct,æ‰€ä»¥å¯¼å…¥mapstruct-jdk8å·²ç»æˆä¸ºè¿‡å»å¼\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mapstruct\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mapstruct\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.1.Final\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mapstruct\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mapstruct-processor\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.1.Final\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; mapstruct å«æœ‰å¯¹åº”çš„æ³¨è§£,æ¯”å¦‚@Mapper mapstruct-processor åŒ…å«Javaå¤„ç†æœºåˆ¶,ä»£ç ç”Ÿæˆçš„å…³é”® ç¼–å†™Java Bean 1 2 3 4 5 6 @Data public class User implements Serializable { private String loginName; private String password; } 1 2 3 4 5 6 @Data public class UserDto implements Serializable { private String username; private String password; } ç¼–å†™Mapper 1 2 3 4 5 6 7 @Mapper(componentModel = \u0026#34;spring\u0026#34;) public interface UserMapper { UserMapper INSTANCE = Mappers.getMapper(UserMapper.class); @Mapping(source = \u0026#34;loginName\u0026#34;, target = \u0026#34;username\u0026#34;) UserDto userToUserDto(User user); } @Mapper(componentModel = \u0026quot;spring\u0026quot;)ä½¿ç”¨springæ–¹å¼æ³¨å…¥ UserMapper INSTANCE = Mappers.getMapper(UserMapper.class); ä¸ä½¿ç”¨springæ³¨å…¥æ—¶,å¯ä»¥ä½¿ç”¨å®ä¾‹æ¨¡å¼,é»˜è®¤ @Mapping(source = \u0026quot;loginName\u0026quot;, target = \u0026quot;username\u0026quot;) çº¦å®šæ˜ å°„å…³ç³»,å¤šä¸ªä½¿ç”¨@Mappings æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @Slf4j public class DomainTest extends ApplicationTest { @Autowired private UserMapper userMapper; @Test public void test(){ User user = new User(); user.setLoginName(\u0026#34;12321\u0026#34;); user.setPassword(\u0026#34;123456\u0026#34;); // å®ä¾‹æ¨¡å¼ log.info(\u0026#34;result:{}\u0026#34;,UserMapper.INSTANCE.userToUserDto(user)); } @Test public void test2(){ User user = new User(); user.setLoginName(\u0026#34;12321\u0026#34;); user.setPassword(\u0026#34;123456\u0026#34;); // spring æ³¨å…¥æ¨¡å¼ log.info(\u0026#34;result:{}\u0026#34;,userMapper.userToUserDto(user)); } } åŸç† ä¸Šæ–‡è®²è¿°äº†å¦‚ä½•ä½¿ç”¨MapStruct,ç°åœ¨æˆ‘ä»¬æ¥è®²è¿°ä¸‹åŸç†,è®²è¿°åŸç†å‰,æˆ‘ä»¬è¦çŸ¥é“ä¸€ä¸ªå¤§æ€å™¨\nAnnotation Processor Annotation Processoræ³¨è§£å¤„ç†å™¨æ˜¯javacå†…ç½®çš„ä¸€ä¸ªç”¨äºç¼–è¯‘æ—¶æ‰«æå’Œå¤„ç†æ³¨è§£(Annotation)çš„å·¥å…·. ç®€å•çš„è¯´,åœ¨æºä»£ç ç¼–è¯‘é˜¶æ®µ,é€šè¿‡æ³¨è§£å¤„ç†å™¨,æˆ‘ä»¬å¯ä»¥è·å–æºæ–‡ä»¶å†…æ³¨è§£(Annotation)ç›¸å…³å†…å®¹.\nç¼–è¯‘æ—¶æ³¨è§£å¤„ç†å™¨AnnotationProcessorçš„ä½¿ç”¨\næŸ¥çœ‹lombokå’ŒMapStructæºç ,æˆ‘ä»¬éƒ½å‘ç°æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶\nMETA-INF/services/javax.annotation.processing.Processor\nå†…å®¹å¤§æ¦‚æ˜¯è¿™æ ·çš„,å®ƒåœ¨å‘Šè¯‰javacå¯¹åº”çš„æ³¨è§£å¤„ç†æ˜¯å“ªäº›\n1 2 3 4 5 # Copyright MapStruct Authors. # # Licensed under the Apache License version 2.0, available at http://www.apache.org/licenses/LICENSE-2.0 org.mapstruct.ap.MappingProcessor é€šè¿‡MappingProcessorä¸€ç³»åˆ—çš„å¤„ç†å,MapStructä¸ºä½ ç”Ÿæˆäº†å¯¹åº”çš„mapperçš„å®ç°ç±»,æˆ‘ä»¬æ¥çœ‹çœ‹ç”Ÿæˆçš„ä»£ç æ€æ ·çš„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @Component public class UserMapperImpl implements UserMapper { public UserMapperImpl() { } public UserDto userToUserDto(User user) { if (user == null) { return null; } else { UserDto userDto = new UserDto(); userDto.setUsername(user.getLoginName()); userDto.setPassword(user.getPassword()); return userDto; } } } æ­¤æ—¶,æ˜¯ä¸æ˜¯è§‰å¾—å“ªäº›ä»£ç†ã€åå°„éƒ½å¼±çˆ†äº†,å¯¹æ­¤ä½ æœ‰ä»€ä¹ˆæ ·çš„çœ‹æ³•å‘¢,æ¬¢è¿ç•™è¨€,æˆ‘ä»¬ä¸€èµ·æ¢è®¨\n","date":"2020-06-21T18:22:52.905+08:00","image":"https://image.tianhui.xin/mapstruct/Mapstruct.png?x-oss-process=style/make","permalink":"https://tianhui.xin/p/%E4%B8%80%E8%A7%81%E5%80%BE%E5%BF%83%E4%B9%8B%E5%88%9D%E9%81%87mapstruct/","title":"ä¸€è§å€¾å¿ƒä¹‹åˆé‡MapStruct"},{"content":"æ‹¦æˆªå™¨çš„ä¸€ä¸ªä½œç”¨å°±æ˜¯æˆ‘ä»¬å¯ä»¥æ‹¦æˆªæŸäº›æ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨è¿™äº›è¢«æ‹¦æˆªçš„æ–¹æ³•æ‰§è¡Œå‰ååŠ ä¸ŠæŸäº›é€»è¾‘ã€‚ é‚£ä¹ˆå¦‚æœä½¿ç”¨Mybatiså¯¹æ•°æ®è¿›è¡Œæ‹¦æˆªï¼Œåšä¸€äº›æ»¡è¶³è‡ªå·±éœ€æ±‚çš„ä¸œè¥¿å‘¢ã€‚ä»Šå¤©æˆ‘ä»¬å°±ç”¨è¿™ä¸ªå®ç°ä¸€ä¸ªæ•°æ®çš„è„±æ•åŠŸèƒ½ã€‚\nInterceptoræ¥å£ å¯¹äºæ‹¦æˆªå™¨Mybatisä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªInterceptoræ¥å£ï¼Œé€šè¿‡å®ç°è¯¥æ¥å£å°±å¯ä»¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„æ‹¦æˆªå™¨ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ¥å£çš„å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 package org.apache.ibatis.plugin; import java.util.Properties; public interface Interceptor { Object intercept(Invocation invocation) throws Throwable; Object plugin(Object target); void setProperties(Properties properties); } å¯ä»¥çœ‹åˆ°ï¼Œéœ€è¦æˆ‘ä»¬å®ç°çš„æ–¹æ³•æœ‰ï¼š\ninterceptæ‹¦æˆªå™¨çš„å¤„ç†é€»è¾‘ pluginæ‹¦æˆªå™¨ç”¨äºå°è£…ç›®æ ‡å¯¹è±¡çš„ï¼Œé€šè¿‡è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥è¿”å›ç›®æ ‡å¯¹è±¡æœ¬èº«ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå®ƒçš„ä»£ç†ã€‚ setPropertiesä¸ºæ’ä»¶è®¾ç½®propertieså±æ€§\néœ€æ±‚å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 @Intercepts({ @Signature( type = ResultSetHandler.class, method = \u0026#34;handleResultSets\u0026#34;, args = {Statement.class} ) }) public class DataMaskingInterceptor implements Interceptor { @Override public Object intercept(Invocation invocation) throws Throwable { // è·å–åˆ°è¿”å›ç»“æœ Object returnValue = invocation.proceed(); if (returnValue != null) { // å¯¹ç»“æœè¿›è¡Œå¤„ç† if (returnValue instanceof ArrayList\u0026lt;?\u0026gt;) { List\u0026lt;?\u0026gt; list = (ArrayList\u0026lt;?\u0026gt;) returnValue; for (int index = 0; index \u0026lt; list.size(); index++) { Object returnItem = list.get(index); if (returnItem != null) { Class\u0026lt;?\u0026gt; clazz = returnItem.getClass(); Type superType = clazz.getGenericSuperclass(); if (superType.getClass().isInstance(Object.class)) { List\u0026lt;Field\u0026gt; fieldList = new ArrayList\u0026lt;\u0026gt;(); // åˆ©ç”¨åå°„è·å–æ‰€æœ‰å­—æ®µ ReflectionUtils.doWithFields(clazz, fieldList::add); for (Field field : fieldList) { // è·å–ç»“æœç±»ä¸Šçš„æ³¨è§£ TableField annotation = field.getAnnotation(TableField.class); if (annotation != null) { // è·å–æ˜¯å¦ç™»è®°äº†è„±æ• ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç™»è®°ï¼Œè€Œä¸ä½¿ç”¨æ³¨è§£å‘¢ï¼Ÿ String dataMaskingFlag = DataShieldHelper.getDataMasking(); if (!StringUtils.isEmpty(dataMaskingFlag)) { Class\u0026lt;? extends DataMasking\u0026gt; dataMasking = annotation.dataMasking(); if (dataMasking != DataMasking.class) { DataMasking instance = getInstance(dataMasking); field.setAccessible(true); String value = (String) field.get(returnItem); value = instance.apply(value); ReflectionUtils.setField(field, returnItem, value); } } } } } } } } } return returnValue; } /** /* å›ºå®šå†™æ³• åŸç†è§ org.apache.ibatis.plugin.Plugin.wrap æ–¹æ³• **/ @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { } private \u0026lt;T\u0026gt; T getInstance(Class\u0026lt;T\u0026gt; clazz) throws IllegalAccessException, InstantiationException { return clazz.newInstance(); } } è§£é‡Šä»£ç ä¸­ä¸ºå•¥è¦ä½¿ç”¨DataShieldHelperæ¥å®ç°è„±æ•ç™»è®°ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šç”¨åˆ°Javaå¯¹è±¡å¤ç”¨çš„æƒ…å†µï¼Œé‚£ä¹ˆå¦‚æœåœ¨æŸä¸ªå­—æ®µä¸ŠåŠ ä¸Šè„±æ•æ³¨è§£ï¼Œä¼šå‡ºç°å®ç°é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹æ‹¦æˆªå™¨å»åˆ¤æ–­å“ªäº›æŸ¥è¯¢éœ€è¦è„±æ•å“ªäº›ä¸éœ€è¦ï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½å®ç°éœ€è¦æ—¶æ‰å¯¹æ•°æ®è¿›è¡Œè„±æ•ï¼ŒæŸäº›æƒ…å†µä¸éœ€è¦å‘¢ï¼Œæ­¤æ—¶ThreadLocalå°±èƒ½å¸®åŠ©åˆ°æˆ‘ä»¬ï¼ŒThreadLocalæä¾›äº†çº¿ç¨‹å†…å­˜å‚¨å˜é‡çš„èƒ½åŠ›ï¼Œè¿™äº›å˜é‡ä¸åŒä¹‹å¤„åœ¨äºæ¯ä¸€ä¸ªçº¿ç¨‹è¯»å–çš„å˜é‡æ˜¯å¯¹åº”çš„äº’ç›¸ç‹¬ç«‹çš„ã€‚é€šè¿‡getå’Œsetæ–¹æ³•å°±å¯ä»¥å¾—åˆ°å½“å‰çº¿ç¨‹å¯¹åº”çš„å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /** /* çº¿ç¨‹å·¥å…·ç±» ä¸»è¦ç”¨äºç™»è®°è„±æ•æ“ä½œ **/ public class DataShieldHelper { private static final ThreadLocal\u0026lt;String\u0026gt; LOCAL_DATA_MASKING = new ThreadLocal(); public static void dataMasking(String symbol){ if(symbol==null || symbol.isEmpty()){ symbol = \u0026#34;*\u0026#34;; } LOCAL_DATA_MASKING.set(symbol); } public static void dataMasking(){ dataMasking(\u0026#34;*\u0026#34;); } public static String getDataMasking(){ return LOCAL_DATA_MASKING.get(); } public static void clearDataMasking(){ LOCAL_DATA_MASKING.remove(); } } ä½¿ç”¨@Intercepts æ‹¦æˆªResultSetHandleræ¥å£ä¸­å‚æ•°ç±»å‹ä¸ºStatementçš„handleResultSetsæ–¹æ³• ResultSetHandler ä¸»è¦è´Ÿè´£å°†JDBCè¿”å›çš„ResultSetç»“æœé›†å¯¹è±¡è½¬æ¢æˆListç±»å‹çš„é›†åˆ\næ‹¦æˆªå™¨çš„æ³¨å†Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE configuration PUBLIC \u0026#34;-//mybatis.org//DTD Config 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-config.dtd\u0026#34;\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;properties resource=\u0026#34;config/jdbc.properties\u0026#34;\u0026gt;\u0026lt;/properties\u0026gt; \u0026lt;typeAliases\u0026gt; \u0026lt;package name=\u0026#34;com.github.homeant.model\u0026#34; /\u0026gt; \u0026lt;/typeAliases\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin interceptor=\u0026#34;com.github.homeant.mybatis.interceptor.DataMaskingInterceptor\u0026#34;\u0026gt; \u0026lt;!-- å±æ€§ --\u0026gt; \u0026lt;property name=\u0026#34;prop1\u0026#34; value=\u0026#34;prop1\u0026#34; /\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;environments default=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;environment id=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;transactionManager type=\u0026#34;JDBC\u0026#34; /\u0026gt; \u0026lt;dataSource type=\u0026#34;POOLED\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;driver\u0026#34; value=\u0026#34;${jdbc.driver}\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;url\u0026#34; value=\u0026#34;${jdbc.url}\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;username\u0026#34; value=\u0026#34;${jdbc.username}\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;password\u0026#34; value=\u0026#34;${jdbc.password}\u0026#34; /\u0026gt; \u0026lt;/dataSource\u0026gt; \u0026lt;/environment\u0026gt; \u0026lt;/environments\u0026gt; \u0026lt;mappers\u0026gt; \u0026lt;mapper resource=\u0026#34;com/github/homeant/mapper/UserMapper.xml\u0026#34; /\u0026gt; \u0026lt;/mappers\u0026gt; \u0026lt;/configuration\u0026gt; ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 public class Test{ @Test public void test(){ // è„±æ•ç™»è®° DataShieldHelper.dataMasking(); Optional\u0026lt;User\u0026gt; optional = userMapper.selectOn(user.getId()); // å–æ¶ˆ DataShieldHelper.clearDataMasking(); optional.ifPresent(r-\u0026gt;{ log.debug(\u0026#34;user:{}\u0026#34;,r); }); } } æ•ˆæœ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å·²ç»è„±æ•äº†\n1 2 3 4 2020-06-01 23:34:11.910 DEBUG 34392 --- [ main] c.g.h.d.s.mapper.UserMapper.selectOn : ==\u0026gt; Preparing: select id,username,password from t_user where id = ? 2020-06-01 23:34:11.910 DEBUG 34392 --- [ main] c.g.h.d.s.mapper.UserMapper.selectOn : ==\u0026gt; Parameters: 71(Integer) 2020-06-01 23:34:11.930 DEBUG 34392 --- [ main] c.g.h.d.s.mapper.UserMapper.selectOn : \u0026lt;== Total: 1 2020-06-01 23:34:11.940 DEBUG 34392 --- [ main] com.github.homeant.data.shield.DataTest : user:User(id=71, username=tom, password=p@***********67) ä¸Šè¿°ä¸ºç®€æ˜“ç‰ˆä»£ç ï¼Œå¦‚æœéœ€è¦ï¼Œè¯·å‰å¾€GitHubè¿›è¡Œä¸‹è½½\nä»£ç ç›´é€šè½¦ data-shield\n","date":"2020-05-31T10:03:17Z","permalink":"https://tianhui.xin/p/mybatis-interceptor-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F/","title":"Mybatis Interceptor å®ç°æ•°æ®è„±æ•"},{"content":"ä¸ºäº†é˜²æ­¢åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šä¸ªè¿›ç¨‹ä¹‹é—´ç›¸äº’å¹²æ‰°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§åˆ†å¸ƒå¼åè°ƒæŠ€æœ¯æ¥å¯¹è¿™äº›è¿›ç¨‹è¿›è¡Œè°ƒåº¦ã€‚ é‚£ä¹ˆå¦‚ä½•åœ¨Java 1.8ä¸­å†™å‡ºä¼˜é›…çš„åˆ†å¸ƒå¼é”ï¼Œæ­¤ç¯‡æ–‡ç« ä¸ºä½ è®²è§£ã€‚\nåŠ é” redisæä¾› setnx å‘½ä»¤å‘½ä»¤ã€‚key æ˜¯é”çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥æŒ‰ä¸šåŠ¡æ¥å†³å®šå‘½åã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œè¿”å›1æ ‡è¯†åŠ é”æˆåŠŸï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹å¼€å§‹æ‰§è¡Œï¼Œè¿”å›0æ ‡è¯†åŠ é”è¯†åˆ«ï¼Œå·²ç»æœ‰ç¨‹åºåœ¨å¤„ç†ã€‚\n1 setnx(\u0026#39;key\u0026#39;,\u0026#39;value\u0026#39;); # set if not exits é‡Šæ”¾é” é‚£ä¹ˆï¼Œé”åŠ ä¸Šäº†ï¼Œæ€ä¹ˆé‡Šæ”¾é”å‘¢ï¼Œä»£ç ä¹Ÿéå¸¸çš„ç®€å•ï¼Œä½¿ç”¨delå°±å¯ä»¥é‡Šæ”¾é”ã€‚\n1 del(\u0026#39;key\u0026#39;); # åˆ é™¤Redisä¸­çš„ç¼“å­˜ é”è¶…æ—¶ åœ¨ç³»ç»Ÿä¸­æ€»ä¼šå­˜åœ¨ä¸€ç§æƒ…å†µï¼Œåœ¨åŠ é”çš„é€”ä¸­ï¼Œå¤„ç†ä¸šåŠ¡åœºæ™¯å¤±è´¥ï¼Œæ²¡æ¥å¾—åŠé‡Šæ”¾é”ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡ä¸šåŠ¡å°†æ— æ³•æ­£å¸¸å¤„ç†ï¼Œè¿™æ—¶å’±ä»¬å°±éœ€è¦ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‡½æ•°æ¥è‡ªåŠ¨é‡Šæ”¾é”ã€‚\n1 expire(\u0026#39;key\u0026#39;,millisecond); # ä¸ºç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ å­˜åœ¨é—®é¢˜ äº†è§£redisçš„å¤§ä½¬ä»¬éƒ½çŸ¥é“ï¼Œrediså‘½ä»¤æ˜¯ä¸€ä¸ªå‘½ä»¤ä¸€æ¬¡è¿æ¥ï¼Œå¦‚æœåœ¨åŠ é”çš„è¿‡ç¨‹ä¸­ï¼ŒåŠ é”æˆåŠŸï¼Œç´§æ¥ç€redisèŠ‚ç‚¹å®•æœºäº†ï¼Œç¨‹åºå¤„ç†åˆæ²¡æ¥å¾—èµ·å…¶å®é‡Šæ”¾é”ï¼Œé‚£ä¹ˆè¿˜æ˜¯å‡ºç°äº†ä¸Šè¿°æ­»é”çš„é—®é¢˜ï¼Œè™½ç„¶è¿™ç§æƒ…å†µå¾ˆå°‘å‘ç”Ÿï¼Œä½†ä¹Ÿå­˜åœ¨éšæ‚£ã€‚\n1 set(\u0026#39;key\u0026#39;,\u0026#39;value\u0026#39;,millisecond,\u0026#39;NX\u0026#39;); # NX SET IF NOT EXIST JAVAå®ç° äº†è§£å‡ ä¸ªå¸¸ç”¨å‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥åœ¨Javaä»£ç ä¸­å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 @Slf4j @Component public class BusinessLockComponent{ @Autowired private RedisTemplate redisTemplate; private final static String JSON_STRING = \u0026#34;{\\\u0026#34;key\\\u0026#34;:\\\u0026#34;%s\\\u0026#34;,\\\u0026#34;result\\\u0026#34;:%b,\\\u0026#34;time\\\u0026#34;:%d}\u0026#34;; /** * ä¸ºæ¯ä¸ªä¸šåŠ¡åŠ é” * * @param lockKey * @param time * @param callback */ public void lock(String lockKey, Long time, LockCallback callback) { Boolean flag = lock(lockKey, time); log.info(\u0026#34;BUSINESS_LOCK|{}\u0026#34;, String.format(JSON_STRING, lockKey, flag, time)); try { if (flag) { callback.execute(); } } finally { deleteLook(lockKey); } } private Boolean lock(String lockKey, Long time) { return (Boolean) redisTemplate.execute((RedisCallback) connection -\u0026gt; { long expireAt = System.currentTimeMillis() + time + 1; Boolean acquire = connection.setNX(lockKey.getBytes(), String.valueOf(expireAt).getBytes()); if (acquire) { return true; } else { byte[] value = connection.get(lockKey.getBytes()); if (Objects.nonNull(value) \u0026amp;\u0026amp; value.length \u0026gt; 0) { long expireTime = Long.parseLong(new String(value)); // å¦‚æœé”å·²ç»è¿‡æœŸ if (expireTime \u0026lt; System.currentTimeMillis()) { // é‡æ–°åŠ é”ï¼Œé˜²æ­¢æ­»é” byte[] oldValue = connection.getSet(lockKey.getBytes(), String.valueOf(System.currentTimeMillis() + time + 1).getBytes()); return Long.parseLong(new String(oldValue)) \u0026lt; System.currentTimeMillis(); } } } return false; }); } private void deleteLook(String lockKey) { redisTemplate.delete(lockKey); } } åŠ é”æˆåŠŸæ‰§è¡Œå‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 /** * é”å›è°ƒæ–¹æ³• * */ public interface LockCallback { /** * æ‰§è¡Œæ–¹æ³• */ @NonNull void execute(); } ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 public class Test{ @Autowired private BusinessLockComponent lockComponent; public void methodX(){ lockComponent.lock(\u0026#34;20200404\u0026#34;,System.currentTimeMillis()+5000,()-\u0026gt;{ System.out.println(\u0026#34;æ­¦æ±‰åŠ æ²¹\u0026#34;); }); } } ä½¿ç”¨spring integeration å®ç°åˆ†å¸ƒå¼é” å…¶å®Springæ—©æœŸå°±å®ç°äº†ï¼Œå­˜åœ¨äºSpring Cloud Clusteré¡¹ç›®ä¸­ï¼ŒåæœŸå‘å±•ï¼Œè¿ç§»åˆ°äº†Spring Integrationä¸­ï¼Œå®ç°æ–¹å¼å¦‚ä¸‹ï¼š\nåŠ å…¥ä¾èµ– 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-integration\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.integration\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-integration-redis\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-redis\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ é…ç½® åœ¨application.ymlä¸­æ·»åŠ \n1 2 3 4 spring: redis: port: 6379 host: localhost é…ç½®bean 1 2 3 4 5 6 7 8 9 @Configuration public class RedisLockConfiguration { @Bean public RedisLockRegistry redisLockRegistry(RedisConnectionFactory redisConnectionFactory) { return new RedisLockRegistry(redisConnectionFactory, \u0026#34;spring-cloud\u0026#34;); } } ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @RestController @RequestMapping(\u0026#34;redis\u0026#34;) public class IndexController { @Autowired private RedisLockRegistry redisLockRegistry; @GetMapping(\u0026#34;/test\u0026#34;) public void test(){ Lock lock = redisLockRegistry.obtain(\u0026#34;lock\u0026#34;); boolean isLock = lock.tryLock(1, TimeUnit.SECONDS); if(isLock){ System.out.println(s + \u0026#34;å–é”é”äº†\u0026#34;); lock.unlock(); } } } ä»Šå¤©å°±å†™åˆ°è¿™é‡Œï¼Œä¸‹æ¬¡è§ï¼Œç å­—ä¸æ˜“ï¼Œæœ‰é—®é¢˜è¯·ç•™è¨€äº¤æµã€‚\n","date":"2020-04-04T12:34:17Z","permalink":"https://tianhui.xin/p/%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8java%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/","title":"ä¼˜é›…çš„ä½¿ç”¨Javaåˆ†å¸ƒå¼é”"},{"content":"ç»§ä¸Šæ¬¡åˆ†äº«çš„GitHub actions å‘å¸ƒåˆ°GitHub pages,æ”¶åˆ°çš„åé¦ˆè¿˜ä¸é”™ï¼Œå’±ä»¬è¿™æ¬¡ä¹Ÿè®°å½•äº†ä¸‹ç¼–å†™è„šæœ¬çš„è¿‡ç¨‹ï¼Œè¿‡ç¨‹æ¯”è¾ƒåå·ï¼Œå¦‚æœåªè¦ç»“æœï¼Œè¯·çœ‹æ–‡ç« æœ€åå‡ ä¸ªæ¿å—çš„å†…å®¹ã€‚\nå‡†å¤‡å·¥ä½œ SSH key ç”Ÿæˆ 1 2 3 4 ssh-keygen -t rsa -b 4096 -C \u0026#34;$(git config user.email)\u0026#34; -f gh-pages -N \u0026#34;\u0026#34; # You will get 2 files: # gh-pages.pub (public key) # gh-pages (private key) é…ç½®ç§é’¥ å¦‚æœå‰é¢è¯»è¿‡æˆ‘çš„hugoé€šè¿‡Github Actionéƒ¨ç½²åˆ°Github Pagesæ–‡ç« ï¼Œé‚£ä¹ˆä¸€å®šçŸ¥é“æ€ä¹ˆå»ä¸Šä¼ å…¬é’¥ï¼Œè¿™é‡Œæˆ‘ä»¬å†é‡å¤ä¸€ä¸‹\nå‡è®¾ å¼€å‘é¡¹ç›®ä¸º tianhui.xin\næ‰“å¼€tianhui.xinä»“åº“çš„settingsï¼Œå†ç‚¹å‡»Secretsï¼Œç„¶åæ·»åŠ å’±ä»¬åˆšåˆšç”Ÿæˆçš„ç§é’¥ï¼Œnameä¸ºACTIONS_DEPLOY_KEY\nAdd your private key Success ä¸Šä¼ å…¬é’¥æœåŠ¡å™¨ 1 2 3 4 5 6 ssh-copy-id appuser@10.10.10.10 /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \u0026#34;/home/appuser/.ssh/id_rsa.pub\u0026#34; The authenticity of host \u0026#39;10.10.10.10 (10.10.10.10)\u0026#39; can\u0026#39;t be established. ECDSA key fingerprint is SHA256:mpM5LP8zLMh/CibV34URdTFbciAJ3fvCG1f9kSD2ITI. ECDSA key fingerprint is MD5:60:40:77:02:5b:c6:e0:9a:e7:a3:96:bf:10:da:12:1c. Are you sure you want to continue connecting (yes/no)? yes è¾“å…¥è¿œç¨‹ç”¨æˆ·çš„å¯†ç åï¼ŒSSHå…¬é’¥å°±ä¼šè‡ªåŠ¨ä¸Šä¼ äº†ï¼SSHå…¬é’¥ä¿å­˜åœ¨è¿œç¨‹LinuxæœåŠ¡å™¨çš„.ssh/authorized_keysæ–‡ä»¶ä¸­\næ€è€ƒ dockeré•œåƒæ¯æ¬¡éƒ½æ˜¯ä¸€ä¸ªæ–°çš„ï¼ŒSSHåœ¨ç¬¬ä¸€æ¬¡è¿æ¥éƒ½ä¼šè¯¢é—®è¿™ä¸ªä¸€ä¸ªé—®é¢˜\n1 2 3 4 5 6 7 The authenticity of host \u0026#39;10.10.10.10 (10.10.10.10)\u0026#39; can\u0026#39;t be established. RSA key fingerprint is 97:8c:1b:f2:6f:14:6b:5c:3b:ec:aa:46:46:74:7c:40. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added \u0026#39;10.10.10.10 (10.10.10.10)\u0026#39; (RSA) to the list of known hosts. Enter passphrase for key \u0026#39;/home/appuser/.ssh/id_rsa\u0026#39;: å…¶åŸå› æ˜¯å› ä¸º/home/appuser/.sshç›®å½•ä¸‹çš„known_hostsä¸å­˜åœ¨å¯¹ä½ æ­£è¦è¿æ¥çš„æœåŠ¡å™¨ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ æ˜¯ç¬¬ä¸€æ¬¡è¿æ¥ï¼›é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä¼ªé€ ä¸€ä¸ªå‘¢ï¼Œå–ï¼Œä½ è¿˜åˆ«è¯´ï¼Œæˆ‘è¿˜çœŸå»æŠŠè‡ªå·±ç”µè„‘ä¸Šçš„known_hostsçš„å¯¹åº”è®°å½•å¤åˆ¶äº†ä¸€ä»½ä¸Šå»ï¼Œæˆ‘ç®€ç›´æ˜¯ä¸ªå¤©æ‰ï¼Œä½†ç»“æœä¸å°½äººæ„ï¼Œå¥½å§ï¼Œå’±ä»¬ç»§ç»­æŠ˜è…¾ã€‚\nå¹¸è¿çš„æ˜¯æˆ‘åœ¨æ¢¯å­çš„å¸®åŠ©ä¸‹ï¼Œæ‰¾åˆ°äº†è¿™æ ·ä¸€ä¸ªå‘½ä»¤ssh-keyscanï¼Œæèµ·ğŸ¤•\n1 ssh-keyscan -t rsa 10.10.10.10 \u0026gt;\u0026gt; \u0026#34;/home/appuser/known_hosts\u0026#34; æ–°å»ºjobè„šæœ¬(æµ‹è¯•SSHè„šæœ¬) ä¸»è¦è¿‡ç¨‹å°±æ˜¯æµ‹è¯•ä¸‹åœ¨dockerç¯å¢ƒä¸‹å¦‚ä½•è¿œç¨‹SSHï¼Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 name: aliyun on: push: branches: - master jobs: build: runs-on: ubuntu-latest steps: - name: checkout uses: actions/checkout@master with: submodules: true - name: Setup Hugo uses: peaceiris/actions-hugo@v2.2.2 with: hugo-version: \u0026#39;0.59.1\u0026#39; extended: true - name: Build run: hugo --minify - name: Deploy env: ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }} HOST: 10.10.10.10 USER: appuser run: | SSH_PATH=\u0026#34;$HOME/.ssh\u0026#34; mkdir -p $SSH_PATH touch \u0026#34;$SSH_PATH/known_hosts\u0026#34; echo \u0026#34;$ACTIONS_DEPLOY_KEY\u0026#34; \u0026gt; \u0026#34;$SSH_PATH/id_rsa\u0026#34; chmod 700 \u0026#34;$SSH_PATH\u0026#34; chmod 600 \u0026#34;$SSH_PATH/known_hosts\u0026#34; chmod 600 \u0026#34;$SSH_PATH/id_rsa\u0026#34; eval $(ssh-agent) ssh-add \u0026#34;$SSH_PATH/id_rsa\u0026#34; ssh-keyscan -t rsa $HOST \u0026gt;\u0026gt; \u0026#34;$SSH_PATH/known_hosts\u0026#34; ssh -o StrictHostKeyChecking=no -i $SSH_PATH/id_rsa -A -tt $USER@$HOST ls æ‰§è¡Œpushï¼Œç­‰å¾…CIéƒ¨ç½²å®Œæˆï¼ŒæŸ¥çœ‹logå‘ç°å·²ç»æ‰“å°å‡ºäº†æœåŠ¡å™¨çš„æ–‡ä»¶æ–‡ä»¶å¤¹ä¿¡æ¯ï¼ŒğŸ˜„\næœ€ç»ˆçš„jobè„šæœ¬ é…ç½®è¯´æ˜ ä½¿ç”¨åªéœ€è¦å…³æ³¨deployä¸­çš„envé…ç½®\nconfig description ACTIONS_DEPLOY_KEY è¿æ¥æœåŠ¡çš„ç§é’¥(åœ¨GitHubé¡¹ç›®ä¸‹çš„setting\u0026gt;Secretsé…ç½®) HOST æœåŠ¡å™¨çš„IPåœ°å€ USER æœåŠ¡å™¨çš„éƒ¨ç½²ç”¨æˆ·ï¼Œå¯¹åº”çš„ç§é’¥çš„ç”¨æˆ· HOME_PATH ç™»é™†æœåŠ¡å™¨åï¼Œæˆ‘ä»¬å»å“ªä¸ªç›®å½•ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºç”¨æˆ·ç›®å½• DEVELOP_SH_PATH æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬(å’±ä»¬çš„éƒ¨ç½²ç›®å½•è¿˜æ˜¯æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œä¸å†™åœ¨jobä¸­) PACKAGE_NAME æ‰“åŒ…çš„åç§°(public.tar.gz),ç›®å‰åªæ”¯æŒè¿™ä¸ª DEVELOP_DIR é¡¹ç›®éƒ¨ç½²æ–‡ä»¶å¤¹ BACKUP_DIR é¡¹ç›®çš„å¤‡ä»½æ–‡ä»¶å¤¹ jobæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 name: aliyun on: push: branches: - master jobs: build: runs-on: ubuntu-latest steps: - name: checkout uses: actions/checkout@master with: submodules: true - name: setup Hugo uses: peaceiris/actions-hugo@v2.2.2 with: hugo-version: \u0026#39;0.59.1\u0026#39; extended: true - name: Build run: hugo --minify - name: deploy env: ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }} HOST: 10.10.10.10 USER: appuser HOME_PATH: /home/appuser DEVELOP_SH_PATH: /home/appuser/develop.sh PACKAGE_NAME: public.tar.gz DEVELOP_DIR: tianhui.xin BACKUP_DIR: backup run: | SSH_PATH=\u0026#34;$HOME/.ssh\u0026#34; mkdir -p $SSH_PATH touch \u0026#34;$SSH_PATH/known_hosts\u0026#34; echo \u0026#34;$ACTIONS_DEPLOY_KEY\u0026#34; \u0026gt; \u0026#34;$SSH_PATH/id_rsa\u0026#34; chmod 700 \u0026#34;$SSH_PATH\u0026#34; chmod 600 \u0026#34;$SSH_PATH/known_hosts\u0026#34; chmod 600 \u0026#34;$SSH_PATH/id_rsa\u0026#34; eval $(ssh-agent) ssh-add \u0026#34;$SSH_PATH/id_rsa\u0026#34; ssh-keyscan -t rsa $HOST \u0026gt;\u0026gt; \u0026#34;$SSH_PATH/known_hosts\u0026#34; cd public tar -cf $PACKAGE_NAME * scp $PACKAGE_NAME $USER@$HOST:$HOME_PATH ssh -o StrictHostKeyChecking=no -i $SSH_PATH/id_rsa -A -tt $USER@$HOST sh $DEVELOP_SH_PATH \\ -d $HOME_PATH/$DEVELOP_DIR -b $HOME_PATH/$BACKUP_DIR -f $HOME_PATH/$PACKAGE_NAME exit è¿œç¨‹æœåŠ¡å™¨æ“ä½œ æ–°å»ºdevelop.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 #!/bin/sh set -e FILE_NAME=`basename $0` #è¯´æ˜ show_usage=\u0026#34;usage:$FILE_NAME [-d develop_path,-b backup_path -f file_path]\u0026#34; #å‚æ•° # æœ¬åœ°ä»“åº“ç›®å½• opt_develop_path=\u0026#34;\u0026#34; # å¤‡ä»½ç›®å½• opt_backup_path=\u0026#34;\u0026#34; # éƒ¨ç½²æ–‡ä»¶ opt_file_path=\u0026#34;\u0026#34; GETOPT_ARGS=`getopt -o d:b:f: -al develop_path:,backup_path:,file_path: -- \u0026#34;$@\u0026#34;` eval set -- \u0026#34;$GETOPT_ARGS\u0026#34; #è·å–å‚æ•° while [ -n \u0026#34;$1\u0026#34; ] do case \u0026#34;$1\u0026#34; in -d|--develop_path) opt_develop_path=$2; shift 2;; -b|--backup_path) opt_backup_path=$2; shift 2;; -f|--opt_file_path) opt_file_path=$2; shift 2;; --) break ;; *) echo $1,$2,$show_usage; break ;; esac done # åˆ¤æ–­å‚æ•° if [[ -z $opt_develop_path || -z $opt_backup_path || -z $opt_file_path ]]; then echo -e $show_usage exit 0 fi if [ \u0026#34;$opt_develop_path\u0026#34; = \u0026#34;$opt_backup_path\u0026#34; ]; then echo \u0026#39;develop_path eq backup_path\u0026#39; exit 0 fi # åˆ¤æ–­éƒ¨ç½²æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if [ ! -f $opt_file_path ]; then echo \u0026#34;$opt_file_path file does not exist\u0026#34; exit 0 fi # åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ if [ ! -x $opt_develop_path ]; then mkdir $opt_develop_path fi # åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ if [ ! -x $opt_backup_path ]; then mkdir $opt_backup_path fi # æ–‡ä»¶å¤¹ä¸æ˜¯ç©ºçš„ if [ ! \u0026#34;`ls -A $opt_develop_path`\u0026#34; = \u0026#34;\u0026#34; ]; then cd $opt_develop_path tar -cf $opt_backup_path/$(date +%Y%m%d%H%M).tar.gz $opt_develop_path/* rm -rf $opt_develop_path/* fi # è§£å‹æ–‡ä»¶ tar -xf $opt_file_path -C $opt_develop_path echo \u0026#34;publish success!\u0026#34; ç»™äºˆæ‰§è¡Œæƒé™ 1 chomd u+x develop.sh ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œå¼€å§‹ä½ çš„å¥‡å¦™ä¹‹æ—…å§ï¼Œç å­—ä¸æ˜“ï¼Œæœ‰é—®é¢˜è¯·ç•™è¨€äº¤æµã€‚\nç›¸å…³æ–‡ç« :\nhugoé€šè¿‡Github Actionéƒ¨ç½²åˆ°Github Pages ","date":"2019-11-29T03:00:00Z","permalink":"https://tianhui.xin/p/%E9%80%9A%E8%BF%87github-actions%E5%8F%91%E5%B8%83hugo%E5%88%B0%E7%A7%81%E6%9C%89%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"é€šè¿‡GitHub actionså‘å¸ƒhugoåˆ°ç§æœ‰äº‘æœåŠ¡å™¨"},{"content":"æœ€è¿‘ä¸€æ®µæ—¶é—´ï¼ŒæŠŠåšå®¢ä»hexoè¿ç§»åˆ°äº†hugo,é¡ºä¾¿æ•´ç†ä¸‹ï¼Œä½¿ç”¨github actionsè‡ªåŠ¨éƒ¨ç½²åˆ°github pagesã€‚\nç¼–å†™è„šæœ¬ é¦–å…ˆæ‰“å¼€è‡ªå·±é¡¹ç›®ä¸­çš„Actions,è¿›å…¥ä¹‹åï¼Œå®ƒæœ‰å¾ˆå¤šçš„è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼Œæˆ‘ä»¬é€‰æ‹©Simple workflow é€‰æ‹©åï¼Œä¼šå‡ºç°ä¸€ä¸ªymlæ–‡ä»¶çš„ç¼–è¾‘å™¨ï¼Œé‡Œé¢çš„å†…å®¹æ˜¯è¿™æ ·çš„: 1 2 3 4 5 6 7 8 9 10 11 12 13 name: CI on: [push] jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v1 - name: Run a one-line script run: echo Hello, world! - name: Run a multi-line script run: | echo Add other actions to build, echo test, and deploy your project. æˆ‘ä»¬ç»“åˆä¸Šå›¾ï¼Œè¯´ä¸‹æ ‡æ³¨çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯githubçš„ä¸€ä¸ªäº®ç‚¹å§ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­ï¼Œä»–ä»¬æˆ‘ä»¬çš„yamæ–‡ä»¶è¿›è¡Œäº†è¯­æ³•çš„æ ¡éªŒï¼ŒåŒæ—¶ä¹Ÿåšäº›keyçš„æ ¡éªŒï¼Œæ¯”å¦‚å­˜åœ¨usersçš„æ—¶å€™ï¼Œå°±ä¸èƒ½å‡ºç°run,æˆ‘ä¸ªäººç†è§£ï¼Œusersæœ¬èº«å°±æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Œæ‰€ä»¥æ— æ³•å†å»æ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼›ç„¶åæ¨¡æ¿å¸‚åœºï¼Œé‡Œé¢æœ‰å¾ˆå¤šå¼€å‘è¯­è¨€çš„éƒ¨ç½²è„šæœ¬ï¼Œéƒ½æ˜¯å¤§ç‰›ä»¬å°è£…å¥½çš„ï¼Œæ‰¾åˆ°ç¬¦åˆè‡ªèº«é¡¹ç›®çš„ç›´æ¥ä½¿ç”¨å°±è¡Œã€‚\nè°ƒæ•´ymlæ–‡ä»¶å†…å®¹\nå› ä¸ºä½¿ç”¨çš„hugoçš„åšå®¢ï¼Œæ‰€ä»¥å®˜æ–¹æ˜¯æä¾›çš„è‡ªåŠ¨åŒ–è„šæœ¬çš„ï¼Œæˆ‘ä»¬å†æ­¤ä½¿ç”¨äº†ä¸¤ä¸ªå®˜æ–¹æä¾›çš„workflowã€‚\nåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 name: CI #è‡ªåŠ¨åŒ–çš„åç§° on: push: # pushçš„æ—¶å€™è§¦å‘ branches: # é‚£äº›åˆ†æ”¯éœ€è¦è§¦å‘ - master jobs: build: runs-on: ubuntu-latest # é•œåƒå¸‚åœº steps: - name: checkout # æ­¥éª¤çš„åç§° uses: actions/checkout@master #è½¯ä»¶å¸‚åœºçš„åç§° with: # å‚æ•° submodules: true - name: Setup Hugo uses: peaceiris/actions-hugo@v2.2.2 with: hugo-version: \u0026#39;0.59.1\u0026#39; extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v2.5.1 env: ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }} EXTERNAL_REPOSITORY: homeant/homeant.github.io PUBLISH_BRANCH: master PUBLISH_DIR: ./public å‡†å¤‡éƒ¨ç½² æˆ‘ä»¬å¼€å‘çš„é¡¹ç›®åŠgithub pageså®é™…æ˜¯åˆ†å¼€çš„ï¼Œæ‰€ä»¥å’±ä»¬å‡ºç°äº†ä¸¤ä¸ªä»“åº“ï¼Œé‚£æ€ä¹ˆåœ¨å¼€å‘é¡¹ç›®buiderå®Œæˆåï¼Œéƒ¨ç½²åˆ°github pageså‘¢ï¼Œåˆ«æ…Œï¼Œè·Ÿæˆ‘ä¸€æ­¥ä¸€æ­¥æ¥ã€‚\nç”Ÿæˆæäº¤ä»£ç ç”¨çš„ssh key 1 2 3 4 ssh-keygen -t rsa -b 4096 -C \u0026#34;$(git config user.email)\u0026#34; -f gh-pages -N \u0026#34;\u0026#34; # You will get 2 files: # gh-pages.pub (public key) # gh-pages (private key) å‡è®¾ å¼€å‘é¡¹ç›®ä¸º tianhui.xin éƒ¨ç½²çš„é¡¹ç›®ä¸º tianhui.github.io\næ‰“å¼€tianhui.xinä»“åº“çš„settingsï¼Œå†ç‚¹å‡»Secretsï¼Œç„¶åæ·»åŠ å’±ä»¬åˆšåˆšç”Ÿæˆçš„ç§é’¥ï¼Œnameä¸ºACTIONS_DEPLOY_KEY\nåŒç†ï¼Œæ‰“å¼€tianhui.github.ioï¼Œç‚¹å‡»Deploy keysï¼Œæ·»åŠ å…¬é’¥ï¼ŒAllow write accessä¸€å®šè¦å‹¾ä¸Šï¼Œå¦åˆ™ä¼šæ— æ³•æäº¤\nAdd your public key Success Add your private key Success ç„¶åï¼Œä½ å°±å¯ä»¥æäº¤ä»£ç äº†ï¼ŒpushæˆåŠŸåï¼Œæ‰“å¼€ä»“åº“actionsï¼Œè‡³æ­¤éƒ¨ç½²æˆåŠŸï¼Œå¤§åŠŸå‘Šæˆï¼\nç›¸å…³æ–‡ç« :\né€šè¿‡GitHub actionså‘å¸ƒhugoåˆ°ç§æœ‰äº‘æœåŠ¡å™¨ ","date":"2019-11-17T03:00:00Z","permalink":"https://tianhui.xin/p/hugo%E9%80%9A%E8%BF%87github-action%E9%83%A8%E7%BD%B2%E5%88%B0github-pages/","title":"hugoé€šè¿‡Github Actionéƒ¨ç½²åˆ°Github Pages"},{"content":"Nginxï¼ˆå‘éŸ³åŒengine xï¼‰æ˜¯å¼‚æ­¥æ¡†æ¶çš„ç½‘é¡µæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œåå‘ä»£ç†ã€è´Ÿè½½å¹³è¡¡å™¨å’ŒHTTPç¼“å­˜ã€‚2019å¹´3æœˆ11æ—¥ï¼ŒNginxå…¬å¸è¢«F5 Networksä»¥6.7äº¿ç¾å…ƒæ”¶è´­ã€‚\nåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦åœ¨linuxæœåŠ¡ä¸­å®‰è£…nginx,ä»Šå¤©æˆ‘ä¸ºå¤§å®¶å¸¦æ¥ï¼Œå¦‚ä½•åœ¨linuxç³»ç»Ÿä¸­æ­£ç¡®çš„å®‰è£…nginxã€‚\nå®‰è£…gcc g++ centos æ‰§è¡Œ 1 2 yum -y install gcc automake autoconf libtool make yum install gcc gcc-c++ ububtu æ‰§è¡Œ 1 2 apt-get install build-essential apt-get install libtool å®‰è£…pcre 1 2 3 4 5 6 7 cd /usr/local/src/ wget https://ftp.pcre.org/pub/pcre/pcre-8.43.tar.gz tar -zxvf pcre-8.43.tar.gz cd pcre-8.43 ./configure make make install å®‰è£…zlib 1 2 3 4 5 6 wget http://www.zlib.net/zlib-1.2.11.tar.gz tar -zxvf zlib-1.2.11.tar.gz cd zlib-1.2.11 ./configure make make install å®‰è£…openssl 1 yum -y install openssl openssl-devel å®‰è£…nginx 1 2 3 4 5 6 wget http://nginx.org/download/nginx-1.14.2.tar.gz tar -zxvf nginx-1.14.2.tar.gz cd nginx-1.1.10 ./configure --prefix=/opt/software/nginx --with-http_stub_status_module --with-http_ssl_module make make install ","date":"2019-10-31T21:49:20Z","permalink":"https://tianhui.xin/p/linux-%E5%AE%89%E8%A3%85nginx/","title":"linux å®‰è£…nginx"},{"content":"åœ¨é¡¹ç›®å¼€å‘çš„å®é™…è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦ç”Ÿæˆidï¼Œæˆ–è€…è®¢å•å·çš„ä¸šåŠ¡ï¼Œå¦‚æœåªæ˜¯ä¿è¯å”¯ä¸€ï¼Œæˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ä¸‹ï¼Œåªéœ€è¦è€ƒè™‘é›ªèŠ±ç®—æ³•å°±å¯ä»¥è½»æ¾å®ç°ï¼Œé‚£ä¹ˆæ€ä¹ˆå»ç”Ÿæˆæœ‰è§„åˆ™æœ‰é¡ºåºçš„å•å·å‘¢ã€‚\nè¡¨ç»“æ„ æ³¨ï¼šæ•°æ®åº“å­—æ®µä¸­å‡ºç°tenant_idåŠversion_å¯ä»¥æ— è§†ï¼Œæ™¨ä½¿ç”¨çš„jpaæ¡†æ¶ï¼Œå…¶ä»–æ¡†æ¶å¯ä»¥è‡ªè¡Œæ‰©å±•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 CREATE TABLE `t_generator` ( `id` bigint(20) NOT NULL, `tenant_id` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL, `version_` bigint(20) NULL DEFAULT NULL, `seq_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL, `expression` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL, `value` bigint(20) NULL DEFAULT NULL, `increment` bigint(20) NULL DEFAULT NULL, `length` int(11) NOT NULL, PRIMARY KEY (`id`) USING BTREE ) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin ROW_FORMAT = Compact; å®ä½“ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 @Data public class GeneratorEO{ private Long id; /** * åºåˆ—åç§° */ private String seqName; /** * æ‰§è¡Œè¡¨è¾¾å¼ */ private String expression; /** * å½“å‰å€¼ */ private Long value; /** * è‡ªå¢å€¼ */ private Long increment; /** * åºå·çš„é•¿åº¦(ä½æ•°) */ private int length; } æ ¸å¿ƒé€»è¾‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 @Transactional @Override public Object get(String seqName, String tenantId) { GeneratorEO generatorEO = baseRepository.findOne((root, criteriaQuery, criteriaBuilder) -\u0026gt; criteriaBuilder.equal(root.get(GeneratorEO.SEQ_NAME), seqName)).orElse(null); Object value = null; if (generatorEO != null) { ExpressionParser parser = new SpelExpressionParser(); EvaluationContext context = new StandardEvaluationContext(); Expression exp; Long oldValue = generatorEO.getValue(); String expression = generatorEO.getExpression(); context.setVariable(\u0026#34;tenantId\u0026#34;,generatorEO.getTenantId()); if(generatorEO.getLength()\u0026gt;0){ context.setVariable(\u0026#34;value\u0026#34;,String.format(\u0026#34;%0\u0026#34;+generatorEO.getLength()+\u0026#34;d\u0026#34;,oldValue)); }else{ context.setVariable(\u0026#34;value\u0026#34;,oldValue); } if (StringUtils.isNotBlank(expression)) { exp = parser.parseExpression(expression); } else { exp = parser.parseExpression(\u0026#34;#value\u0026#34;); } value = exp.getValue(context); exp = parser.parseExpression(\u0026#34;#value + #increment\u0026#34;); context.setVariable(\u0026#34;value\u0026#34;,oldValue); context.setVariable(\u0026#34;increment\u0026#34;,generatorEO.getIncrement()); Long newValue = (Long)exp.getValue(context); generatorEO.setValue(newValue); baseRepository.flush(); } return value; } å‚è€ƒèµ„æ–™ Spring Expression Language\n","date":"2019-10-30T16:58:34Z","permalink":"https://tianhui.xin/p/%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%BB%E9%94%AE_%E8%AE%A2%E5%8D%95%E5%8F%B7%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/","title":"åŸºäºæ•°æ®åº“çš„ä¸»é”®_è®¢å•å·ç”Ÿæˆç­–ç•¥"},{"content":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä» Apache2.0 åè®®å¼€æºã€‚\nDocker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚\nå®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚\nDocker ä» 17.03 ç‰ˆæœ¬ä¹‹ååˆ†ä¸º CEï¼ˆCommunity Edition: ç¤¾åŒºç‰ˆï¼‰ å’Œ EEï¼ˆEnterprise Edition: ä¼ä¸šç‰ˆï¼‰ï¼Œæˆ‘ä»¬ç”¨ç¤¾åŒºç‰ˆå°±å¯ä»¥äº†ã€‚\n1ã€docker -h å¸®åŠ©\n2ã€è·å–é•œåƒ\nsudo docker pull NAME[:TAG]\nsudo docker pull centos:latest\n3ã€å¯åŠ¨Containerç›’å­\nsudo docker run [OPTIONS] IMAGE [COMMAND] [ARG\u0026hellip;]\nsudp docker run -t -i contos /bin/bash\n4ã€æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼Œåˆ—å‡ºæœ¬åœ°çš„æ‰€æœ‰images\nsudo docker images [OPTIONS] [NAME]\nsudo docker images centos\n5ã€æŸ¥çœ‹å®¹å™¨åˆ—è¡¨ï¼Œå¯çœ‹åˆ°æˆ‘ä»¬åˆ›å»ºè¿‡çš„æ‰€æœ‰container\nsudo docker ps [OPTIONS]\nsudo docker ps -a\n6ã€åˆ é™¤é•œåƒï¼Œä»æœ¬åœ°åˆ é™¤ä¸€ä¸ªå·²ç»ä¸‹è½½çš„é•œåƒ\nsudo docker rmi IMAGE [IMAGE\u0026hellip;]\nsudo docker rmi centos:latest\n7ã€ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å®ä¾‹\nsudo docker rm [OPTIONS] CONTAINER [CONTAINER\u0026hellip;]\nç§»é™¤æ‰€æœ‰å¾®è¿è¡Œçš„å®¹å™¨\nsudo docker rm sudo docker ps -aq\n8ã€åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨\nsudo docker kill [OPTIONS] CONTAINER [CONTAINNER\u0026hellip;]\nsudo docker kill 026e\n9ã€é‡å¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨\nsudo docker restart [OPTIONS] contains[CONTAINER]\nsudo docker restart 026e\n10ã€åœæ­¢ä¸€ä¸ªå·²ç»åœæ­¢çš„å®¹å™¨\nsudo docker start [OPTIONS] CONTAINER [CONTAINER..]\nsudo docker start 026e\n11ã€è¿›å…¥æŸä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨\ndocker exec [OPTIONS] [CONTAINER][COMMAND]\ndocker exec -it cloud-config /bin/bash\n","date":"2019-10-29T15:39:26Z","permalink":"https://tianhui.xin/p/docker%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/","title":"dockerå‘½ä»¤å¤§å…¨"},{"content":"ideaä½œä¸ºç›®å‰javaå¼€å‘æœ€å¸¸ç”¨çš„å·¥å…·ï¼Œé’ˆå¯¹å…¶ä½¿ç”¨æ•´ç†äº†ä¸€äº›å¿«æ·é”®ï¼Œä½ ç»å¯¹èƒ½ç”¨åˆ°\nå¸¸è§„ Ctrl+Shift + Enterï¼Œè¯­å¥å®Œæˆ\n\u0026ldquo;!\u0026quot;ï¼Œå¦å®šå®Œæˆï¼Œè¾“å…¥è¡¨è¾¾å¼æ—¶æŒ‰ \u0026ldquo;!\u0026ldquo;é”®\nCtrl+Eï¼Œæœ€è¿‘çš„æ–‡ä»¶\nCtrl+Shift+Eï¼Œæœ€è¿‘æ›´æ”¹çš„æ–‡ä»¶\nShift+Clickï¼Œå¯ä»¥å…³é—­æ–‡ä»¶\nCtrl+[ OR ]ï¼Œå¯ä»¥è·‘åˆ°å¤§æ‹¬å·çš„å¼€å¤´ä¸ç»“å°¾\nCtrl+F12ï¼Œå¯ä»¥æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„ç»“æ„\nCtrl+F7ï¼Œå¯ä»¥æŸ¥è¯¢å½“å‰å…ƒç´ åœ¨å½“å‰æ–‡ä»¶ä¸­çš„å¼•ç”¨ï¼Œç„¶åæŒ‰ F3 å¯ä»¥é€‰æ‹©\nCtrl+Nï¼Œå¯ä»¥å¿«é€Ÿæ‰“å¼€ç±»\nCtrl+Shift+Nï¼Œå¯ä»¥å¿«é€Ÿæ‰“å¼€æ–‡ä»¶\nAlt+Qï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æ–¹æ³•çš„å£°æ˜\nCtrl+Pï¼Œå¯ä»¥æ˜¾ç¤ºå‚æ•°ä¿¡æ¯\nCtrl+Shift+Insertï¼Œå¯ä»¥é€‰æ‹©å‰ªè´´æ¿å†…å®¹å¹¶æ’å…¥\nAlt+Insertï¼Œå¯ä»¥ç”Ÿæˆæ„é€ å™¨/Getter/Setterç­‰\nCtrl+Alt+Vï¼Œå¯ä»¥å¼•å…¥å˜é‡ã€‚ä¾‹å¦‚ï¼šnew String(); è‡ªåŠ¨å¯¼å…¥å˜é‡å®šä¹‰\nCtrl+Alt+Tï¼Œå¯ä»¥æŠŠä»£ç åŒ…åœ¨ä¸€ä¸ªå—å†…ï¼Œä¾‹å¦‚ï¼štry/catch\nCtrl+Enterï¼Œå¯¼å…¥åŒ…ï¼Œè‡ªåŠ¨ä¿®æ­£\nCtrl+Alt+Lï¼Œæ ¼å¼åŒ–ä»£ç \nCtrl+Alt+Iï¼Œå°†é€‰ä¸­çš„ä»£ç è¿›è¡Œè‡ªåŠ¨ç¼©è¿›ç¼–æ’ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨ç¼–è¾‘ JSP æ–‡ä»¶æ—¶ä¹Ÿå¯ä»¥å·¥ä½œ\nCtrl+Alt+Oï¼Œä¼˜åŒ–å¯¼å…¥çš„ç±»å’ŒåŒ…\nCtrl+Rï¼Œæ›¿æ¢æ–‡æœ¬\nCtrl+Fï¼ŒæŸ¥æ‰¾æ–‡æœ¬\nCtrl+Shift+Spaceï¼Œè‡ªåŠ¨è¡¥å…¨ä»£ç \nCtrl+ç©ºæ ¼ï¼Œä»£ç æç¤ºï¼ˆä¸ç³»ç»Ÿè¾“å…¥æ³•å¿«æ·é”®å†²çªï¼‰\nCtrl+Shift+Alt+Nï¼ŒæŸ¥æ‰¾ç±»ä¸­çš„æ–¹æ³•æˆ–å˜é‡\nAlt+Shift+Cï¼Œæœ€è¿‘çš„æ›´æ”¹\nAlt+Shift+Up/Downï¼Œä¸Š/ä¸‹ç§»ä¸€è¡Œ\nShift+F6ï¼Œé‡æ„ - é‡å‘½å\nCtrl+Xï¼Œåˆ é™¤è¡Œ\nCtrl+Dï¼Œå¤åˆ¶è¡Œ\nCtrl+/æˆ–Ctrl+Shift+/ï¼Œæ³¨é‡Šï¼ˆ//æˆ–è€…/**/ï¼‰\nCtrl+Jï¼Œè‡ªåŠ¨ä»£ç ï¼ˆä¾‹å¦‚ï¼šserrï¼‰\nCtrl+Alt+Jï¼Œç”¨åŠ¨æ€æ¨¡æ¿ç¯ç»•\nCtrl+Hï¼Œæ˜¾ç¤ºç±»ç»“æ„å›¾ï¼ˆç±»çš„ç»§æ‰¿å±‚æ¬¡ï¼‰\nCtrl+Qï¼Œæ˜¾ç¤ºæ³¨é‡Šæ–‡æ¡£\nAlt+F1ï¼ŒæŸ¥æ‰¾ä»£ç æ‰€åœ¨ä½ç½®\nAlt+1ï¼Œå¿«é€Ÿæ‰“å¼€æˆ–éšè—å·¥ç¨‹é¢æ¿\nCtrl+Alt+left/rightï¼Œè¿”å›è‡³ä¸Šæ¬¡æµè§ˆçš„ä½ç½®\nAlt+left/rightï¼Œåˆ‡æ¢ä»£ç è§†å›¾\nAlt+Up/Downï¼Œåœ¨æ–¹æ³•é—´å¿«é€Ÿç§»åŠ¨å®šä½\nCtrl+Shift+Up/Downï¼Œå‘ä¸Š/ä¸‹ç§»åŠ¨è¯­å¥\nF2 æˆ– Shift+F2ï¼Œé«˜äº®é”™è¯¯æˆ–è­¦å‘Šå¿«é€Ÿå®šä½\nTabï¼Œä»£ç æ ‡ç­¾è¾“å…¥å®Œæˆåï¼ŒæŒ‰ Tabï¼Œç”Ÿæˆä»£ç \nCtrl+Shift+F7ï¼Œé«˜äº®æ˜¾ç¤ºæ‰€æœ‰è¯¥æ–‡æœ¬ï¼ŒæŒ‰ Esc é«˜äº®æ¶ˆå¤±\nAlt+F3ï¼Œé€ä¸ªå¾€ä¸‹æŸ¥æ‰¾ç›¸åŒæ–‡æœ¬ï¼Œå¹¶é«˜äº®æ˜¾ç¤º\nCtrl+Up/Downï¼Œå…‰æ ‡ä¸­è½¬åˆ°ç¬¬ä¸€è¡Œæˆ–æœ€åä¸€è¡Œä¸‹\nCtrl+B/Ctrl+Clickï¼Œå¿«é€Ÿæ‰“å¼€å…‰æ ‡å¤„çš„ç±»æˆ–æ–¹æ³•ï¼ˆè·³è½¬åˆ°å®šä¹‰å¤„ï¼‰\nCtrl+Alt+Bï¼Œè·³è½¬åˆ°æ–¹æ³•å®ç°å¤„\nCtrl+Shift+Backspaceï¼Œè·³è½¬åˆ°ä¸Šæ¬¡ç¼–è¾‘çš„åœ°æ–¹\nCtrl+Oï¼Œé‡å†™æ–¹æ³•\nCtrl+Alt+Spaceï¼Œç±»åè‡ªåŠ¨å®Œæˆ\nCtrl+Alt+Up/Downï¼Œå¿«é€Ÿè·³è½¬æœç´¢ç»“æœ\nCtrl+Shift+Jï¼Œæ•´åˆä¸¤è¡Œ\nAlt+F8ï¼Œè®¡ç®—å˜é‡å€¼\nCtrl+Shift+Vï¼Œå¯ä»¥å°†æœ€è¿‘ä½¿ç”¨çš„å‰ªè´´æ¿å†…å®¹é€‰æ‹©æ’å…¥åˆ°æ–‡æœ¬\nCtrl+Alt+Shift+Vï¼Œç®€å•ç²˜è´´\nShift+Escï¼Œä¸ä»…å¯ä»¥æŠŠç„¦ç‚¹ç§»åˆ°ç¼–è¾‘å™¨ä¸Šï¼Œè€Œä¸”è¿˜å¯ä»¥éšè—å½“å‰ï¼ˆæˆ–æœ€åæ´»åŠ¨çš„ï¼‰å·¥å…·çª—å£\nF12ï¼ŒæŠŠç„¦ç‚¹ä»ç¼–è¾‘å™¨ç§»åˆ°æœ€è¿‘ä½¿ç”¨çš„å·¥å…·çª—å£\nShift+F1ï¼Œè¦æ‰“å¼€ç¼–è¾‘å™¨å…‰æ ‡å­—ç¬¦å¤„ä½¿ç”¨çš„ç±»æˆ–è€…æ–¹æ³• Java æ–‡æ¡£çš„æµè§ˆå™¨\nCtrl+Wï¼Œå¯ä»¥é€‰æ‹©å•è¯ç»§è€Œè¯­å¥ç»§è€Œè¡Œç»§è€Œå‡½æ•°\nCtrl+Shift+Wï¼Œå–æ¶ˆé€‰æ‹©å…‰æ ‡æ‰€åœ¨è¯\nAlt+F7ï¼ŒæŸ¥æ‰¾æ•´ä¸ªå·¥ç¨‹ä¸­ä½¿ç”¨åœ°æŸä¸€ä¸ªç±»ã€æ–¹æ³•æˆ–è€…å˜é‡çš„ä½ç½®\nCtrl+Iï¼Œå®ç°æ–¹æ³•\nCtrl+Shift+Uï¼Œå¤§å°å†™è½¬åŒ–\nCtrl+Yï¼Œåˆ é™¤å½“å‰è¡Œ\nShift+Enterï¼Œå‘ä¸‹æ’å…¥æ–°è¡Œ\npsvm/soutï¼Œmain/System.out.println(); Ctrl+Jï¼ŒæŸ¥çœ‹æ›´å¤š\nCtrl+Shift+Fï¼Œå…¨å±€æŸ¥æ‰¾\nCtrl+Fï¼ŒæŸ¥æ‰¾/Shift+F3ï¼Œå‘ä¸ŠæŸ¥æ‰¾/F3ï¼Œå‘ä¸‹æŸ¥æ‰¾\nCtrl+Shift+Sï¼Œé«˜çº§æœç´¢\nCtrl+Uï¼Œè½¬åˆ°çˆ¶ç±»\nCtrl+Alt+Sï¼Œæ‰“å¼€è®¾ç½®å¯¹è¯æ¡†\nAlt+Shift+Inertï¼Œå¼€å¯/å…³é—­åˆ—é€‰æ‹©æ¨¡å¼\nCtrl+Alt+Shift+Sï¼Œæ‰“å¼€å½“å‰é¡¹ç›®/æ¨¡å—å±æ€§\nCtrl+Gï¼Œå®šä½è¡Œ\nAlt+Homeï¼Œè·³è½¬åˆ°å¯¼èˆªæ \nCtrl+Enterï¼Œä¸Šæ’ä¸€è¡Œ\nCtrl+Backspaceï¼ŒæŒ‰å•è¯åˆ é™¤\nCtrl+\u0026quot;+/-\u0026quot;ï¼Œå½“å‰æ–¹æ³•å±•å¼€ã€æŠ˜å \nCtrl+Shift+\u0026quot;+/-\u0026quot;ï¼Œå…¨éƒ¨å±•å¼€ã€æŠ˜å \nè°ƒè¯•éƒ¨åˆ†ã€ç¼–è¯‘ Ctrl+F2ï¼Œåœæ­¢\nAlt+Shift+F9ï¼Œé€‰æ‹© Debug\nAlt+Shift+F10ï¼Œé€‰æ‹© Run\nCtrl+Shift+F9ï¼Œç¼–è¯‘\nCtrl+Shift+F10ï¼Œè¿è¡Œ\nCtrl+Shift+F8ï¼ŒæŸ¥çœ‹æ–­ç‚¹\nF8ï¼Œæ­¥è¿‡\nF7ï¼Œæ­¥å…¥\nShift+F7ï¼Œæ™ºèƒ½æ­¥å…¥\nShift+F8ï¼Œæ­¥å‡º\nAlt+Shift+F8ï¼Œå¼ºåˆ¶æ­¥è¿‡\nAlt+Shift+F7ï¼Œå¼ºåˆ¶æ­¥å…¥\nAlt+F9ï¼Œè¿è¡Œè‡³å…‰æ ‡å¤„\nCtrl+Alt+F9ï¼Œå¼ºåˆ¶è¿è¡Œè‡³å…‰æ ‡å¤„\nF9ï¼Œæ¢å¤ç¨‹åº\nAlt+F10ï¼Œå®šä½åˆ°æ–­ç‚¹\nCtrl+F8ï¼Œåˆ‡æ¢è¡Œæ–­ç‚¹\nCtrl+F9ï¼Œç”Ÿæˆé¡¹ç›®\nAlt+1ï¼Œé¡¹ç›®\nAlt+2ï¼Œæ”¶è—\nAlt+6ï¼ŒTODO\nAlt+7ï¼Œç»“æ„\nCtrl+Shift+Cï¼Œå¤åˆ¶è·¯å¾„\nCtrl+Alt+Shift+Cï¼Œå¤åˆ¶å¼•ç”¨ï¼Œå¿…é¡»é€‰æ‹©ç±»å\nCtrl+Alt+Yï¼ŒåŒæ­¥\nCtrl+~ï¼Œå¿«é€Ÿåˆ‡æ¢æ–¹æ¡ˆï¼ˆç•Œé¢å¤–è§‚ã€ä»£ç é£æ ¼ã€å¿«æ·é”®æ˜ å°„ç­‰èœå•ï¼‰\nShift+F12ï¼Œè¿˜åŸé»˜è®¤å¸ƒå±€\nCtrl+Shift+F12ï¼Œéšè—/æ¢å¤æ‰€æœ‰çª—å£\nCtrl+F4ï¼Œå…³é—­\nCtrl+Shift+F4ï¼Œå…³é—­æ´»åŠ¨é€‰é¡¹å¡\nCtrl+Tabï¼Œè½¬åˆ°ä¸‹ä¸€ä¸ªæ‹†åˆ†å™¨\nCtrl+Shift+Tabï¼Œè½¬åˆ°ä¸Šä¸€ä¸ªæ‹†åˆ†å™¨\né‡æ„ Ctrl+Alt+Shift+Tï¼Œå¼¹å‡ºé‡æ„èœå•\nShift+F6ï¼Œé‡å‘½å\nF6ï¼Œç§»åŠ¨\nF5ï¼Œå¤åˆ¶\nAlt+Deleteï¼Œå®‰å…¨åˆ é™¤\nCtrl+Alt+Nï¼Œå†…è”\næŸ¥æ‰¾ Ctrl+Fï¼ŒæŸ¥æ‰¾\nCtrl+Rï¼Œæ›¿æ¢\nF3ï¼ŒæŸ¥æ‰¾ä¸‹ä¸€ä¸ª\nShift+F3ï¼ŒæŸ¥æ‰¾ä¸Šä¸€ä¸ª\nCtrl+Shift+Fï¼Œåœ¨è·¯å¾„ä¸­æŸ¥æ‰¾\nCtrl+Shift+Rï¼Œåœ¨è·¯å¾„ä¸­æ›¿æ¢\nCtrl+Shift+Sï¼Œæœç´¢ç»“æ„\nCtrl+Shift+Mï¼Œæ›¿æ¢ç»“æ„\nAlt+F7ï¼ŒæŸ¥æ‰¾ç”¨æ³•\nCtrl+Alt+F7ï¼Œæ˜¾ç¤ºç”¨æ³•\nCtrl+F7ï¼Œåœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾ç”¨æ³•\nCtrl+Shift+F7ï¼Œåœ¨æ–‡ä»¶ä¸­é«˜äº®æ˜¾ç¤ºç”¨æ³•\nVCS Alt+~ï¼ŒVCS æ“ä½œèœå•\nCtrl+Kï¼Œæäº¤æ›´æ”¹\nCtrl+Tï¼Œæ›´æ–°é¡¹ç›®\nCtrl+Alt+Shift+Dï¼Œæ˜¾ç¤ºå˜åŒ–ã€å¸¸è§„ã€‘\n","date":"2019-10-29T15:39:26Z","permalink":"https://tianhui.xin/p/idea-%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/","title":"idea å¸¸ç”¨å¿«æ·é”®"},{"content":"spring-integrationæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„EIP(Enterprise Integration Patterns)ï¼Œå³ä¼ä¸šé›†æˆæ¨¡å¼ã€‚å¯¹ï¼Œspring-integrationæ˜¯ä¸€ä¸ªé›†å¤§æˆè€…ã€‚å°±æˆ‘è‡ªå·±çš„ç†è§£ï¼Œé›†æˆäº†ä¼—å¤šåŠŸèƒ½çš„å®ƒï¼Œæ˜¯ä¸€ç§ä¾¿æ·çš„äº‹ä»¶é©±åŠ¨æ¶ˆæ¯æ¡†æ¶ç”¨æ¥åœ¨ç³»ç»Ÿä¹‹é—´åšæ¶ˆæ¯ä¼ é€’çš„ã€‚ ä»Šå¤©æˆ‘ä»¬æ¥æ¢ç´¢ä¸€ä¸‹å¦‚æœä½¿ç”¨å®ƒå‘é€httpè¯·æ±‚ã€‚\nä»€ä¹ˆæ˜¯Spring Integration Spring Integrationåœ¨åŸºäºSpringçš„åº”ç”¨ç¨‹åºä¸­å®ç°è½»é‡çº§æ¶ˆæ¯ä¼ é€’ï¼Œå¹¶æ”¯æŒé€šè¿‡å£°æ˜é€‚é…å™¨ä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆã€‚ Spring Integrationçš„ä¸»è¦ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªç®€å•çš„æ¨¡å‹æ¥æ„å»ºä¼ä¸šé›†æˆè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¿æŒå…³æ³¨ç‚¹çš„åˆ†ç¦»ï¼Œè¿™å¯¹äºç”Ÿæˆå¯ç»´æŠ¤ï¼Œå¯æµ‹è¯•çš„ä»£ç è‡³å…³é‡è¦ã€‚Spring Frameworké¼“åŠ±å¼€å‘äººå‘˜ä½¿ç”¨æ¥å£è¿›è¡Œç¼–ç ï¼Œå¹¶ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ä¸ºæ™®é€šæ—§Javaå¯¹è±¡ï¼ˆPOJOï¼‰æä¾›æ‰§è¡Œå…¶ä»»åŠ¡æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚ Spring Integrationå°†è¿™ä¸€æ¦‚å¿µæ›´è¿›ä¸€æ­¥ï¼Œå…¶ä¸­POJOä½¿ç”¨æ¶ˆæ¯ä¼ é€’èŒƒä¾‹è¿æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å„ä¸ªç»„ä»¶å¯èƒ½ä¸äº†è§£åº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–ç»„ä»¶ã€‚è¿™ç§åº”ç”¨ç¨‹åºæ˜¯é€šè¿‡ç»„è£…ç»†ç²’åº¦å¯é‡ç”¨ç»„ä»¶æ¥æ„å»ºçš„ï¼Œä»¥å½¢æˆæ›´é«˜çº§åˆ«çš„åŠŸèƒ½ã€‚é€šè¿‡ç²¾å¿ƒè®¾è®¡ï¼Œè¿™äº›æµç¨‹å¯ä»¥æ¨¡å—åŒ–ï¼Œå¹¶åœ¨æ›´é«˜çš„å±‚æ¬¡ä¸Šé‡å¤ä½¿ç”¨ã€‚\nå®˜æ–¹åœ°å€ï¼šspring-integration\nç»„æˆ Spring Integration ä¸»è¦æœ‰Messageã€Channelã€Message EndPointç»„æˆã€‚\nMessage Messageæ˜¯ç”¨æ¥åœ¨ä¸åŒéƒ¨åˆ†ä¹‹é—´ä¼ é€’çš„æ•°æ®ã€‚Messageæœ‰ä¸¤éƒ¨åˆ†ç»„æˆ:æ¶ˆæ¯ä½“(payload)ä¸æ¶ˆæ¯å¤´(header)ã€‚æ¶ˆæ¯ä½“å¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç±»å‹ï¼›æ¶ˆæ¯å¤´è¡¨ç¤ºçš„å…ƒæ•°æ®å°±æ˜¯è§£é‡Šæ¶ˆæ¯ä½“çš„å†…å®¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /** * A generic message representation with headers and body. * * @author Mark Fisher * @author Arjen Poutsma * @since 4.0 * @see org.springframework.messaging.support.MessageBuilder */ public interface Message\u0026lt;T\u0026gt; { /** * Return the message payload. */ T getPayload(); /** * Return message headers for the message (never {@code null} but may be empty). */ MessageHeaders getHeaders(); } Channel åœ¨æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯åˆ°é€šé“(Channel)ï¼Œæ¶ˆæ¯æ¥å—è€…ä»é€šé“(Channel)æ¥æ”¶æ¶ˆæ¯ã€‚ MessageChannel æœ‰ä¸¤å¤§å­æ¥å£ï¼Œåˆ†åˆ«æ˜¯PollableChannel (å¯è½®è¯¢)å’ŒSubscribableChannel(å¯è®¢é˜…)ã€‚æˆ‘ä»¬æ‰€æœ‰çš„æ¶ˆæ¯é€šé“ç±»éƒ½æ˜¯ç°å®è¿™ä¸¤ä¸ªæ¥å£ã€‚\nMessageChannel MessageChannel æ˜¯Spring Integrationæ¶ˆæ¯é€šé“çš„é¡¶çº§æ¥å£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 public interface MessageChannel { /** * Constant for sending a message without a prescribed timeout. */ long INDEFINITE_TIMEOUT = -1; /** * Send a {@link Message} to this channel. If the message is sent successfully, * the method returns {@code true}. If the message cannot be sent due to a * non-fatal reason, the method returns {@code false}. The method may also * throw a RuntimeException in case of non-recoverable errors. * \u0026lt;p\u0026gt;This method may block indefinitely, depending on the implementation. * To provide a maximum wait time, use {@link #send(Message, long)}. * @param message the message to send * @return whether or not the message was sent */ boolean send(Message\u0026lt;?\u0026gt; message); /** * Send a message, blocking until either the message is accepted or the * specified timeout period elapses. * @param message the message to send * @param timeout the timeout in milliseconds or {@link #INDEFINITE_TIMEOUT} * @return {@code true} if the message is sent, {@code false} if not * including a timeout of an interrupt of the send */ boolean send(Message\u0026lt;?\u0026gt; message, long timeout); } PollableChannel PollableChannel å…·å¤‡è½®è¯¢è·å¾—æ¶ˆæ¯çš„èƒ½åŠ›ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public interface PollableChannel extends MessageChannel { /** * Receive a message from this channel, blocking indefinitely if necessary. * @return the next available {@link Message} or {@code null} if interrupted */ Message\u0026lt;?\u0026gt; receive(); /** * Receive a message from this channel, blocking until either a message is available * or the specified timeout period elapses. * @param timeout the timeout in milliseconds or {@link MessageChannel#INDEFINITE_TIMEOUT}. * @return the next available {@link Message} or {@code null} if the specified timeout * period elapses or the message reception is interrupted */ Message\u0026lt;?\u0026gt; receive(long timeout); } SubscribableChannel SubscribableChannel å‘é€æ¶ˆæ¯ç»™è®¢é˜…äº†MessageHanlderçš„è®¢é˜…è€…\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public interface SubscribableChannel extends MessageChannel { /** * Register a message handler. * @return {@code true} if the handler was subscribed or {@code false} if it * was already subscribed. */ boolean subscribe(MessageHandler handler); /** * Un-register a message handler. * @return {@code true} if the handler was un-registered, or {@code false} * if was not registered. */ boolean unsubscribe(MessageHandler handler); } æ¶ˆæ¯é€šé“ PublishSubscribeChannel PublishSubscribeChannelå…è®¸å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è®¢é˜…è€…ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 /** * å…è®¸å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è®¢é˜…è€…ï¼Œå½“å‰æ¶ˆæ¯é€šé“çš„idä¸ºpublishSubscribeChannel * @return */ @Bean public PublishSubscribeChannel publishSubscribeChannel(){ PublishSubscribeChannel channel = new PublishSubscribeChannel(); return channel; } QueueChannel QueueChannelå…è®¸æ¶ˆæ¯æ¥æ”¶è€…è½®è¯¢è·å¾—æ¶ˆæ¯ï¼Œç”¨ä¸€ä¸ªé˜Ÿåˆ—(queue)æ¥æ”¶æ¶ˆæ¯ï¼Œé˜Ÿåˆ—çš„å®¹é‡å¤§å°å¯é…ç½®ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 @Bean public QueueChannel queueChannel(){ QueueChannel channel = new QueueChannel(10);//10çš„é˜Ÿåˆ—çš„å®¹é‡ return channel; } PriorityChannel PriorityChannelå¯æŒ‰ç…§ä¼˜å…ˆçº§å°†æ•°æ®å­˜å‚¨åˆ°é˜Ÿåˆ—ï¼Œå®ƒä¾æ®äºæ¶ˆæ¯çš„æ¶ˆæ¯å¤´priorityå±æ€§ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 @Bean public PriorityChannel priorityChannel(){ PriorityChannel channel = new PriorityChannel(10); return channel; } RendezvousChannel RendezvousChannelç¡®ä¿æ¯ä¸€ä¸ªæ¥æ”¶è€…éƒ½æ¥æ”¶åˆ°æ¶ˆæ¯åå†å‘é€æ¶ˆæ¯ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 @Bean public RendezvousChannel rendezvousChannel(){ RendezvousChannel channel = new RendezvousChannel(); return channel; } DirectChannel DirectChannelæ˜¯Spring Integrationé»˜è®¤çš„æ¶ˆæ¯é€šé“ï¼Œå®ƒå…è®¸å°†æ¶ˆæ¯å‘é€ç»™ä¸ºä¸€ä¸ªè®¢é˜…è€…ï¼Œç„¶åé˜»ç¢å‘é€ç›´åˆ°æ¶ˆæ¯è¢«æ¥æ”¶ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 @Bean public DirectChannel directChannel(){ DirectChannel channel = new DirectChannel(); return channel; } ExecutorChannel ExecutorChannelå¯ç»‘å®šä¸€ä¸ªå¤šçº¿ç¨‹çš„task executorï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Bean public ExecutorChannel executorChannel(){ ExecutorChannel channel = new ExecutorChannel(executor()); return channel; } @Bean public Executor executor(){ ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor(); taskExecutor.setCorePoolSize(5); taskExecutor.setMaxPoolSize(10); taskExecutor.setQueueCapacity(25); taskExecutor.initialize(); return taskExecutor; } é€šé“æ‹¦æˆªå™¨ ChannelInterceptor Spring Integrationç»™æ¶ˆæ¯é€šé“æä¾›äº†é€šé“æ‹¦æˆªå™¨(ChannelInterceptor)ï¼Œç”¨æ¥æ‹¦æˆªå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ“ä½œã€‚ ChannelInterceptoræ¥å£å®šä¹‰å¦‚ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°è¿™ä¸ªæ¥å£å³å¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public interface ChannelInterceptor { Message\u0026lt;?\u0026gt; preSend(Message\u0026lt;?\u0026gt; message, MessageChannel channel); void postSend(Message\u0026lt;?\u0026gt; message, MessageChannel channel, boolean sent); void afterSendCompletion(Message\u0026lt;?\u0026gt; message, MessageChannel channel, boolean sent, Exception ex); boolean preReceive(MessageChannel channel); Message\u0026lt;?\u0026gt; postReceive(Message\u0026lt;?\u0026gt; message, MessageChannel channel); void afterReceiveCompletion(Message\u0026lt;?\u0026gt; message, MessageChannel channel, Exception ex); } Message EndPoint æ¶ˆæ¯ç«¯ç‚¹(Message EndPoint)æ˜¯çœŸæ­£å¤„ç†æ¶ˆæ¯çš„(Message)ç»„ä»¶ï¼Œå®ƒè¿˜å¯ä»¥æ§åˆ¶é€šé“çš„è·¯ç”±ã€‚\nChannel Adapter é€šé“é€‚é…å™¨(Channel Adapter)æ˜¯ä¸€ç§è¿æ¥å¤–éƒ¨ç³»ç»Ÿæˆ–ä¼ è¾“åè®®çš„ç«¯ç‚¹(EndPoint)ï¼Œå¯ä»¥åˆ†ä¸ºå…¥ç«™(inbound)å’Œå‡ºç«™(outbound)ã€‚Â é€šé“é€‚é…å™¨æ˜¯å•å‘çš„ï¼Œå…¥ç«™é€šé“é€‚é…å™¨åªæ”¯æŒæ¥æ”¶æ¶ˆæ¯ï¼Œå‡ºç«™é€šé“é€‚é…å™¨åªæ”¯æŒè¾“å‡ºæ¶ˆæ¯ã€‚ Spring Integrationå†…ç½®äº†å¦‚ä¸‹çš„é€‚é…å™¨ï¼š\n1 RabbitMQã€Feedã€Fileã€FTP/SFTPã€Gemfireã€HTTPã€TCP/UDPã€JDBCã€JPAã€JMSã€Mailã€MongoDBã€Redisã€RMITwitterã€XMPPã€WebServices(SOAPã€REST)ã€WebSocket Gateway æ¶ˆæ¯ç½‘å…³(Gateway)ç±»ä¼¼äºAdapterï¼Œä½†æ˜¯æä¾›äº†åŒå‘çš„è¯·æ±‚/è¿”å›é›†æˆæ–¹å¼ï¼Œä¹Ÿåˆ†ä¸ºå…¥ç«™(inbound)å’Œå‡ºç«™(outbound)ã€‚Â Spring Integration å¯¹å“åº”çš„Adapteréƒ½æä¾›äº†Gatewayã€‚\nService Activator Service Activator å¯è°ƒç”¨Springçš„Beanæ¥å¤„ç†æ¶ˆæ¯ï¼Œå¹¶å°†å¤„ç†åçš„ç»“æœè¾“å‡ºåˆ°æŒ‡å®šçš„æ¶ˆæ¯é€šé“ã€‚\nRouter è·¯ç”±(Router) å¯æ ¹æ®æ¶ˆæ¯ä½“å†…å®¹(Payload Type Router)ã€æ¶ˆæ¯å¤´çš„å€¼(Header Value Router) ä»¥åŠå®šä¹‰å¥½çš„æ¥æ”¶è¡¨(Recipient List Router) ä½œä¸ºæ¡ä»¶ï¼Œæ¥å†³å®šæ¶ˆæ¯ä¼ é€’åˆ°çš„é€šé“ã€‚\nFilter è¿‡æ»¤å™¨(Filter) ç±»ä¼¼äºè·¯ç”±(Router)ï¼Œä¸åŒçš„æ˜¯è¿‡æ»¤å™¨ä¸å†³å®šæ¶ˆæ¯è·¯ç”±åˆ°å“ªé‡Œï¼Œè€Œæ˜¯å†³å®šæ¶ˆæ¯æ˜¯å¦å¯ä»¥ä¼ é€’ç»™æ¶ˆæ¯é€šé“ã€‚\nSplitter æ‹†åˆ†å™¨(Splitter)å°†æ¶ˆæ¯æ‹†åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†å•ç‹¬å¤„ç†ï¼Œæ‹†åˆ†å™¨å¤„ç†çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªé›†åˆæˆ–è€…æ•°ç»„ã€‚\nAggregator èšåˆå™¨(Aggregator)ä¸æ‹†åˆ†å™¨ç›¸åï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªjava.util.Listä½œä¸ºå‚æ•°ï¼Œå°†å¤šä¸ªæ¶ˆæ¯åˆå¹¶ä¸ºä¸€ä¸ªæ¶ˆæ¯ã€‚\nEnricher å½“æˆ‘ä»¬ä»å¤–éƒ¨è·å¾—æ¶ˆæ¯åï¼Œéœ€è¦å¢åŠ é¢å¤–çš„æ¶ˆæ¯åˆ°å·²æœ‰çš„æ¶ˆæ¯ä¸­ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨æ¶ˆæ¯å¢å¼ºå™¨(Enricher)ã€‚æ¶ˆæ¯å¢å¼ºå™¨ä¸»è¦æœ‰æ¶ˆæ¯ä½“Â å¢å¼ºå™¨(Payload Enricher)å’Œæ¶ˆæ¯å¤´å¢å¼ºå™¨(Header Enricher)ä¸¤ç§ã€‚\nTransformer è½¬æ¢å™¨(Transformer)æ˜¯å¯¹è·å¾—çš„æ¶ˆæ¯è¿›è¡Œä¸€å®šçš„è½¬æ¢å¤„ç†(å¦‚æ•°æ®æ ¼å¼è½¬æ¢)ã€‚\nBridge ä½¿ç”¨è¿æ¥æ¡¥(Bridge)å¯ä»¥ç®€å•çš„å°†ä¸¤ä¸ªæ¶ˆæ¯é€šé“è¿æ¥èµ·æ¥ã€‚\nå¿«é€Ÿå…¥é—¨ é˜…è¯»å®˜æ–¹æ–‡æ¡£å®ƒæ˜¯è¿™æ ·æè¿°çš„ï¼š\nIn the following \u0026ldquo;quick start\u0026rdquo; application you can see that the same gateway interface is used to invoke two completely different service implementations. To build and run this program you will need theÂ spring-integration-wsÂ andÂ spring-integration-xmlÂ modules as described above.\nå¤§æ¦‚æ„æ€æ˜¯ä½¿ç”¨è¿™ä¸ªç¤ºä¾‹ï¼Œéœ€è¦spring-integration-wså’Œspring-integration-xmlä¸¤ä¸ªæ¨¡å—ï¼ŒåŒæ—¶å®ƒä½¿ç”¨äº†ç›¸åŒçš„ç½‘å…³æ¥å£è°ƒç”¨äº†ä¸¤ä¸ªä¸åŒçš„æœåŠ¡å®ç°ã€‚\nç¼–å†™å¿«é€Ÿå¯åŠ¨ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class Main { public static void main(String... args) throws Exception { ApplicationContext ctx = new ClassPathXmlApplicationContext(\u0026#34;context.xml\u0026#34;); // Simple Service TempConverter converter = ctx.getBean(\u0026#34;simpleGateway\u0026#34;, TempConverter.class); System.out.println(converter.fahrenheitToCelcius(68.0f)); // Web Service converter = ctx.getBean(\u0026#34;wsGateway\u0026#34;, TempConverter.class); System.out.println(converter.fahrenheitToCelcius(68.0f)); } } ç¼–å†™æ¥å£ç±» 1 2 3 4 5 public interface TempConverter { float fahrenheitToCelcius(float fahren); } ç¼–å†™xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;!-- Simple Service --\u0026gt; \u0026lt;!-- ç½‘å…³:simpleGateway --\u0026gt; \u0026lt;int:gateway id=\u0026#34;simpleGateway\u0026#34; service-interface=\u0026#34;foo.TempConverter\u0026#34; default-request-channel=\u0026#34;simpleExpression\u0026#34; /\u0026gt; \u0026lt;int:service-activator id=\u0026#34;expressionConverter\u0026#34; input-channel=\u0026#34;simpleExpression\u0026#34; expression=\u0026#34;(payload - 32) / 9 * 5\u0026#34;/\u0026gt; \u0026lt;!-- Web Service --\u0026gt; \u0026lt;int:gateway id=\u0026#34;wsGateway\u0026#34; service-interface=\u0026#34;foo.TempConverter\u0026#34; default-request-channel=\u0026#34;viaWebService\u0026#34; /\u0026gt; \u0026lt;int:chain id=\u0026#34;wsChain\u0026#34; input-channel=\u0026#34;viaWebService\u0026#34;\u0026gt; \u0026lt;int:transformer expression=\u0026#34;\u0026#39;\u0026amp;lt;FahrenheitToCelsius xmlns=\u0026amp;quot;https://www.w3schools.com/xml/\u0026amp;quot;\u0026amp;gt;\u0026amp;lt;Fahrenheit\u0026amp;gt;XXX\u0026amp;lt;/Fahrenheit\u0026amp;gt;\u0026amp;lt;/FahrenheitToCelsius\u0026amp;gt;\u0026#39;.replace(\u0026#39;XXX\u0026#39;, payload.toString())\u0026#34; /\u0026gt; \u0026lt;int-ws:header-enricher\u0026gt; \u0026lt;int-ws:soap-action value=\u0026#34;https://www.w3schools.com/xml/FahrenheitToCelsius\u0026#34;/\u0026gt; \u0026lt;/int-ws:header-enricher\u0026gt; \u0026lt;int-ws:outbound-gateway uri=\u0026#34;https://www.w3schools.com/xml/tempconvert.asmx\u0026#34;/\u0026gt; \u0026lt;int-xml:xpath-transformer xpath-expression=\u0026#34;/*[local-name()=\u0026#39;FahrenheitToCelsiusResponse\u0026#39;]/*[local-name()=\u0026#39;FahrenheitToCelsiusResult\u0026#39;]\u0026#34;/\u0026gt;\u0026lt;/int:chain\u0026gt; å’¦ï¼Œå«Œå¼ƒï¼Œå’Œæˆ‘ä»¬æƒ³ç”¨çš„å†…å®¹æœ‰å·®è·å•Šï¼Œ,æ—¢ç„¶ç”¨SpringBooté‚£å°±å¾—è·Ÿä¸ŠèŠ‚å¥ï¼ŒJavaBeané…ç½®ï¼Œæ¥ç€å¾€ä¸‹çœ‹\nAnd here is the same application (web service part) using theÂ Java DSLÂ (and Spring Boot). You will need theÂ spring-boot-starter-integrationÂ dependency orÂ spring-integration-java-dslÂ directly if you donâ€™t use Spring Boot. If you use Spring Integration starting versionÂ 5.0, you donâ€™t need any additional dependencies - the Java DSL is included to the core project\nè¿›å…¥æ­£é¢˜äº†ï¼Œå¤§æ„æ˜¯ä½¿ç”¨JavaBeané…ç½®æˆ–è€…spring bootçš„ç¤ºä¾‹ï¼Œå¦‚æœä¸å®ç”¨Spring Booté‚£ä¹ˆå°±éœ€è¦å’±ä»¬æ‰‹åŠ¨åŠ å…¥spring-boot-starter-integrationæˆ–è€…spring-integration-java-dslæ‰€ä¾èµ–çš„æ¨¡å—ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯5.0åŠä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ ä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥ä¾èµ–ï¼ŒJava DSLå·²ç»åŒ…å«åœ¨å…¶ä¸­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @Configuration @SpringBootApplication @IntegrationComponentScan public class Application { public static void main(String[] args) { ConfigurableApplicationContext ctx = SpringApplication.run(Application.class, args); TempConverter converter = ctx.getBean(TempConverter.class); System.out.println(converter.fahrenheitToCelcius(68.0f)); ctx.close(); } @MessagingGateway public interface TempConverter { @Gateway(requestChannel = \u0026#34;convert.input\u0026#34;) float fahrenheitToCelcius(float fahren); } @Bean public IntegrationFlow convert() { return f -\u0026gt; f .transform(payload -\u0026gt; \u0026#34;\u0026lt;FahrenheitToCelsius xmlns=\\\u0026#34;https://www.w3schools.com/xml/\\\u0026#34;\u0026gt;\u0026#34; + \u0026#34;\u0026lt;Fahrenheit\u0026gt;\u0026#34; + payload + \u0026#34;\u0026lt;/Fahrenheit\u0026gt;\u0026#34; + \u0026#34;\u0026lt;/FahrenheitToCelsius\u0026gt;\u0026#34;) .enrichHeaders(h -\u0026gt; h .header(WebServiceHeaders.SOAP_ACTION, \u0026#34;https://www.w3schools.com/xml/FahrenheitToCelsius\u0026#34;)) .handle(new SimpleWebServiceOutboundGateway( \u0026#34;https://www.w3schools.com/xml/tempconvert.asmx\u0026#34;)) .transform(Transformers.xpath(\u0026#34;/*[local-name()=\\\u0026#34;FahrenheitToCelsiusResponse\\\u0026#34;]\u0026#34; + \u0026#34;/*[local-name()=\\\u0026#34;FahrenheitToCelsiusResult\\\u0026#34;]\u0026#34;)); } } å¼€å§‹ä½¿ç”¨ ç¿»é˜…äº†ä¸€éå®˜ç½‘çš„samplesï¼Œæ ¹æœ¬æ²¡æ‰¾åˆ°httpæ–¹å¼å…³äºSpringBootçš„ç¤ºä¾‹ï¼Œæ²¡äº‹ï¼Œå’±ä»¬æ´»å­¦æ´»ç”¨ï¼Œå‚è€ƒå…¶ä»–æ¨¡å—ï¼Œç›´æ¥ä¸Šä»£ç \npomä¸­åŠ å…¥ä¾èµ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-integration\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.integration\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-integration-http\u0026lt;/artifactId\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;artifactId\u0026gt;jackson-module-kotlin\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.fasterxml.jackson.module\u0026lt;/groupId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; ç¼–å†™æµ‹è¯•ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 @Slf4j @RunWith(SpringRunner.class) @SpringBootTest public class ApplicationTest { @Autowired private Config.TempConverter tempConverter; @Test public void test() { //å­—ç¬¦ä¸²æ–¹å¼ final String info = tempConverter.hello(\u0026#34;homeant\u0026#34;); log.debug(\u0026#34;info:{}\u0026#34;, info); //å®ä½“å¯¹è±¡æ–¹å¼ log.debug(\u0026#34;userInfo:{}\u0026#34;, tempConverter.userInfo(\u0026#34;homeant\u0026#34;)); } @Configuration @EnableIntegration @IntegrationComponentScan @EnableAutoConfiguration public static class Config { @MessagingGateway public interface TempConverter { @Gateway(requestChannel = \u0026#34;convert.input\u0026#34;) String hello(String name); @Gateway(requestChannel = \u0026#34;userInfo.input\u0026#34;) UserInfo userInfo(String name); } @Bean public IntegrationFlow convert() { return f -\u0026gt; f.handle(Http.outboundGateway(\u0026#34;https://api.github.com/users/{name}\u0026#34;) .httpMethod(HttpMethod.GET) .expectedResponseType(String.class).uriVariable(\u0026#34;name\u0026#34;, r -\u0026gt; r.getPayload())) .log(LoggingHandler.Level.DEBUG).bridge(); } @Bean public IntegrationFlow userInfo() { return f -\u0026gt; f.handle(Http.outboundGateway(\u0026#34;https://api.github.com/users/{name}\u0026#34;) .uriVariable(\u0026#34;name\u0026#34;, r -\u0026gt; r.getPayload()) .httpMethod(HttpMethod.GET) .expectedResponseType(UserInfo.class)) .log(LoggingHandler.Level.DEBUG).bridge(); } } } å¯åŠ¨æµ‹è¯•ç±» 1 2 [2019-09-30 22:11:54.977] [main] [DEBUG] [fun.vyse.cloud.test.ApplicationTest :34 ] - info:{\u0026#34;login\u0026#34;:\u0026#34;homeant\u0026#34;,\u0026#34;id\u0026#34;:28803295,\u0026#34;node_id\u0026#34;:\u0026#34;MDQ6VXNlcjI4ODAzMjk1\u0026#34;,\u0026#34;avatar_url\u0026#34;:\u0026#34;https://avatars0.githubusercontent.com/u/28803295?v=4\u0026#34;,\u0026#34;gravatar_id\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;url\u0026#34;:\u0026#34;https://api.github.com/users/homeant\u0026#34;,\u0026#34;html_url\u0026#34;:\u0026#34;https://github.com/homeant\u0026#34;,\u0026#34;followers_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/followers\u0026#34;,\u0026#34;following_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/following{/other_user}\u0026#34;,\u0026#34;gists_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/gists{/gist_id}\u0026#34;,\u0026#34;starred_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/starred{/owner}{/repo}\u0026#34;,\u0026#34;subscriptions_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/subscriptions\u0026#34;,\u0026#34;organizations_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/orgs\u0026#34;,\u0026#34;repos_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/repos\u0026#34;,\u0026#34;events_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/events{/privacy}\u0026#34;,\u0026#34;received_events_url\u0026#34;:\u0026#34;https://api.github.com/users/homeant/received_events\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;User\u0026#34;,\u0026#34;site_admin\u0026#34;:false,\u0026#34;name\u0026#34;:\u0026#34;ä¿Šæ™¨\u0026#34;,\u0026#34;company\u0026#34;:null,\u0026#34;blog\u0026#34;:\u0026#34;https://tianhui.xin\u0026#34;,\u0026#34;location\u0026#34;:\u0026#34;China-BeiJing\u0026#34;,\u0026#34;email\u0026#34;:null,\u0026#34;hireable\u0026#34;:null,\u0026#34;bio\u0026#34;:\u0026#34;é«˜å±±ä»°æ­¢ï¼Œæ™¯è¡Œè¡Œæ­¢ã€‚è™½ä¸èƒ½è‡³ï¼Œå¿ƒå‘å¾€ä¹‹\u0026#34;,\u0026#34;public_repos\u0026#34;:15,\u0026#34;public_gists\u0026#34;:0,\u0026#34;followers\u0026#34;:3,\u0026#34;following\u0026#34;:3,\u0026#34;created_at\u0026#34;:\u0026#34;2017-05-19T08:53:17Z\u0026#34;,\u0026#34;updated_at\u0026#34;:\u0026#34;2019-09-27T06:10:27Z\u0026#34;} [2019-09-30 22:11:55.971] [main] [DEBUG] [fun.vyse.cloud.test.ApplicationTest :35 ] - userInfo:UserInfo(login=homeant, id=28803295, node_id=MDQ6VXNlcjI4ODAzMjk1, avatar_url=https://avatars0.githubusercontent.com/u/28803295?v=4, gravatar_id=, url=https://api.github.com/users/homeant, html_url=https://github.com/homeant, followers_url=https://api.github.com/users/homeant/followers, following_url=https://api.github.com/users/homeant/following{/other_user}, gists_url=https://api.github.com/users/homeant/gists{/gist_id}, starred_url=https://api.github.com/users/homeant/starred{/owner}{/repo}, subscriptions_url=https://api.github.com/users/homeant/subscriptions, organizations_url=https://api.github.com/users/homeant/orgs, repos_url=https://api.github.com/users/homeant/repos, events_url=https://api.github.com/users/homeant/events{/privacy}, received_events_url=https://api.github.com/users/homeant/received_events, type=User, site_admin=false, name=ä¿Šæ™¨, company=null, blog=https://tianhui.xin, location=China-BeiJing, email=null, hireable=null, bio=é«˜å±±ä»°æ­¢ï¼Œæ™¯è¡Œè¡Œæ­¢ã€‚è™½ä¸èƒ½è‡³ï¼Œå¿ƒå‘å¾€ä¹‹, public_repos=15, public_gists=0, followers=3, following=3, created_at=2017-05-19T08:53:17Z, updated_at=2019-09-27T06:10:27Z) å‚è€ƒæ–‡æ¡£\nspring-integration-samples\nspring-integrationåˆæ¢\nspring doc\n","date":"2019-09-30T22:59:24Z","permalink":"https://tianhui.xin/p/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8springintegration/","title":"SpringBootä¸­ä½¿ç”¨SpringIntegration"},{"content":"åœ¨å­¦ä¹ Spring Bootçš„è¿‡ç¨‹ä¸­ï¼Œæ¥è§¦æœ€å¤šçš„å°±æ˜¯starterã€‚ä½¿ç”¨è€…å¯ä»¥æŠŠstarterå½“æˆæ˜¯ä¸€ç§æœåŠ¡ï¼Œä½¿å¾—ä½¿ç”¨æŸä¸ªåŠŸèƒ½æ—¶ä¸éœ€è¦å…³æ³¨å„ç§ä¾èµ–åº“çš„å¤„ç†ï¼Œä¸éœ€è¦å…·ä½“çš„é…ç½®ä¿¡æ¯ï¼Œç”±Spring Bootè‡ªåŠ¨é€šè¿‡classpathè·¯å¾„ä¸‹çš„ç±»å‘ç°éœ€è¦çš„Beanï¼Œå¹¶ç»‡å…¥beanã€‚è€Œè‡ªåŠ¨è£…é…å°±æ˜¯Springbootæœ€å¤§çš„ç‰¹æ€§ã€‚\nä»€ä¹ˆæ˜¯å®šåˆ¶starter springBootå®˜æ–¹æ¨å‡ºäº†å¾ˆå¤šçš„starterï¼Œé‚£ä¹ˆåœ¨è¿™äº›starterçš„èƒŒåï¼Œå®ƒçš„å¯åŠ¨æµç¨‹æ˜¯ä»€ä¹ˆï¼ŸstarteråŒ…å«ä¸¤å¤§æ¨¡å—ï¼š\nautoconfigure è‡ªåŠ¨é…ç½®ç±» starter åŒ…å«autoconfigureé…ç½®å’Œå…¶ä»–çš„ä¾èµ– åŠ å…¥springBootä¾èµ– 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-configuration-processor\u0026lt;/artifactId\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-autoconfigure\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; ç¼–å†™beanå¯¹è±¡ 1 2 3 4 5 public class Hello { public void say(String msg){ System.out.println(msg); } } ç¼–å†™starter 1 2 3 4 5 6 7 @Configuration public class DemoAutoConfiguration { @Bean public Hello hello() { return new Hello(); } } ç¼–å†™spring.factories åœ¨ src/main/resources ç›®å½•ä¸‹æ–°å»º META-INF æ–‡ä»¶å¤¹ï¼Œç„¶åæ–°å»º spring.factories æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨äºå‘Šè¯‰Spring Bootæœ‰é‚£äº›è‡ªåŠ¨é…ç½®ç±»éœ€è¦å¤„ç†ï¼Œå› æ­¤å®ƒçš„å†…å®¹æ˜¯\n1 2 org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\ xin.tianhui.cloud.starter.DemoAutoConfiguration ä½¿ç”¨ åœ¨ä½¿ç”¨çš„é¡¹ç›®ä¸­åŠ å…¥mavenä¾èµ–,ä¹Ÿå°±æ˜¯å’±ä»¬åˆšåˆšå†™å¥½çš„starter\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;xin.tianhui.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;demo-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä»£ç ä¸­æ³¨å…¥starteråˆå§‹åŒ–å¥½çš„bean 1 2 3 4 5 6 7 8 public class Application{ @Autowired private Hello hello; public void test(){ hello.say(\u0026#34;hello\u0026#34;); } } ","date":"2019-09-08T13:05:34Z","permalink":"https://tianhui.xin/p/springboot-%E5%AE%9A%E5%88%B6%E8%87%AA%E5%B7%B1%E7%9A%84starter/","title":"springBoot å®šåˆ¶è‡ªå·±çš„starter"},{"content":"BeanFactoryï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£å·¥å‚ç±»ï¼Œç”¨äºç®¡ç†springä¸­çš„Beanã€‚åœ¨Springä¸­ï¼ŒBeanFactoryæ˜¯IOCå®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒçš„èŒè´£åŒ…æ‹¬ï¼šå®ä¾‹åŒ–ã€å®šä½ã€é…ç½®åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡åŠå»ºç«‹è¿™äº›å¯¹è±¡é—´çš„ä¾èµ–ã€‚ Springä¸ºæˆ‘ä»¬æä¾›äº†è®¸å¤šæ˜“ç”¨çš„BeanFactoryå®ç°ï¼ŒXmlBeanFactoryå°±æ˜¯å¸¸ç”¨çš„ä¸€ä¸ªï¼Œè¯¥å®ç°å°†ä»¥XMLæ–¹å¼æè¿°ç»„æˆåº”ç”¨çš„å¯¹è±¡åŠå¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ã€‚XmlBeanFactoryç±»å°†æŒæœ‰æ­¤XMLé…ç½®å…ƒæ•°æ®ï¼Œå¹¶ç”¨å®ƒæ¥æ„å»ºä¸€ä¸ªå®Œå…¨å¯é…ç½®çš„ç³»ç»Ÿæˆ–åº”ç”¨ã€‚\nBeanFactoryæ¥å£ æ˜¯Spring beanå®¹å™¨çš„æ ¹æ¥å£.æä¾›è·å–bean,æ˜¯å¦åŒ…å«bean,æ˜¯å¦å•ä¾‹ä¸åŸå‹,è·å–beanç±»å‹,bean åˆ«åçš„æ–¹æ³• BeanFactoryçš„ä¸‰ä¸ªå­æ¥å£ HierarchicalBeanFactoryï¼šæä¾›çˆ¶å®¹å™¨çš„è®¿é—®åŠŸèƒ½ ListableBeanFactoryï¼šæä¾›äº†æ‰¹é‡è·å–Beançš„æ–¹æ³• AutowireCapableBeanFactoryï¼šåœ¨BeanFactoryåŸºç¡€ä¸Šå®ç°å¯¹å·²å­˜åœ¨å®ä¾‹çš„ç®¡ç† ConfigurableBeanFactory ConfigurableListableBeanFactory ç»§æ‰¿äº†ä¸Šè¿°çš„æ‰€æœ‰æ¥å£ï¼Œå¢åŠ äº†å…¶ä»–åŠŸèƒ½ï¼šæ¯”å¦‚ç±»åŠ è½½å™¨,ç±»å‹è½¬åŒ–,å±æ€§ç¼–è¾‘å™¨,BeanPostProcessor,ä½œç”¨åŸŸ,beanå®šä¹‰,å¤„ç†beanä¾èµ–å…³ç³», beanå¦‚ä½•é”€æ¯â€¦ å®ç°ç±»DefaultListableBeanFactory å®ç°äº†ConfigurableListableBeanFactoryï¼Œå®ç°ä¸Šè¿°BeanFactoryæ‰€æœ‰åŠŸèƒ½ã€‚å®ƒè¿˜å¯ä»¥æ³¨å†ŒBeanDefinition ClassPathXmlApplicationContextæ˜¯BeanFactoryçš„ä¸€ä¸ªå…¸å‹çš„å®ç°ï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯ ApplicationContextçš„å­ç±»ï¼ŒClassPathXmlApplicationContextä» xml çš„é…ç½®æ–‡ä»¶ä¸­è·å– bean å¹¶ä¸”ç®¡ç†ä»–ä»¬ã€‚\n1 2 3 4 5 public static void main(String[] args) throws Exception { BeanFactory bf = new ClassPathXmlApplicationContext(\u0026#34;application.xml\u0026#34;); UserHandler userHandler = (UserHandler) bf.getBean(\u0026#34;userHandler\u0026#34;); log.info(\u0026#34;handler:{}\u0026#34;,userHandler); } xmlé…ç½® 1 2 3 \u0026lt;bean id=\u0026#34;userHandler\u0026#34; class=\u0026#34;fun.vyse.cloud.UserHandler\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;userService\u0026#34; ref=\u0026#34;userService\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; æ–‡ç« å‚è€ƒï¼šã€Spring4æ­ç§˜ BeanFactoryã€‘åŸºæœ¬å®¹å™¨-BeanFactory\næœªå®Œå¾…ç»­\u0026hellip;\n","date":"2019-04-22T14:03:17Z","image":"https://image.tianhui.xin/spring/beanFactory/01.png?x-oss-process=style/make","permalink":"https://tianhui.xin/p/beanfactory%E8%AF%A6%E8%A7%A3/","title":"BeanFactoryè¯¦è§£"},{"content":"activitiè¡¨ç»“æ„\nè¡¨ç»“æ„ è¡¨åˆ†ç±» è¡¨å è§£é‡Š ä¸€èˆ¬æ•°æ® ACT_GE_BYTEARRAY é€šç”¨çš„æµç¨‹å®šä¹‰å’Œæµç¨‹èµ„æº ACT_GE_PROPERTY ç³»ç»Ÿç›¸å…³å±æ€§ æµç¨‹å†å²è®°å½• ACT_HI_ACTINST å†å²çš„æµç¨‹å®ä¾‹ ACT_HI_ATTACHMENT å†å²çš„æµç¨‹é™„ä»¶ ACT_HI_COMMENT å†å²çš„è¯´æ˜æ€§ä¿¡æ¯ ACT_HI_DETAIL å†å²çš„æµç¨‹è¿è¡Œä¸­çš„ç»†èŠ‚ä¿¡æ¯ ACT_HI_IDENTITYLINK å†å²çš„æµç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ç”¨æˆ·å…³ç³» ACT_HI_PROCINST å†å²çš„æµç¨‹å®ä¾‹ ACT_HI_TASKINST å†å²çš„ä»»åŠ¡å®ä¾‹ ACT_HI_VARINST å†å²çš„æµç¨‹è¿è¡Œä¸­çš„å˜é‡ä¿¡æ¯ ç”¨æˆ·ç”¨æˆ·ç»„è¡¨ ACT_ID_GROUP èº«ä»½ä¿¡æ¯-ç»„ä¿¡æ¯ ACT_ID_INFO èº«ä»½ä¿¡æ¯-ç»„ä¿¡æ¯ ACT_ID_MEMBERSHIP èº«ä»½ä¿¡æ¯-ç”¨æˆ·å’Œç»„å…³ç³»çš„ä¸­é—´è¡¨ ACT_ID_USER èº«ä»½ä¿¡æ¯-ç”¨æˆ·ä¿¡æ¯ æµç¨‹å®šä¹‰è¡¨ ACT_RE_DEPLOYMENT éƒ¨ç½²å•å…ƒä¿¡æ¯ ACT_RE_MODEL æ¨¡å‹ä¿¡æ¯ ACT_RE_PROCDEF å·²éƒ¨ç½²çš„æµç¨‹å®šä¹‰ è¿è¡Œå®ä¾‹è¡¨ ACT_RU_EVENT_SUBSCR è¿è¡Œæ—¶äº‹ä»¶ ACT_RU_EXECUTION è¿è¡Œæ—¶æµç¨‹æ‰§è¡Œå®ä¾‹ ACT_RU_IDENTITYLINK è¿è¡Œæ—¶ç”¨æˆ·å…³ç³»ä¿¡æ¯ ACT_RU_JOB è¿è¡Œæ—¶ä½œä¸š ACT_RU_TASK è¿è¡Œæ—¶ä»»åŠ¡ ACT_RU_VARIABLE è¿è¡Œæ—¶å˜é‡è¡¨ æµç¨‹æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 /*å¾—åˆ°æµç¨‹*/ SELECT ACT_RE_PROCDEF.ID_, ACT_RE_PROCDEF.NAME_, ACT_RE_PROCDEF.DESCRIPTION_ FROM ACT_RE_PROCDEF LEFT JOIN ACT_RE_DEPLOYMENT ON ACT_RE_PROCDEF.DEPLOYMENT_ID_ = ACT_RE_DEPLOYMENT.ID_ WHERE ACT_RE_PROCDEF.KEY_ = ?; æŸ¥è¯¢æµç¨‹æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 SELECT art.ID_, art.art.EXECUTION_ID_, art.PROC_INST_ID_, art.NAME_, art.ASSIGNEE_, art.CREATE_TIME_ FROM ACT_RU_TASK art WHERE art.PROC_DEF_ID_= ?; æŸ¥è¯¢æ­£å¸¸è¿è¡Œçš„æµç¨‹å®ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 SELECT art.ID_ TASK_ID_, art.EXECUTION_ID_, art.PROC_INST_ID_, art.NAME_, art.ASSIGNEE_, art.CREATE_TIME_, are.PARENT_ID_, are.PROC_DEF_ID_, are.ROOT_PROC_INST_ID_, are.ACT_ID_, are.START_TIME_ FROM ACT_RU_TASK art LEFT JOIN ACT_RU_EXECUTION are ON art.EXECUTION_ID_ = are.ID_ WHERE art.PROC_DEF_ID_ = ?; æŸ¥è¯¢æµç¨‹å®ä¾‹å˜é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 SELECT arv.ID_, arv.TYPE_, arv.NAME_, CASE arv.TYPE_ WHEN \u0026#39;string\u0026#39; THEN arv.TEXT_ WHEN \u0026#39;boolean\u0026#39; THEN arv.LONG_ WHEN \u0026#39;integer\u0026#39; THEN arv.LONG_ ELSE \u0026#39;\u0026#39; END VALUE_ FROM ACT_RU_VARIABLE arv WHERE arv.EXECUTION_ID_ = ?; 1 2 3 4 5 6 7 select distinct RES.* from ACT_RE_PROCDEF RES WHERE RES.KEY_ = \u0026#39;leave\u0026#39; and (RES.SUSPENSION_STATE_ = 1) order by RES.ID_ asc; select distinct RES.* from ACT_RU_TASK RES WHERE RES.PROC_DEF_ID_ = \u0026#39;leave:1:866908b5-1fb6-11e9-a502-4c348832211f\u0026#39; order by RES.ID_ asc; /*æŸ¥è¯¢å†å²æµç¨‹*/ select distinct RES.* , DEF.KEY_ as PROC_DEF_KEY_, DEF.NAME_ as PROC_DEF_NAME_, DEF.VERSION_ as PROC_DEF_VERSION_, DEF.DEPLOYMENT_ID_ as DEPLOYMENT_ID_ from ACT_HI_PROCINST RES left outer join ACT_RE_PROCDEF DEF on RES.PROC_DEF_ID_ = DEF.ID_ order by RES.END_TIME_ desc; /*æŸ¥è¯¢æ­£åœ¨è¿è¡Œçš„æµç¨‹*/ select distinct RES.* from ACT_RU_TASK RES WHERE RES.ASSIGNEE_ = \u0026#39;leader\u0026#39; and RES.TASK_DEF_KEY_ = \u0026#39;dept_leave_audit\u0026#39; and RES.SUSPENSION_STATE_ = 1 order by RES.ID_ asc; cloud project desc activiti-cloud-runtime-bundle-service è¿è¡Œæ—¶ activiti-cloud-audit-service å®¡è®¡ activiti-cloud-query-service æŸ¥è¯¢ ","date":"2019-04-21T14:03:17Z","permalink":"https://tianhui.xin/p/activiti%E8%A1%A8%E7%BB%93%E6%9E%84/","title":"activitiè¡¨ç»“æ„"},{"content":" éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚\nSentinelç‰¹å¾ ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ï¼š Sentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚\nå®Œå¤‡çš„å®æ—¶ç›‘æ§ï¼š Sentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚\nå¹¿æ³›çš„å¼€æºç”Ÿæ€ï¼š Sentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚\nå®Œå–„çš„ SPI æ‰©å±•ç‚¹ï¼š Sentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•ç‚¹ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•ç‚¹ï¼Œå¿«é€Ÿçš„å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…æ•°æ®æºç­‰ã€‚\nSentinelæ§åˆ¶å° Sentinelæä¾›äº†ä¸¤ç§ä½¿ç”¨æ–¹å¼,åŒ…æ‹¬ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„æœåŠ¡,å½“åˆæ¨å¹¿çš„æ—¶å€™æ˜¯å…è´¹çš„\nåœ¨çº¿æ§åˆ¶å°\nä¸‹è½½åœ°å€\né¡¹ç›®ä½¿ç”¨Sentinel(é˜¿é‡Œäº‘æ§åˆ¶å°) ahasæ–‡æ¡£\nå¼•å…¥ahasä¾èµ– 1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.csp\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ahas-sentinel-client\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.6.4\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ bean 1 2 3 4 5 6 7 8 9 @Bean public FilterRegistrationBean sentinelFilterRegistration() { FilterRegistrationBean registration = new FilterRegistrationBean(); registration.setFilter(new CommonFilter()); registration.addUrlPatterns(\u0026#34;/*\u0026#34;); registration.setName(\u0026#34;sentinelCommonFilter\u0026#34;); registration.setOrder(1); return registration; } é¡¹ç›®å¯åŠ¨ 1 java Dproject.name=AppName -Dahas.license=\u0026lt;License\u0026gt; -jar xxxx.jar ä½¿ç”¨è‡ªå·±æ­å»ºçš„æ§åˆ¶å° å¯åŠ¨Sentinelæ§åˆ¶å° 1 java -Dserver.port=8081 -Dcsp.sentinel.dashboard.server=localhost:8081 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.7.2.jar PS:ç”¨æˆ·åå¯†ç éƒ½æ˜¯sentinel\nå¼•å…¥ä¾èµ– 1 2 3 4 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-sentinel\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ç®€å•ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 @SpringBootApplication public class SentinelApplication { public static void main(String[] args) { SpringApplication.run(SentinelApplication.class, args); } } @RestController public class IndexController { @Autowired private SayHelloService sayHelloService; @GetMapping public String sayHello(String name) { return sayHelloService.sayHello(name); } } public interface SayHelloService { String sayHello(String name); } @Slf4j @Service public class SayHelloServiceImpl implements SayHelloService { @SentinelResource(\u0026#34;sayHello\u0026#34;) public String sayHello(String name) { log.info(Thread.currentThread().getName()); try { Thread.sleep(1000); }catch (Exception e){ e.printStackTrace(); } return \u0026#34;hello \u0026#34;.concat(name).concat(\u0026#34;!\u0026#34;); } } application.yamlé…ç½® 1 2 3 4 5 6 7 spring: application: name: spring-cloud-sentinel sentinel: transport: port: 8081 dashboard: localhost:8081 @SentinelResourceæ³¨è§£ç”¨æ¥æ ‡è¯†èµ„æºæ˜¯å¦è¢«é™æµã€é™çº§ã€‚ä¸Šè¿°ä¾‹å­ä¸Šè¯¥æ³¨è§£çš„å±æ€§ sayHello è¡¨ç¤ºèµ„æºåã€‚\nè§„åˆ™é…ç½® æµæ§è§„åˆ™ã€‹æ–°å¢æµæ§è§„åˆ™\nè¾“å…¥èµ„æºå,å’Œä»£ç ä¸­@SentinelResourceæ³¨è§£çš„å€¼å¯¹åº” æ ¹æ®å¯¹åº”éœ€æ±‚é€‰æ‹©é˜ˆå€¼ç±»å‹,åˆ†ä¸ºQPSåŠçº¿ç¨‹æ•° è®¾ç½®é˜ˆå€¼ç±»å‹å¯¹åº”çš„æ•°å€¼,æ¯”å¦‚åŒä¸€æ—¶é—´å†…åªå…è®¸æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®,å¯ä»¥é€‰æ‹©ä¸ºçº¿ç¨‹æ•°,å•æœºé˜ˆå€¼ä¸º1 çº¿ç¨‹æµ‹è¯• æµ‹è¯•ç¯å¢ƒï¼šé˜ˆå€¼ç±»å‹ä¸ºçº¿ç¨‹æ•°,å•æœºé˜ˆå€¼ä¸º10,jMeterè®¾ç½®çº¿ç¨‹ä¸º20,å¤±è´¥ç‡ä¸º50%\nQPSæµ‹è¯• æµ‹è¯•ç¯å¢ƒï¼šé˜ˆå€¼ç±»å‹ä¸ºQPS,å•æœºé˜ˆå€¼ä¸º10,jMeterè®¾ç½®çº¿ç¨‹ä¸º20,å¤±è´¥ç‡ä¸º40%\nä»£ç åœ°å€\n","date":"2019-04-21T14:03:17Z","permalink":"https://tianhui.xin/p/springboot%E4%B8%AD%E4%BD%BF%E7%94%A8sentinel/","title":"springbootä¸­ä½¿ç”¨sentinel"},{"content":"webpack4 å¼€å‘ç¯å¢ƒæ­å»º\nnpm åˆå§‹åŒ–é¡¹ç›® 1 yarn init å®‰è£…webpackä¾èµ– 1 yarn add webpack webpack-dev-server webpack-cli @webpack-cli/init --dev webpack åˆå§‹åŒ– 1 npx webpack-cli init 1 2 3 4 5 6 7 ? Will your application have multiple bundles? Yes ? Type the names you want for your modules (entry files), separated by comma [example: app,vendor] app ? What is the location of \u0026#34;app\u0026#34;? [example: ./src/app] ./src/app ? Which folder will your generated bundles be in? [default: dist]: dist ? Will you be using ES2015? Yes ? Will you use one of the below CSS solutions? SASS yarn add v1.12.1 æ·»åŠ ç¼–è¯‘æ’ä»¶ 1 2 3 4 5 6 ## äºŒé€‰ä¸€ ## 1. class å†™æ³• å‘ä¸‹å…¼å®¹ yarn add @babel/plugin-proposal-class-properties --dev ## 2. babel æ”¯æŒ import ## yarn add @babel/plugin-syntax-dynamic-import --dev yarn add @babel/preset-env @babel/core cross-env --dev å®‰è£…loader 1 yarn add html-withimg-loader url-loader file-loader style-loader postcss-loader --dev æ’ä»¶å®‰è£… 1 yarn add mini-css-extract-plugin uglifyjs-webpack-plugin clean-webpack-plugin copy-webpack-plugin extract-css html-webpack-plugin --dev å®‰è£…webpack-chain 1 yarn add webpack-chain --dev æ­¤å¤„webpack-chainä¸º5.0.1ç‰ˆæœ¬ï¼Œæ˜¯é’ˆå¯¹webpack 4ç»´æŠ¤çš„ï¼Œéœ€ç‰¹åˆ«æ³¨æ„\ngithubåœ°å€ï¼šwebpack-chain\nåˆ›å»ºwebpack.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 const path = require(\u0026#39;path\u0026#39;); const isProd = process.env.NODE_ENV === \u0026#39;production\u0026#39;; const MiniCssExtractPlugin = require(\u0026#34;mini-css-extract-plugin\u0026#34;); const WebpackChain = require(\u0026#39;webpack-chain\u0026#39;); const config = new WebpackChain(); config.when(isProd,config=\u0026gt;{ config.entry(\u0026#39;index\u0026#39;).add(\u0026#39;./src/index.js\u0026#39;); }).when(!isProd,config=\u0026gt;{ config.entry(\u0026#39;index\u0026#39;).add(\u0026#39;./src/index.js\u0026#39;); }) // Modify output settings .output .path(path.join(__dirname, \u0026#34;dist\u0026#34;)).filename(\u0026#39;[name].js\u0026#39;).end() .when(isProd, config =\u0026gt; { config.mode(\u0026#39;production\u0026#39;); }).when(!isProd,config=\u0026gt;{ config.mode(\u0026#39;development\u0026#39;).devtool(\u0026#39;source-map\u0026#39;); }).end(); /** * module */ config .module .rule(\u0026#34;compile\u0026#34;) .test(/\\.js$/) .include.add(path.join(__dirname,\u0026#39;src\u0026#39;)).end() .exclude.add(/node_modules/).end() .use(\u0026#39;babel\u0026#39;).loader(\u0026#34;babel-loader\u0026#34;) .options({ presets: [\u0026#39;@babel/preset-env\u0026#39;], plugins: [\u0026#39;@babel/plugin-proposal-class-properties\u0026#39;] }); config.module .rule(\u0026#39;images\u0026#39;) .test(/\\.(png|jpg|jpeg|gif)/) .use(\u0026#39;url-loader\u0026#39;) .loader(\u0026#39;url-loader\u0026#39;) .options({ limit: 1 * 1024, name: path.posix.join(\u0026#34;images\u0026#34;,\u0026#34;[name].[ext]\u0026#34;) }) // do not base64-inline SVGs. // https://github.com/facebookincubator/create-react-app/pull/1180 config.module .rule(\u0026#39;svg\u0026#39;) .test(/\\.(svg)(\\?.*)?$/) .use(\u0026#39;url-loader\u0026#39;) .loader(\u0026#39;url-loader\u0026#39;) .options({ limit: 1024 * 3,//30kb fallback: \u0026#39;file-loader\u0026#39; }) config.module .rule(\u0026#34;fonts\u0026#34;) .test(/\\.(woff2?|eot|ttf|otf)(\\?.*)?$/i) .use(\u0026#39;url-loader\u0026#39;) .loader(\u0026#39;url-loader\u0026#39;) .options({ limit: 10000, fallback: { loader: \u0026#39;file-loader\u0026#39;, options: { name: path.posix.join(\u0026#34;fonts\u0026#34;,\u0026#34;[name].[ext]\u0026#34;) } } }); config.when(isProd,config=\u0026gt;{ config.module.rule(\u0026#34;css\u0026#34;).test(/\\.(sa|sc|c)ss$/) .use(\u0026#34;style\u0026#34;).loader(MiniCssExtractPlugin.loader); }).when(!isProd,config=\u0026gt;{ config.module.rule(\u0026#34;css\u0026#34;).test(/\\.(sa|sc|c)ss$/) .use(\u0026#34;style-loader\u0026#34;).loader(\u0026#34;style-loader\u0026#34;); }); config.module.rule(\u0026#34;css\u0026#34;).test(/\\.(sa|sc|c)ss$/) .use(\u0026#39;css\u0026#39;).loader(\u0026#34;css-loader\u0026#34;).end() .use(\u0026#39;postcss-loader\u0026#39;).loader(\u0026#39;postcss-loader\u0026#39;); config.module.rule(\u0026#34;scss\u0026#34;).test(/\\.(sa|sc)ss$/).use(\u0026#34;sass-loader\u0026#34;).loader(\u0026#34;sass-loader\u0026#34;); config.module.rule(\u0026#34;lass\u0026#34;).test(/\\.less$/).use(\u0026#34;less-loader\u0026#34;).loader(\u0026#34;less-loader\u0026#34;); //config.module.rule(\u0026#34;html\u0026#34;).test(/\\.(htm|html)$/i).use(\u0026#34;html\u0026#34;).loader(\u0026#39;html-withimg-loader\u0026#39;); /** * plugin */ config.when(isProd,config=\u0026gt;{ const UglifyJSPlugin = require(\u0026#39;uglifyjs-webpack-plugin\u0026#39;); const CleanWebpackPlugin = require(\u0026#39;clean-webpack-plugin\u0026#39;); const CopyWebpackPlugin = require(\u0026#34;copy-webpack-plugin\u0026#34;); config.plugin(\u0026#34;clear\u0026#34;).use(new CleanWebpackPlugin([path.join(__dirname, \u0026#39;dist\u0026#39;)])); config.optimization.splitChunks({ cacheGroups: { commons: { chunks: \u0026#34;initial\u0026#34;, name: \u0026#34;common\u0026#34;, minChunks: 2, maxInitialRequests: 5, // The default limit is too small to showcase the effect minSize: 0, // This is example is too small to create commons chunks reuseExistingChunk: true // å¯è®¾ç½®æ˜¯å¦é‡ç”¨è¯¥chunkï¼ˆæŸ¥çœ‹æºç æ²¡æœ‰å‘ç°é»˜è®¤å€¼ï¼‰ } } }); config.plugin(\u0026#34;js\u0026#34;).use(new UglifyJSPlugin({})); config.plugin(\u0026#39;extract-css\u0026#39;) .use(MiniCssExtractPlugin, [{ filename: \u0026#34;css/[name].css\u0026#34;, chunkFilename: \u0026#34;css/[name].css\u0026#34; }]); // config.plugin(\u0026#39;copy\u0026#39;).use(new CopyWebpackPlugin([ // { // from:\u0026#34;./src/sass\u0026#34;, // } // ])) }) const HtmlWebpackPlugin = require(\u0026#39;html-webpack-plugin\u0026#39;); config.plugin(\u0026#34;html\u0026#34;).use(HtmlWebpackPlugin, [{ /* template å‚æ•°æŒ‡å®šå…¥å£ html æ–‡ä»¶è·¯å¾„ï¼Œæ’ä»¶ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶äº¤ç»™ webpack å»ç¼–è¯‘ï¼Œ webpack æŒ‰ç…§æ­£å¸¸æµç¨‹ï¼Œæ‰¾åˆ° loaders ä¸­ test æ¡ä»¶åŒ¹é…çš„ loader æ¥ç¼–è¯‘ï¼Œé‚£ä¹ˆè¿™é‡Œ html-loader å°±æ˜¯åŒ¹é…çš„ loader html-loader ç¼–è¯‘åäº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œä¼šç”± html-webpack-plugin å‚¨å­˜ä¸º html æ–‡ä»¶åˆ°è¾“å‡ºç›®å½•ï¼Œé»˜è®¤æ–‡ä»¶åä¸º index.html å¯ä»¥é€šè¿‡ filename å‚æ•°æŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶å html-webpack-plugin ä¹Ÿå¯ä»¥ä¸æŒ‡å®š template å‚æ•°ï¼Œå®ƒä¼šä½¿ç”¨é»˜è®¤çš„ html æ¨¡æ¿ã€‚ */ template: \u0026#34;./public/index.html\u0026#34;, filename:\u0026#34;index.html\u0026#34;, /* å› ä¸ºå’Œ webpack 4 çš„å…¼å®¹æ€§é—®é¢˜ï¼ŒchunksSortMode å‚æ•°éœ€è¦è®¾ç½®ä¸º none https://github.com/jantimon/html-webpack-plugin/issues/870 */ chunksSortMode: \u0026#39;none\u0026#39;, xhtml: true, minify: { collapseWhitespace: false, //åˆ é™¤ç©ºæ ¼ï¼Œä½†æ˜¯ä¸ä¼šåˆ é™¤SCRIPTã€styleå’Œtextareaä¸­çš„ç©ºæ ¼ conservativeCollapse: false, //åˆ é™¤ç©ºæ ¼ï¼Œæ€»æ˜¯ä¿ç•™ä¸€ä¸ªç©ºæ ¼ removeAttributeQuotes: false, //åˆ é™¤å¼•å·ï¼Œåˆ é™¤ä¸éœ€è¦å¼•å·çš„å€¼ useShortDoctype: false, //ä½¿ç”¨çŸ­çš„æ–‡æ¡£ç±»å‹ removeComments: true, collapseBooleanAttributes: true, removeScriptTypeAttributes: true // more options: // https://github.com/kangax/html-minifier#options-quick-reference } }]); config.when(isProd,config=\u0026gt;{ }).when(!isProd,config=\u0026gt;{ config.devServer.host(\u0026#39;localhost\u0026#39;).port(8080).open(process.os === \u0026#39;darwin\u0026#39;); }) config.resolve.alias.set(\u0026#34;@\u0026#34;,path.join(__dirname,\u0026#34;src\u0026#34;)); // Export the completed configuration object to be consumed by webpack module.exports = config.toConfig(); æ·»åŠ å¯åŠ¨è„šæœ¬ ä¿®æ”¹package.jsonæ–‡ä»¶ä¸­scriptsèŠ‚ç‚¹ï¼ŒåŠ å…¥å¦‚ä¸‹é…ç½®:\n1 2 3 4 \u0026#34;scripts\u0026#34;: { \u0026#34;dev\u0026#34;: \u0026#34;cross-env NODE_ENV=development webpack-dev-server\u0026#34;, \u0026#34;build\u0026#34;: \u0026#34;cross-env NODE_ENV=production webpack\u0026#34; } åˆ›å»ºpostcss.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 module.exports = { plugins: { autoprefixer: { \u0026#34;browsers\u0026#34;: [ \u0026#34;ie \u0026gt;= 9\u0026#34;, \u0026#34;ff \u0026gt;= 30\u0026#34;, \u0026#34;chrome \u0026gt;= 34\u0026#34;, \u0026#34;safari \u0026gt;= 7\u0026#34;, \u0026#34;opera \u0026gt;= 23\u0026#34; ] } } } åˆ›å»ºsrc/index.js 1 2 3 4 5 export default class demo { constructor(){ console.log(\u0026#34;init\u0026#34;); } } åˆ›å»ºexample/index.js 1 2 3 import Demo from \u0026#34;../src/index\u0026#34;; const demo = new Demo(); æ ¹ç›®å½•åˆ›å»ºindex.html å¯åŠ¨ 1 yarn run dev ","date":"2018-11-02T16:00:00Z","permalink":"https://tianhui.xin/p/webpack4-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"webpack4 å¼€å‘ç¯å¢ƒæ­å»º"},{"content":"kafka ç¯å¢ƒæ­å»º\nå®‰è£… ä¸‹è½½kafka 1 curl -L -O https://mirrors.cnnic.cn/apache/kafka/2.0.0/kafka_2.12-2.0.0.tgz è§£å‹ 1 tar -xvf kafka_2.12-2.0.0.tgz -C /usr/local/kafka é…ç½®zookeeper zookeeperå®‰è£…\né…ç½®zookeeper 1 vi config/server.properties æ‰¾åˆ°zookeeper.connectï¼Œå¹¶å°†å€¼ä¿®æ”¹ä¸ºzookeeperçš„åœ°å€ï¼Œå¦‚\n1 zookeeper.connect=localhost:2181 å¯åŠ¨kafka 1 /usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties æŸ¥çœ‹kafkaæ˜¯å¦å¯åŠ¨ 1 netstat -tunlp|egrep \u0026#34;(2181|9092)\u0026#34; å•æœºæµ‹è¯• å¯åŠ¨ä¸¤ä¸ªxshellå®¢æˆ·ç«¯åˆ†åˆ«ä½œä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…\nç”Ÿäº§è€…æµ‹è¯• 1 2 ./kafka-console-producer.sh --broker-list localhost:9092 --topic test \u0026gt; hello world! æ¶ˆè´¹è€…æµ‹è¯• 1 ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning æ³¨æ„: æ—©æœŸçš„kafkaç‰ˆæœ¬ï¼Œæ¶ˆè´¹è€…å‚æ•°ç”¨çš„æ˜¯**\u0026ndash;zookeeper**ï¼Œå¡«å†™çš„å€¼æ˜¯zookeeperçš„åœ°å€ï¼Œåœ¨æˆ‘ä»¬ä»Šå¤©æ•™ç¨‹ä¸­çš„ç‰ˆæœ¬å‚æ•°åº”è¯¥æ˜¯ \u0026ndash;bootstrap-server,å¡«å†™çš„æ˜¯kafkaçš„brokeråœ°å€\næŸ¥çœ‹topic 1 ./kafka-topics.sh --list --zookeeper localhost:2181 ","date":"2018-10-22T11:00:00Z","image":"https://image.tianhui.xin/kafka/1.jpg?x-oss-process=style/make","permalink":"https://tianhui.xin/p/kafka-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"kafka ç¯å¢ƒæ­å»º"},{"content":"zookeeper é›†ç¾¤ç¯å¢ƒå®‰è£…å’Œæ­å»º\né€‰æ‹©è‡ªå·±çš„å®‰è£…ç›®å½•,ä¸‹è½½ zookeeperå¹¶è§£å‹ 1 2 wget http://mirrors.hust.edu.cn/apache/zookeeper/zookeeper-3.4.10/zookeeper-3.4.10.tar.gz tar -xvzf zookeeper-3.4.10.tar.gz é‡å‘½å 1 mv zookeeper-3.4.10 zookeeper é…ç½®è°ƒæ•´ 1 2 3 4 5 6 7 8 9 10 11 12 cd zookeeper/conf mv zoo_sample.cfg zoo.cfg vi zoo.cfg ## ä¿®æ”¹ä»¥ä¸‹å†…å®¹æˆ–è€…æ–°å¢ dataDir=/usr/local/zookeeper/data dataLogDir=/usr/local/zookeeper/log server.1=host1:8888:9999 server.2=host2:8888:9999 server.3=host3:8888:9999 ## ä¸»æœºå:ç”¨äºzookeeper é›†ç¾¤é—´æ•°æ®åŒæ­¥ä¼ è¾“:ç”¨äºzookeeper çš„é€‰ä¸¾æœºåˆ¶ ------------------------------------------- åˆ›å»ºæ–‡ä»¶å¤¹ 1 2 3 cd zookeeper mkdir data mkdir log æ ¹æ®dataDiré…ç½®myid 1 2 3 4 5 6 7 ## æ³¨æ„ï¼Œè¿™é‡Œä¸‰æ¡æœåŠ¡å™¨ä¸ä¸€æ · ## æ¯”å¦‚æˆ‘é…ç½®çš„ä¸‰ä¸ªserverï¼Œmyidé‡Œé¢å†™çš„Xå°±æ˜¯server.X=ip:8888:9999 ä¸­ipæ‰€å¯¹åº”çš„X ## ç›´æ¥åœ¨æ–‡ä»¶ä¸­å†™å¯¹å¯¹åº”çš„xå³å¯ echo x \u0026gt; myid ## æˆ–è€… vi myid é…ç½®å®Œæˆåï¼ŒåŒæ­¥ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶myidä¸­çš„å€¼ å¯åŠ¨æœåŠ¡å™¨ 1 2 3 cd zookeeper/bin ./zkServer.sh start \u0026amp; ## è¾“å‡ºï¼šStarting zookeeper ... STARTED è¡¨ç¤ºå¯åŠ¨æˆåŠŸ é…ç½®ç¯å¢ƒå˜é‡ 1 2 3 4 5 6 7 8 9 vi /etc/profile ##æ·»åŠ ä¸‹é¢å†…å®¹ï¼Œå¹¶ä¿å­˜ export ZOOKEEPER_HOME=/usr/local/zookeeper export PATH=$PATH:$ZOOKEEPER_HOME/bin ## åˆ·æ–°ç¯å¢ƒå˜é‡ source /etc/profile å·¥å…· 1 2 3 4 ##æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ zkServer.sh status ##æŸ¥çœ‹å¯åŠ¨è¿‡ç¨‹ zkServer.sh start-foreground ","date":"2018-10-03T21:00:00Z","image":"https://image.tianhui.xin/zooKeeper/timg.jpg?x-oss-process=style/make","permalink":"https://tianhui.xin/p/zookeeper-%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","title":"zookeeper é›†ç¾¤ç¯å¢ƒæ­å»º"},{"content":"Vue CLi 3å¿«é€Ÿå…¥é—¨\n2018å¹´08æœˆ13æ—¥åœ¨å¼€æºä¸­å›½æ”¶åˆ°äº†Vue CLi 3.0 æ­£å¼ç‰ˆçš„å‘å¸ƒï¼Œå…³äºå®ƒçš„æ¨ªç©ºå‡ºä¸–ï¼Œæ™¨åœ¨è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼Œå¾ˆå¤šäººåœ¨å¾®åšéƒ½åœ¨è°ƒä¾ƒVue,è¯´æ˜¯ä¸æ˜¯æ›´æ–°å¤ªå—äº†ï¼Œéƒ½å­¦ä¸è¿‡æ¥ï¼Œä¸‹é¢æ˜¯æˆ‘æœé›†çš„å‡ å¼ å›¾ï¼Œ\nè§£é‡Šä¸€ä¸‹ï¼ŒVueè¿™æ¬¡å¹¶æ²¡æœ‰å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œè€Œæ˜¯å‡ºäº†ä¸€ä¸ªç®€åŒ–é…ç½®çš„è„šæ‰‹æ¶ï¼Œå‘½åä¸ºVue CLi 3ï¼Œä¸è¿‡è°ƒä¾ƒå°å³çš„ä¹Ÿæ˜¯ç”¨å°½äº†å„ç§æŠ€èƒ½ã€‚\nå¥½äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œå›å½’æˆ‘ä»¬ä»Šæ—¥çš„æ­£é¢˜ï¼Œå¿«é€Ÿå…¥é—¨Vue CLi 3ï¼Œæ‰“å¼€å®˜æ–¹æ–‡æ¡£æˆ‘ä»¬éƒ½èƒ½çœ‹åˆ°\nVue CLI çš„åŒ…åç§°ç”± vue-cli æ”¹æˆäº† @vue/cliã€‚ å¦‚æœä½ å·²ç»å…¨å±€å®‰è£…äº†æ—§ç‰ˆæœ¬çš„ vue-cli (1.x æˆ– 2.x)ï¼Œä½ éœ€è¦å…ˆé€šè¿‡ npm uninstall vue-cli -g æˆ– yarn global remove vue-cli å¸è½½å®ƒã€‚\nå®‰è£…çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬è¿™é‡Œä¸åšè¿‡å¤šçš„é˜è¿°ï¼Œå…·ä½“çš„å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£Vue CLi 3\nåˆ›å»ºé¡¹ç›® 1 vue create hello-world åˆšå…¥é—¨ï¼Œä¸€ç›´å›è½¦å°±å¥½ï¼ŒğŸ™‚\nç›®å½•ç»“æ„æ˜¯å•¥æ ·å­çš„ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹\n@vue/cliåœ¨è¿™æ¬¡å‘å¸ƒä¸­ï¼Œåˆ°åº•æ›´æ–°äº†ä»€ä¹ˆå‘¢ï¼Œé¦–å…ˆè¦è¯´çš„ç¬¬ä¸€ä¸ªä¸œè¥¿å°±æ˜¯ç®€åŒ–é…ç½®æ–‡ä»¶ï¼Œé›†ä¸­é…ç½®æ–‡ä»¶åˆ°vue.config.jsä¸­,æ–‡ä»¶åœ¨å“ªå‘¢ï¼Œæœ¨æœ‰å•Šï¼Œé‚£æ˜¯å› ä¸º@vue/cliåšäº†ä¸€äº›é»˜è®¤çš„é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ã€‚\nvue inspectï¼Œæ˜¯è„šæ‰‹æ¶æä¾›çš„ä¸€ä¸ªé…ç½®æ£€æŸ¥çš„æœåŠ¡ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªä½ å¾ˆç†Ÿæ‚‰çš„æ–‡ä»¶\n1 vue inspect \u0026gt; output.js é‚£ä¹ˆè¿™æ ·ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰å‘¢\næ˜¯çš„ï¼Œè¿™ä¸ªwebpackçš„ä¸€äº›é…ç½®é¡¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆä¹¦å†™å‘¢ï¼Œè¯­æ³•æ˜¯è¿™æ ·çš„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // vue.config.js module.exports = { configureWebpack: { plugins: [ new MyAwesomeWebpackPlugin() ] }, chainWebpack: config =\u0026gt; { // GraphQL Loader config.module .rule(\u0026#39;graphql\u0026#39;) .test(/\\.graphql$/) .use(\u0026#39;graphql-tag/loader\u0026#39;) .loader(\u0026#39;graphql-tag/loader\u0026#39;) .end() } } é‚£ä¹ˆï¼ŒchainWebpackè¿™æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œä½œè€…é‡‡ç”¨äº†webpack-chainçš„æ€æƒ³ï¼Œå†…éƒ¨å®ç°ä¹Ÿæ˜¯webpack-chainæ¥å®ç°webpackçš„é…ç½®ï¼Œä»”ç»†çœ‹ webpack-chainçš„æ–‡æ¡£å°±ä¼šçœ‹å‡ºï¼Œå®ƒæ˜¯ä¸€ä¸ªé“¾å¼APIçš„æ–¹å¼æ¥ç®€åŒ–é…ç½®çš„ä¸€ä¸ªæ’ä»¶ã€‚\næ™¨è¿™è¾¹ä¹Ÿä¿®æ”¹è¿‡å‡ ä¸ªloader,å¤§æ¦‚åˆ†äº«ä¸€ä¸‹ä»£ç å§\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 module.exports = { chainWebpack: config =\u0026gt; { config.module.rule(\u0026#39;compile\u0026#39;) .test(/\\.js$/) .include.add(\u0026#39;./examples\u0026#39;).add(\u0026#39;./packages\u0026#39;).end() .use(\u0026#39;babel\u0026#39;) .loader(\u0026#39;babel-loader\u0026#39;) .options({ presets: [ [\u0026#39;babel-preset-es2015\u0026#39;, {modules: false}] ] }); // https://github.com/friends-of-js/yaml-loader config.module.rule(\u0026#34;yml\u0026#34;) .test(/\\.ya?ml$/) .use(\u0026#39;yaml\u0026#39;) .loader(\u0026#39;@friends-of-js/yaml-loader\u0026#39;) .options({ useNodeEnv: true }); } } vue ui æœ€åæˆ‘ä»¬æ¥ä»‹ç»å¦ä¸€ä¸ªä¸œè¥¿ï¼Œå¯¹ï¼Œæ²¡é”™ï¼Œç°åœ¨è¦è¯´çš„å°±æ˜¯vue ui,å®ƒæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ\né¡¹ç›®ç®¡ç†ï¼ŒåŒ…æ‹¬åˆ›å»ºå’Œå¯¼å…¥ æ’ä»¶ç®¡ç†ï¼ŒåŒ…æ‹¬ä¾èµ–ç®¡ç† ä»»åŠ¡å¯åŠ¨åŠç›‘æ§ ç›®å‰è¯¥uiå±äºBetaç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šå‡ºç°bug,ç›¸ä¿¡ç¤¾åŒºä¼šè®©å…¶æ›´åŠ å®Œå–„å’Œå¼ºå¤§ã€‚\n","date":"2018-08-24T21:00:00Z","image":"https://image.tianhui.xin/Vue-CLi/12.png","permalink":"https://tianhui.xin/p/vue-cli-3%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/","title":"Vue CLi 3å¿«é€Ÿå…¥é—¨"},{"content":"springBootç³»åˆ— - é›†æˆJWTå®ç°æ¥å£æƒé™è®¤è¯\nä¸€èˆ¬æ¥è®²ï¼Œå¯¹äºRESTful APIéƒ½ä¼šæœ‰è®¤è¯(Authentication)å’Œæˆæƒ(Authorization)è¿‡ç¨‹ï¼Œä¿è¯APIçš„å®‰å…¨æ€§ã€‚\nAuthentication vs. Authorization\nAuthenticationæŒ‡çš„æ˜¯ç¡®å®šè¿™ä¸ªç”¨æˆ·çš„èº«ä»½ï¼ŒAuthorizationæ˜¯ç¡®å®šè¯¥ç”¨æˆ·æ‹¥æœ‰ä»€ä¹ˆæ“ä½œæƒé™ã€‚\nè®¤è¯æ–¹å¼ä¸€èˆ¬æœ‰ä¸‰ç§\nBasic Authentication è¿™ç§æ–¹å¼æ˜¯ç›´æ¥å°†ç”¨æˆ·åå’Œå¯†ç æ”¾åˆ°Headerä¸­ï¼Œä½¿ç”¨Authorization: Basic Zm9vOmJhcg==ï¼Œä½¿ç”¨æœ€ç®€å•ä½†æ˜¯æœ€ä¸å®‰å…¨ã€‚\nTOKENè®¤è¯ è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å†HTTPå¤´ä¸­ï¼Œä½¿ç”¨Authorization: Bearer ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„TOKENæ˜¯JWTï¼Œé€šè¿‡ç­¾åè¿‡çš„TOKENã€‚\nOAuth2.0 è¿™ç§æ–¹å¼å®‰å…¨ç­‰çº§æœ€é«˜ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ€å¤æ‚çš„ã€‚å¦‚æœä¸æ˜¯å¤§å‹APIå¹³å°æˆ–è€…éœ€è¦ç»™ç¬¬ä¸‰æ–¹APPä½¿ç”¨çš„ï¼Œæ²¡å¿…è¦æ•´è¿™ä¹ˆå¤æ‚ã€‚ ä¸€èˆ¬é¡¹ç›®ä¸­çš„RESTful APIä½¿ç”¨JWTæ¥åšè®¤è¯å°±è¶³å¤Ÿäº†ã€‚\nä»€ä¹ˆæ˜¯JWT Json web token (JWT), æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆ(RFC 7519).è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œ ç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œ ä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚\nJWTå®˜ç½‘ï¼šhttps://jwt.io/\nJWTæ˜¯ç”±ä¸‰æ®µä¿¡æ¯æ„æˆçš„ï¼Œå°†è¿™ä¸‰æ®µä¿¡æ¯æ–‡æœ¬ç”¨.é“¾æ¥ä¸€èµ·å°±æ„æˆäº†Jwtå­—ç¬¦ä¸²ã€‚å°±åƒè¿™æ ·:\n1 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ JWTçš„æ„æˆ ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬ç§°å®ƒä¸ºå¤´éƒ¨ï¼ˆheader),ç¬¬äºŒéƒ¨åˆ†æˆ‘ä»¬ç§°å…¶ä¸ºè½½è·ï¼ˆpayload, ç±»ä¼¼äºé£æœºä¸Šæ‰¿è½½çš„ç‰©å“)ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯ç­¾è¯ï¼ˆsignature)ã€‚\nheader\njwtçš„å¤´éƒ¨æ‰¿è½½ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š\nå£°æ˜ç±»å‹ï¼Œè¿™é‡Œæ˜¯jwt å£°æ˜åŠ å¯†çš„ç®—æ³• é€šå¸¸ç›´æ¥ä½¿ç”¨ HMAC SHA256 è¿™é‡Œçš„åŠ å¯†ç®—æ³•æ˜¯å•å‘å‡½æ•°æ•£åˆ—ç®—æ³•ï¼Œå¸¸è§çš„æœ‰MD5ã€SHAã€HAMCã€‚è¿™é‡Œä½¿ç”¨åŸºäºå¯†é’¥çš„Hashç®—æ³•HMACç”Ÿæˆæ•£åˆ—å€¼ã€‚\nMD5 message-digest algorithm 5 ï¼ˆä¿¡æ¯-æ‘˜è¦ç®—æ³•ï¼‰ç¼©å†™ï¼Œå¹¿æ³›ç”¨äºåŠ å¯†å’Œè§£å¯†æŠ€æœ¯ï¼Œå¸¸ç”¨äºæ–‡ä»¶æ ¡éªŒã€‚æ ¡éªŒï¼Ÿä¸ç®¡æ–‡ä»¶å¤šå¤§ï¼Œç»è¿‡MD5åéƒ½èƒ½ç”Ÿæˆå”¯ä¸€çš„MD5å€¼ SHA (Secure Hash Algorithmï¼Œå®‰å…¨æ•£åˆ—ç®—æ³•ï¼‰ï¼Œæ•°å­—ç­¾åç­‰å¯†ç å­¦åº”ç”¨ä¸­é‡è¦çš„å·¥å…·ï¼Œå®‰å…¨æ€§é«˜äºMD5 HMAC (Hash Message Authentication Codeï¼Œæ•£åˆ—æ¶ˆæ¯é‰´åˆ«ç ï¼ŒåŸºäºå¯†é’¥çš„Hashç®—æ³•çš„è®¤è¯åè®®ã€‚ç”¨å…¬å¼€å‡½æ•°å’Œå¯†é’¥äº§ç”Ÿä¸€ä¸ªå›ºå®šé•¿åº¦çš„å€¼ä½œä¸ºè®¤è¯æ ‡è¯†ï¼Œç”¨è¿™ä¸ªæ ‡è¯†é‰´åˆ«æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚ å¸¸ç”¨äºæ¥å£ç­¾åéªŒè¯å®Œæ•´çš„å¤´éƒ¨å°±åƒä¸‹é¢è¿™æ ·çš„JSONï¼š\n1 2 3 4 { \u0026#39;typ\u0026#39;: \u0026#39;JWT\u0026#39;, \u0026#39;alg\u0026#39;: \u0026#39;HS256\u0026#39; } ç„¶åå°†å¤´éƒ¨è¿›è¡Œbase64åŠ å¯†ï¼ˆè¯¥åŠ å¯†æ˜¯å¯ä»¥å¯¹ç§°è§£å¯†çš„),æ„æˆäº†ç¬¬ä¸€éƒ¨åˆ†\n1 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9 playload\nè½½è·å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ï¼Œè¿™äº›æœ‰æ•ˆä¿¡æ¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š\næ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ å…¬å…±çš„å£°æ˜ ç§æœ‰çš„å£°æ˜ æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ (å»ºè®®ä½†ä¸å¼ºåˆ¶ä½¿ç”¨) ï¼š\niss: jwtç­¾å‘è€… sub: jwtæ‰€é¢å‘çš„ç”¨æˆ· aud: æ¥æ”¶jwtçš„ä¸€æ–¹ exp: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´ nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„. iat: jwtçš„ç­¾å‘æ—¶é—´ jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚ å…¬å…±çš„å£°æ˜ï¼š\nå…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯.ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†\nç§æœ‰çš„å£°æ˜ï¼š\nç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64æ˜¯å¯¹ç§°è§£å¯†çš„ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚\nå®šä¹‰ä¸€ä¸ªpayload:\n1 2 3 4 5 { \u0026#34;sub\u0026#34;: \u0026#34;1234567890\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;admin\u0026#34;: true } ç„¶åå°†å…¶è¿›è¡Œbase64åŠ å¯†ï¼Œå¾—åˆ°Jwtçš„ç¬¬äºŒéƒ¨åˆ†ï¼š\n1 eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 signature\njwtçš„ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾è¯ä¿¡æ¯ï¼Œè¿™ä¸ªç­¾è¯ä¿¡æ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\nheader (base64åçš„) payload (base64åçš„) secret è¿™ä¸ªéƒ¨åˆ†éœ€è¦base64åŠ å¯†åçš„headerå’Œbase64åŠ å¯†åçš„payloadä½¿ç”¨.è¿æ¥ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œ ç„¶åé€šè¿‡headerä¸­å£°æ˜çš„åŠ å¯†æ–¹å¼è¿›è¡ŒåŠ ç›secretç»„åˆåŠ å¯†ï¼Œç„¶åå°±æ„æˆäº†jwtçš„ç¬¬ä¸‰éƒ¨åˆ†ã€‚\n1 2 3 // javascript var encodedString = base64UrlEncode(header) + \u0026#39;.\u0026#39; + base64UrlEncode(payload); var signature = HMACSHA256(encodedString, \u0026#39;secret\u0026#39;); // TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ å°†è¿™ä¸‰éƒ¨åˆ†ç”¨.è¿æ¥æˆä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²,æ„æˆäº†æœ€ç»ˆçš„jwt:\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\n==æ³¨æ„==ï¼šsecretæ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œjwtçš„ç­¾å‘ç”Ÿæˆä¹Ÿæ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œsecretå°±æ˜¯ç”¨æ¥è¿›è¡Œjwtçš„ç­¾å‘å’Œjwtçš„éªŒè¯ï¼Œ æ‰€ä»¥ï¼Œå®ƒå°±æ˜¯ä½ æœåŠ¡ç«¯çš„ç§é’¥ï¼Œåœ¨ä»»ä½•åœºæ™¯éƒ½ä¸åº”è¯¥æµéœ²å‡ºå»ã€‚ä¸€æ—¦å®¢æˆ·ç«¯å¾—çŸ¥è¿™ä¸ªsecret, é‚£å°±æ„å‘³ç€å®¢æˆ·ç«¯æ˜¯å¯ä»¥è‡ªæˆ‘ç­¾å‘jwtäº†ã€‚\nå¦‚ä½•åº”ç”¨ ä¸€èˆ¬æ˜¯åœ¨è¯·æ±‚å¤´é‡ŒåŠ å…¥Authorizationï¼Œå¹¶åŠ ä¸ŠBeareræ ‡æ³¨ï¼š\n1 2 3 4 5 fetch(\u0026#39;api/user/1\u0026#39;, { headers: { \u0026#39;Authorization\u0026#39;: \u0026#39;Bearer \u0026#39; + token } }) æœåŠ¡å™¨è´Ÿè´£è§£æè¿™ä¸ªHTTPå¤´æ¥åšç”¨æˆ·è®¤è¯å’Œæˆæƒå¤„ç†ã€‚å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š\nå®‰å…¨ç›¸å…³ JWTåè®®æœ¬èº«ä¸å…·å¤‡å®‰å…¨ä¼ è¾“åŠŸèƒ½ï¼Œæ‰€ä»¥å¿…é¡»å€ŸåŠ©äºSSL/TLSçš„å®‰å…¨é€šé“ï¼Œæ‰€ä»¥å»ºè®®å¦‚ä¸‹ï¼š\nä¸åº”è¯¥åœ¨jwtçš„payloadéƒ¨åˆ†å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯å¯è§£å¯†çš„éƒ¨åˆ†ã€‚ ä¿æŠ¤å¥½secretç§é’¥ï¼Œè¯¥ç§é’¥éå¸¸é‡è¦ã€‚ å¦‚æœå¯ä»¥ï¼Œè¯·ä½¿ç”¨httpsåè®® å’ŒSpringBooté›†æˆ ç®€è¦çš„è¯´æ˜ä¸‹æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨JWTï¼Œå› ä¸ºæˆ‘ä»¬è¦å®ç°å®Œå…¨çš„å‰åç«¯åˆ†ç¦»ï¼Œæ‰€ä»¥ä¸å¯èƒ½ä½¿ç”¨sessionï¼Œcookieçš„æ–¹å¼è¿›è¡Œé‰´æƒï¼Œ æ‰€ä»¥JWTå°±è¢«æ´¾ä¸Šäº†ç”¨åœºï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªåŠ å¯†å¯†é’¥æ¥è¿›è¡Œå‰åç«¯çš„é‰´æƒã€‚\nç¨‹åºé€»è¾‘\næˆ‘ä»¬POSTç”¨æˆ·åä¸å¯†ç åˆ°/loginè¿›è¡Œç™»å…¥ï¼Œå¦‚æœæˆåŠŸè¿”å›ä¸€ä¸ªåŠ å¯†tokenï¼Œå¤±è´¥çš„è¯ç›´æ¥è¿”å›401é”™è¯¯ã€‚ ä¹‹åç”¨æˆ·è®¿é—®æ¯ä¸€ä¸ªéœ€è¦æƒé™çš„ç½‘å€è¯·æ±‚å¿…é¡»åœ¨headerä¸­æ·»åŠ Authorizationå­—æ®µï¼Œä¾‹å¦‚Authorization: tokenï¼Œtokenä¸ºå¯†é’¥ã€‚ åå°ä¼šè¿›è¡Œtokençš„æ ¡éªŒï¼Œå¦‚æœä¸é€šè¿‡ç›´æ¥è¿”å›401ã€‚ è¿™é‡Œæˆ‘è®²ä¸€ä¸‹å¦‚ä½•åœ¨SpringBootä¸­ä½¿ç”¨JWTæ¥åšæ¥å£æƒé™è®¤è¯ï¼Œå®‰å…¨æ¡†æ¶ä¾æ—§ä½¿ç”¨Shiroï¼ŒJWTçš„å®ç°ä½¿ç”¨ jjwt\næ·»åŠ Mavenä¾èµ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-tomcat\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-jetty\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.auth0\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;java-jwt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.3.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- shiro æƒé™æ§åˆ¶ --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.shiro\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;shiro-spring\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.4.0\u0026lt;/version\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;artifactId\u0026gt;slf4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;/groupId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- shiro ehcache (shiroç¼“å­˜)--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.shiro\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;shiro-ehcache\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.4.0\u0026lt;/version\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;artifactId\u0026gt;slf4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;/groupId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; åˆ›å»ºç”¨æˆ·Service è¿™ä¸ªåœ¨shiroä¸€èŠ‚è®²è¿‡å¦‚æœåˆ›å»ºè§’è‰²æƒé™è¡¨ï¼Œæ·»åŠ ç”¨æˆ·Serviceæ¥æ‰§è¡ŒæŸ¥æ‰¾ç”¨æˆ·æ“ä½œï¼Œè¿™é‡Œå°±ä¸å¤šè®²å…·ä½“å®ç°äº†ï¼Œåªåˆ—å‡ºå…³é”®ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 /** * é€šè¿‡åç§°æŸ¥æ‰¾ç”¨æˆ· * * @param username * @return */ public ManagerInfo findByUsername(String username) { ManagerInfo managerInfo = managerInfoDao.findByUsername(username); if (managerInfo == null) { throw new UnknownAccountException(); } return managerInfo; } ç”¨æˆ·ä¿¡æ¯ç±»ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public class ManagerInfo implements Serializable { private static final long serialVersionUID = 1L; /** * ä¸»é”®ID */ private Integer id; /** * è´¦å· */ private String username; /** * å¯†ç  */ private String password; /** * md5å¯†ç ç› */ private String salt; /** * ä¸€ä¸ªç®¡ç†å‘˜å…·æœ‰å¤šä¸ªè§’è‰² */ private List\u0026lt;SysRole\u0026gt; roles; JWTå·¥å…·ç±» æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„JWTåŠ å¯†ï¼Œæ ¡éªŒå·¥å…·ï¼Œå¹¶ä¸”ä½¿ç”¨ç”¨æˆ·è‡ªå·±çš„å¯†ç å……å½“åŠ å¯†å¯†é’¥ï¼Œ è¿™æ ·ä¿è¯äº†token å³ä½¿è¢«ä»–äººæˆªè·ä¹Ÿæ— æ³•ç ´è§£ã€‚å¹¶ä¸”æˆ‘ä»¬åœ¨tokenä¸­é™„å¸¦äº†usernameä¿¡æ¯ï¼Œå¹¶ä¸”è®¾ç½®å¯†é’¥5åˆ†é’Ÿå°±ä¼šè¿‡æœŸã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 public class JWTUtil { // è¿‡æœŸæ—¶é—´5åˆ†é’Ÿ private static final long EXPIRE_TIME = 5 * 60 * 1000; /** * æ ¡éªŒtokenæ˜¯å¦æ­£ç¡® * * @param token å¯†é’¥ * @param secret ç”¨æˆ·çš„å¯†ç  * @return æ˜¯å¦æ­£ç¡® */ public static boolean verify(String token, String username, String secret) { try { Algorithm algorithm = Algorithm.HMAC256(secret); JWTVerifier verifier = JWT.require(algorithm) .withClaim(\u0026#34;username\u0026#34;, username).build(); DecodedJWT jwt = verifier.verify(token); return true; } catch (Exception exception) { return false; } } /** * è·å¾—tokenä¸­çš„ä¿¡æ¯æ— éœ€secretè§£å¯†ä¹Ÿèƒ½è·å¾— * * @return tokenä¸­åŒ…å«çš„ç”¨æˆ·å */ public static String getUsername(String token) { try { DecodedJWT jwt = JWT.decode(token); return jwt.getClaim(\u0026#34;username\u0026#34;).asString(); } catch (JWTDecodeException e) { return null; } } /** * ç”Ÿæˆç­¾å,5minåè¿‡æœŸ * * @param username ç”¨æˆ·å * @param secret ç”¨æˆ·çš„å¯†ç  * @return åŠ å¯†çš„token */ public static String sign(String username, String secret) { try { Date date = new Date(System.currentTimeMillis() + EXPIRE_TIME); Algorithm algorithm = Algorithm.HMAC256(secret); // é™„å¸¦usernameä¿¡æ¯ return JWT.create().withClaim(\u0026#34;username\u0026#34;, username) .withExpiresAt(date).sign(algorithm); } catch (UnsupportedEncodingException e) { return null; } } } ç¼–å†™ç™»å½•æ¥å£ ä¸ºäº†è®©ç”¨æˆ·ç™»å½•çš„æ—¶å€™è·å–åˆ°æ­£ç¡®çš„JWT Tokenï¼Œéœ€è¦å®ç°ç™»å½•æ¥å£ï¼Œè¿™é‡Œæˆ‘ç¼–å†™ä¸€ä¸ªLoginController.javaï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 RestController public class LoginController { private static final Logger _logger = LoggerFactory.getLogger(LoginController.class); @Resource private ManagerInfoService managerInfoService; @PostMapping(\u0026#34;/login\u0026#34;) public BaseResponse login(@RequestParam(\u0026#34;username\u0026#34;) String username, @RequestParam(\u0026#34;password\u0026#34;) String password) { ManagerInfo user = managerInfoService.findByUsername(username); //ç›ï¼ˆç”¨æˆ·å+éšæœºæ•°ï¼‰ String salt = user.getSalt(); //åŸå¯†ç  String encodedPassword = ShiroKit.md5(password, username + salt); if (user.getPassword().equals(encodedPassword)) { return new BaseResponse(true, \u0026#34;Login success\u0026#34;, JWTUtil.sign(username, encodedPassword)); } else { throw new UnauthorizedException(); } } @RequestMapping(path = \u0026#34;/401\u0026#34;) @ResponseStatus(HttpStatus.UNAUTHORIZED) public BaseResponse unauthorized() { return new BaseResponse(false, \u0026#34;Unauthorized\u0026#34;, null); } } æ³¨æ„ä¸Šé¢ç™»å½•çš„æ—¶å€™ï¼Œæˆ‘ä¼šä»æ•°æ®åº“ä¸­æŠŠè¿™ä¸ªç”¨æˆ·å–å‡ºæ¥ï¼Œå¯†ç åŠ ç›ç®—MD5å€¼æ¯”è¾ƒï¼Œé€šè¿‡ä¹‹åå†ç”¨å¯†ç ä½œä¸ºå¯†é’¥æ¥ç­¾åç”ŸæˆJWTã€‚\nç¼–å†™RESTfulæ¥å£ å…ˆç¼–å†™ä¸€ä¸ªé€šç”¨çš„æ¥å£è¿”å›ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 /** * APIæ¥å£çš„åŸºç¡€è¿”å›ç±» * * @author XiongNeng * @version 1.0 * @since 2018/1/7 */ public class BaseResponse\u0026lt;T\u0026gt; { /** * æ˜¯å¦æˆåŠŸ */ private boolean success; /** * è¯´æ˜ */ private String msg; /** * è¿”å›æ•°æ® */ private T data; public BaseResponse() { } public BaseResponse(boolean success, String msg, T data) { this.success = success; this.msg = msg; this.data = data; } } é€šè¿‡SpringMVCå®ç°RESTfulæ¥å£ï¼Œè¿™é‡Œæˆ‘åªå†™ä¸€ä¸ªç¤ºä¾‹æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 @RestController @RequestMapping(value = \u0026#34;/api/v1\u0026#34;) public class PublicController { @Resource private ApiService apiService; /** * è¯·æ±‚å…¥ç½‘æ¥å£ * * @return å¤„ç†ç»“æœ */ @RequestMapping(value = \u0026#34;/join\u0026#34;, method = RequestMethod.POST) @RequiresRoles(\u0026#34;admin\u0026#34;) public ResponseEntity\u0026lt;BaseResponse\u0026gt; doJoin(@RequestBody PosParam posParam) { _logger.info(\u0026#34;è¯·æ±‚å…¥ç½‘æ¥å£ start....\u0026#34;); BaseResponse result = new BaseResponse(); // imeiç çº¦æŸæ£€æŸ¥ if (StringUtils.isEmpty(posParam.getImei()) || posParam.getImei().length() \u0026gt; 32) { result.setSuccess(false); result.setMsg(\u0026#34;IMEIç é•¿åº¦ä¸æ˜¯1-32ä½ï¼Œå…¥ç½‘å¤±è´¥ã€‚\u0026#34;); return new ResponseEntity\u0026lt;\u0026gt;(result, HttpStatus.OK); } Pos pos = new Pos(); Date now = new Date(); pos.setJointime(now); pos.setBindtime(now); BeanUtils.copyProperties(posParam, pos); // æ’å…¥ä¸€æ¡æ–°çºªå½• pos.setProjectId(project.getId()); int insert = apiService.insertPos(pos); if (insert \u0026gt; 0) { result.setSuccess(true); result.setMsg(\u0026#34;å…¥ç½‘æˆåŠŸ\u0026#34;); return new ResponseEntity\u0026lt;\u0026gt;(result, HttpStatus.CREATED); } else { result.setSuccess(false); result.setMsg(\u0026#34;å…¥ç½‘å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚\u0026#34;); return new ResponseEntity\u0026lt;\u0026gt;(result, HttpStatus.OK); } } } è‡ªå®šä¹‰å¼‚å¸¸ ä¸ºäº†å®ç°æˆ‘è‡ªå·±èƒ½å¤Ÿæ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªUnauthorizedException.java\n1 2 3 4 5 6 7 8 9 public class UnauthorizedException extends RuntimeException { public UnauthorizedException(String msg) { super(msg); } public UnauthorizedException() { super(); } } å¤„ç†æ¡†æ¶å¼‚å¸¸ ä¹‹å‰è¯´è¿‡restfulè¦ç»Ÿä¸€è¿”å›çš„æ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦å…¨å±€å¤„ç†Spring Bootçš„æŠ›å‡ºå¼‚å¸¸ã€‚åˆ©ç”¨@RestControllerAdviceèƒ½å¾ˆå¥½çš„å®ç°ã€‚ æ³¨æ„è¿™ä¸ªç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨åªå¯¹è®¤è¯è¿‡çš„ç”¨æˆ·è°ƒç”¨æ¥å£ä¸­çš„å¼‚å¸¸æœ‰ä½œç”¨ï¼Œå¯¹AuthenticationExceptionæ²¡æœ‰ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @RestControllerAdvice public class ExceptionController { // æ•æ‰shiroçš„å¼‚å¸¸ @ResponseStatus(HttpStatus.UNAUTHORIZED) @ExceptionHandler(ShiroException.class) public BaseResponse handle401(ShiroException e) { return new BaseResponse(false, \u0026#34;shiroçš„å¼‚å¸¸\u0026#34;, null); } // æ•æ‰UnauthorizedException @ResponseStatus(HttpStatus.UNAUTHORIZED) @ExceptionHandler(UnauthorizedException.class) public BaseResponse handle401() { return new BaseResponse(false, \u0026#34;UnauthorizedException\u0026#34;, null); } // æ•æ‰å…¶ä»–æ‰€æœ‰å¼‚å¸¸ @ExceptionHandler(Exception.class) @ResponseStatus(HttpStatus.BAD_REQUEST) public BaseResponse globalException(HttpServletRequest request, Throwable ex) { return new BaseResponse(false, \u0026#34;å…¶ä»–å¼‚å¸¸\u0026#34;, null); } private HttpStatus getStatus(HttpServletRequest request) { Integer statusCode = (Integer) request.getAttribute(\u0026#34;javax.servlet.error.status_code\u0026#34;); if (statusCode == null) { return HttpStatus.INTERNAL_SERVER_ERROR; } return HttpStatus.valueOf(statusCode); } } é…ç½®Shiro å¤§å®¶å¯ä»¥å…ˆçœ‹ä¸‹å®˜æ–¹çš„Spring-Shiroæ•´åˆæ•™ç¨‹ï¼Œæœ‰ä¸ªåˆæ­¥çš„äº†è§£ã€‚ ä¸è¿‡æ—¢ç„¶æˆ‘ä»¬ç”¨äº†SpringBootï¼Œé‚£æˆ‘ä»¬è‚¯å®šè¦äº‰å–é›¶é…ç½®æ–‡ä»¶ã€‚\nå®ç°JWTToken\nJWTTokenå·®ä¸å¤šå°±æ˜¯Shiroç”¨æˆ·åå¯†ç çš„è½½ä½“ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯å‰åç«¯åˆ†ç¦»ï¼ŒæœåŠ¡å™¨æ— éœ€ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œæ‰€ä»¥ä¸éœ€è¦RememberMeè¿™ç±»åŠŸèƒ½ï¼Œ æˆ‘ä»¬ç®€å•çš„å®ç°ä¸‹AuthenticationTokenæ¥å£å³å¯ã€‚å› ä¸ºtokenè‡ªå·±å·²ç»åŒ…å«äº†ç”¨æˆ·åç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°±å¼„äº†ä¸€ä¸ªå­—æ®µã€‚ å¦‚æœä½ å–œæ¬¢é’»ç ”ï¼Œå¯ä»¥çœ‹çœ‹å®˜æ–¹çš„UsernamePasswordTokenæ˜¯å¦‚ä½•å®ç°çš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class JWTToken implements AuthenticationToken { // å¯†é’¥ private String token; public JWTToken(String token) { this.token = token; } @Override public Object getPrincipal() { return token; } @Override public Object getCredentials() { return token; } } å®ç°Realm\nrealmçš„ç”¨äºå¤„ç†ç”¨æˆ·æ˜¯å¦åˆæ³•çš„è¿™ä¸€å—ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 /** * Description : èº«ä»½æ ¡éªŒæ ¸å¿ƒç±» */ public class MyShiroRealm extends AuthorizingRealm { private static final Logger _logger = LoggerFactory.getLogger(MyShiroRealm.class); @Autowired ManagerInfoService managerInfoService; /** * JWTç­¾åå¯†é’¥ï¼Œè¿™é‡Œæ²¡ç”¨ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ç”¨æˆ·çš„MD5å¯†ç ä½œä¸ºç­¾åå¯†é’¥ */ public static final String SECRET = \u0026#34;9281e268b77b7c439a20b46fd1483b9a\u0026#34;; /** * å¿…é¡»é‡å†™æ­¤æ–¹æ³•ï¼Œä¸ç„¶Shiroä¼šæŠ¥é”™ */ @Override public boolean supports(AuthenticationToken token) { return token instanceof JWTToken; } /** * è®¤è¯ä¿¡æ¯(èº«ä»½éªŒè¯) * Authentication æ˜¯ç”¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½ * * @param auth * @return * @throws AuthenticationException */ @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken auth) throws AuthenticationException { _logger.info(\u0026#34;MyShiroRealm.doGetAuthenticationInfo()\u0026#34;); String token = (String) auth.getCredentials(); // è§£å¯†è·å¾—usernameï¼Œç”¨äºå’Œæ•°æ®åº“è¿›è¡Œå¯¹æ¯” String username = JWTUtil.getUsername(token); if (username == null) { throw new AuthenticationException(\u0026#34;token invalid\u0026#34;); } //é€šè¿‡usernameä»æ•°æ®åº“ä¸­æŸ¥æ‰¾ ManagerInfoå¯¹è±¡ //å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µåšç¼“å­˜ï¼Œå¦‚æœä¸åšï¼ŒShiroè‡ªå·±ä¹Ÿæ˜¯æœ‰æ—¶é—´é—´éš”æœºåˆ¶ï¼Œ2åˆ†é’Ÿå†…ä¸ä¼šé‡å¤æ‰§è¡Œè¯¥æ–¹æ³• ManagerInfo managerInfo = managerInfoService.findByUsername(username); if (managerInfo == null) { throw new AuthenticationException(\u0026#34;User didn\u0026#39;t existed!\u0026#34;); } if (!JWTUtil.verify(token, username, managerInfo.getPassword())) { throw new AuthenticationException(\u0026#34;Username or password error\u0026#34;); } return new SimpleAuthenticationInfo(token, token, \u0026#34;my_realm\u0026#34;); } /** * æ­¤æ–¹æ³•è°ƒç”¨hasRole,hasPermissionçš„æ—¶å€™æ‰ä¼šè¿›è¡Œå›è°ƒ. * \u0026lt;p\u0026gt; * æƒé™ä¿¡æ¯.(æˆæƒ): * 1ã€å¦‚æœç”¨æˆ·æ­£å¸¸é€€å‡ºï¼Œç¼“å­˜è‡ªåŠ¨æ¸…ç©ºï¼› * 2ã€å¦‚æœç”¨æˆ·éæ­£å¸¸é€€å‡ºï¼Œç¼“å­˜è‡ªåŠ¨æ¸…ç©ºï¼› * 3ã€å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†ç”¨æˆ·çš„æƒé™ï¼Œè€Œç”¨æˆ·ä¸é€€å‡ºç³»ç»Ÿï¼Œä¿®æ”¹çš„æƒé™æ— æ³•ç«‹å³ç”Ÿæ•ˆã€‚ * ï¼ˆéœ€è¦æ‰‹åŠ¨ç¼–ç¨‹è¿›è¡Œå®ç°ï¼›æ”¾åœ¨serviceè¿›è¡Œè°ƒç”¨ï¼‰ * åœ¨æƒé™ä¿®æ”¹åè°ƒç”¨realmä¸­çš„æ–¹æ³•ï¼Œrealmå·²ç»ç”±springç®¡ç†ï¼Œæ‰€ä»¥ä»springä¸­è·å–realmå®ä¾‹ï¼Œè°ƒç”¨clearCachedæ–¹æ³•ï¼› * :Authorization æ˜¯æˆæƒè®¿é—®æ§åˆ¶ï¼Œç”¨äºå¯¹ç”¨æˆ·è¿›è¡Œçš„æ“ä½œæˆæƒï¼Œè¯æ˜è¯¥ç”¨æˆ·æ˜¯å¦å…è®¸è¿›è¡Œå½“å‰æ“ä½œï¼Œå¦‚è®¿é—®æŸä¸ªé“¾æ¥ï¼ŒæŸä¸ªèµ„æºæ–‡ä»¶ç­‰ã€‚ * * @param principals * @return */ @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) { /* * å½“æ²¡æœ‰ä½¿ç”¨ç¼“å­˜çš„æ—¶å€™ï¼Œä¸æ–­åˆ·æ–°é¡µé¢çš„è¯ï¼Œè¿™ä¸ªä»£ç ä¼šä¸æ–­æ‰§è¡Œï¼Œ * å½“å…¶å®æ²¡æœ‰å¿…è¦æ¯æ¬¡éƒ½é‡æ–°è®¾ç½®æƒé™ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ”¾åˆ°ç¼“å­˜ä¸­è¿›è¡Œç®¡ç†ï¼› * å½“æ”¾åˆ°ç¼“å­˜ä¸­æ—¶ï¼Œè¿™æ ·çš„è¯ï¼ŒdoGetAuthorizationInfoå°±åªä¼šæ‰§è¡Œä¸€æ¬¡äº†ï¼Œ * ç¼“å­˜è¿‡æœŸä¹‹åä¼šå†æ¬¡æ‰§è¡Œã€‚ */ _logger.info(\u0026#34;æƒé™é…ç½®--\u0026gt;MyShiroRealm.doGetAuthorizationInfo()\u0026#34;); String username = JWTUtil.getUsername(principals.toString()); // ä¸‹é¢çš„å¯ä»¥ä½¿ç”¨ç¼“å­˜æå‡é€Ÿåº¦ ManagerInfo managerInfo = managerInfoService.findByUsername(username); SimpleAuthorizationInfo authorizationInfo = new SimpleAuthorizationInfo(); //è®¾ç½®ç›¸åº”è§’è‰²çš„æƒé™ä¿¡æ¯ for (SysRole role : managerInfo.getRoles()) { //è®¾ç½®è§’è‰² authorizationInfo.addRole(role.getRole()); for (Permission p : role.getPermissions()) { //è®¾ç½®æƒé™ authorizationInfo.addStringPermission(p.getPermission()); } } return authorizationInfo; } } åœ¨doGetAuthenticationInfoä¸­ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æŠ›å‡ºå¾ˆå¤šå¼‚å¸¸ï¼Œè¯¦æƒ…è§æ–‡æ¡£ã€‚\né‡å†™Filter\næ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡Filterï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§æ‰¿å®˜æ–¹çš„BasicHttpAuthenticationFilterï¼Œå¹¶ä¸”é‡å†™é‰´æƒçš„æ–¹æ³•ï¼Œ å¦å¤–é€šè¿‡é‡å†™preHandleï¼Œå®ç°è·¨è¶Šè®¿é—®ã€‚\nä»£ç çš„æ‰§è¡Œæµç¨‹preHandle-\u0026gt;isAccessAllowed-\u0026gt;isLoginAttempt-\u0026gt;executeLogin\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 public class JWTFilter extends BasicHttpAuthenticationFilter { private Logger LOGGER = LoggerFactory.getLogger(this.getClass()); /** * åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æƒ³è¦ç™»å…¥ã€‚ * æ£€æµ‹headeré‡Œé¢æ˜¯å¦åŒ…å«Authorizationå­—æ®µå³å¯ */ @Override protected boolean isLoginAttempt(ServletRequest request, ServletResponse response) { HttpServletRequest req = (HttpServletRequest) request; String authorization = req.getHeader(\u0026#34;Authorization\u0026#34;); return authorization != null; } /** * */ @Override protected boolean executeLogin(ServletRequest request, ServletResponse response) throws Exception { HttpServletRequest httpServletRequest = (HttpServletRequest) request; String authorization = httpServletRequest.getHeader(\u0026#34;Authorization\u0026#34;); JWTToken token = new JWTToken(authorization); // æäº¤ç»™realmè¿›è¡Œç™»å…¥ï¼Œå¦‚æœé”™è¯¯ä»–ä¼šæŠ›å‡ºå¼‚å¸¸å¹¶è¢«æ•è· getSubject(request, response).login(token); // å¦‚æœæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸åˆ™ä»£è¡¨ç™»å…¥æˆåŠŸï¼Œè¿”å›true return true; } /** * è¿™é‡Œæˆ‘ä»¬è¯¦ç»†è¯´æ˜ä¸‹ä¸ºä»€ä¹ˆæœ€ç»ˆè¿”å›çš„éƒ½æ˜¯trueï¼Œå³å…è®¸è®¿é—® * ä¾‹å¦‚æˆ‘ä»¬æä¾›ä¸€ä¸ªåœ°å€ GET /article * ç™»å…¥ç”¨æˆ·å’Œæ¸¸å®¢çœ‹åˆ°çš„å†…å®¹æ˜¯ä¸åŒçš„ * å¦‚æœåœ¨è¿™é‡Œè¿”å›äº†falseï¼Œè¯·æ±‚ä¼šè¢«ç›´æ¥æ‹¦æˆªï¼Œç”¨æˆ·çœ‹ä¸åˆ°ä»»ä½•ä¸œè¥¿ * æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œè¿”å›trueï¼ŒControllerä¸­å¯ä»¥é€šè¿‡ subject.isAuthenticated() æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å…¥ * å¦‚æœæœ‰äº›èµ„æºåªæœ‰ç™»å…¥ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ–¹æ³•ä¸Šé¢åŠ ä¸Š @RequiresAuthentication æ³¨è§£å³å¯ * ä½†æ˜¯è¿™æ ·åšæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ä¸èƒ½å¤Ÿå¯¹GET,POSTç­‰è¯·æ±‚è¿›è¡Œåˆ†åˆ«è¿‡æ»¤é‰´æƒ(å› ä¸ºæˆ‘ä»¬é‡å†™äº†å®˜æ–¹çš„æ–¹æ³•)ï¼Œä½†å®é™…ä¸Šå¯¹åº”ç”¨å½±å“ä¸å¤§ */ @Override protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) { if (isLoginAttempt(request, response)) { try { executeLogin(request, response); } catch (Exception e) { response401(request, response); } } return true; } /** * å¯¹è·¨åŸŸæä¾›æ”¯æŒ */ @Override protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception { HttpServletRequest httpServletRequest = (HttpServletRequest) request; HttpServletResponse httpServletResponse = (HttpServletResponse) response; httpServletResponse.setHeader(\u0026#34;Access-control-Allow-Origin\u0026#34;, httpServletRequest.getHeader(\u0026#34;Origin\u0026#34;)); httpServletResponse.setHeader(\u0026#34;Access-Control-Allow-Methods\u0026#34;, \u0026#34;GET,POST,OPTIONS,PUT,DELETE\u0026#34;); httpServletResponse.setHeader(\u0026#34;Access-Control-Allow-Headers\u0026#34;, httpServletRequest.getHeader(\u0026#34;Access-Control-Request-Headers\u0026#34;)); // è·¨åŸŸæ—¶ä¼šé¦–å…ˆå‘é€ä¸€ä¸ªoptionè¯·æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬ç»™optionè¯·æ±‚ç›´æ¥è¿”å›æ­£å¸¸çŠ¶æ€ if (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) { httpServletResponse.setStatus(HttpStatus.OK.value()); return false; } return super.preHandle(request, response); } /** * å°†éæ³•è¯·æ±‚è·³è½¬åˆ° /401 */ private void response401(ServletRequest req, ServletResponse resp) { try { HttpServletResponse httpServletResponse = (HttpServletResponse) resp; httpServletResponse.sendRedirect(\u0026#34;/401\u0026#34;); } catch (IOException e) { LOGGER.error(e.getMessage()); } } } ç¼–å†™ShiroConfigé…ç½®ç±»\nè¿™é‡Œæˆ‘è¿˜å¢åŠ äº†EhCacheç¼“å­˜ç®¡ç†æ”¯æŒï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½è°ƒç”¨æ•°æ®åº“åšæˆæƒã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 @Configuration @Order(1) public class ShiroConfig { /** * ShiroFilterFactoryBean å¤„ç†æ‹¦æˆªèµ„æºæ–‡ä»¶é—®é¢˜ã€‚ * æ³¨æ„ï¼šå•ç‹¬ä¸€ä¸ªShiroFilterFactoryBeané…ç½®æ˜¯æˆ–æŠ¥é”™çš„ï¼Œä»¥ä¸ºåœ¨ * åˆå§‹åŒ–ShiroFilterFactoryBeançš„æ—¶å€™éœ€è¦æ³¨å…¥ï¼šSecurityManager Filter Chainå®šä¹‰è¯´æ˜ * 1ã€ä¸€ä¸ªURLå¯ä»¥é…ç½®å¤šä¸ªFilterï¼Œä½¿ç”¨é€—å·åˆ†éš” * 2ã€å½“è®¾ç½®å¤šä¸ªè¿‡æ»¤å™¨æ—¶ï¼Œå…¨éƒ¨éªŒè¯é€šè¿‡ï¼Œæ‰è§†ä¸ºé€šè¿‡ * 3ã€éƒ¨åˆ†è¿‡æ»¤å™¨å¯æŒ‡å®šå‚æ•°ï¼Œå¦‚permsï¼Œroles */ @Bean public ShiroFilterFactoryBean shirFilter(SecurityManager securityManager) { ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean(); // å¿…é¡»è®¾ç½® SecurityManager shiroFilterFactoryBean.setSecurityManager(securityManager); //éªŒè¯ç è¿‡æ»¤å™¨ Map\u0026lt;String, Filter\u0026gt; filtersMap = shiroFilterFactoryBean.getFilters(); filtersMap.put(\u0026#34;jwt\u0026#34;, new JWTFilter()); shiroFilterFactoryBean.setFilters(filtersMap); // æ‹¦æˆªå™¨ Map\u0026lt;String, String\u0026gt; filterChainDefinitionMap = new LinkedHashMap\u0026lt;String, String\u0026gt;(); // å…¶ä»–çš„ filterChainDefinitionMap.put(\u0026#34;/**\u0026#34;, \u0026#34;jwt\u0026#34;); // è®¿é—®401å’Œ404é¡µé¢ä¸é€šè¿‡æˆ‘ä»¬çš„Filter filterChainDefinitionMap.put(\u0026#34;/401\u0026#34;, \u0026#34;anon\u0026#34;); filterChainDefinitionMap.put(\u0026#34;/404\u0026#34;, \u0026#34;anon\u0026#34;); shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap); return shiroFilterFactoryBean; } @Bean public SecurityManager securityManager() { DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(); // è®¾ç½®realm. securityManager.setRealm(myShiroRealm()); //æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ securityManager.setCacheManager(ehCacheManager()); // å…³é—­shiroè‡ªå¸¦çš„session DefaultSubjectDAO subjectDAO = new DefaultSubjectDAO(); DefaultSessionStorageEvaluator defaultSessionStorageEvaluator = new DefaultSessionStorageEvaluator(); defaultSessionStorageEvaluator.setSessionStorageEnabled(false); subjectDAO.setSessionStorageEvaluator(defaultSessionStorageEvaluator); securityManager.setSubjectDAO(subjectDAO); return securityManager; } /** * èº«ä»½è®¤è¯realm; (è¿™ä¸ªéœ€è¦è‡ªå·±å†™ï¼Œè´¦å·å¯†ç æ ¡éªŒï¼›æƒé™ç­‰) */ @Bean public MyShiroRealm myShiroRealm() { MyShiroRealm myShiroRealm = new MyShiroRealm(); return myShiroRealm; } /** * å¼€å¯shiro aopæ³¨è§£æ”¯æŒ. ä½¿ç”¨ä»£ç†æ–¹å¼; æ‰€ä»¥éœ€è¦å¼€å¯ä»£ç æ”¯æŒ; * * @param securityManager å®‰å…¨ç®¡ç†å™¨ * @return æˆæƒAdvisor */ @Bean public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) { AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor(); authorizationAttributeSourceAdvisor.setSecurityManager(securityManager); return authorizationAttributeSourceAdvisor; } /** * shiroç¼“å­˜ç®¡ç†å™¨; * éœ€è¦æ³¨å…¥å¯¹åº”çš„å…¶å®ƒçš„å®ä½“ç±»ä¸­ï¼š * 1ã€å®‰å…¨ç®¡ç†å™¨ï¼šsecurityManager * å¯è§securityManageræ˜¯æ•´ä¸ªshiroçš„æ ¸å¿ƒï¼› * * @return */ @Bean public EhCacheManager ehCacheManager() { EhCacheManager cacheManager = new EhCacheManager(); cacheManager.setCacheManagerConfigFile(\u0026#34;classpath:ehcache.xml\u0026#34;); return cacheManager; } } é‡Œé¢URLè§„åˆ™è‡ªå·±å‚è€ƒæ–‡æ¡£http://shiro.apache.org/web.html ï¼Œè¿™ä¸ªåœ¨shiroé‚£ç¯‡è¯´çš„å¾ˆæ¸…æ¥šäº†ã€‚\nè¿è¡ŒéªŒè¯ æœ€åæ˜¯å°†ä»£ç è·‘èµ·æ¥éªŒè¯è¿™ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ã€‚\nå¯åŠ¨SpringBootåï¼Œå…ˆé€šè¿‡POSTè¯·æ±‚ç™»å½•æ‹¿åˆ°token\nç„¶ååœ¨è°ƒç”¨å…¥ç½‘æ¥å£çš„æ—¶å€™åœ¨headerä¸­å¸¦ä¸Šè¿™ä¸ªtokenè®¤è¯ï¼š\nå¦‚æœtokenè®¤è¯ä¸æ­£ç¡®ä¼šæŠ¥å¼‚å¸¸ï¼š\nå¦‚æœä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•ï¼Œè®¤è¯æ­£ç¡®ä½†æ˜¯æˆæƒè®¿é—®æ¥å£å¤±è´¥ï¼Œä¼šè¿”å›å¦‚ä¸‹çš„æœªæˆæƒç»“æœï¼š\nå‚è€ƒæ–‡ç«  RESTful API Authentication Basics\nä»€ä¹ˆæ˜¯ JWT â€“ JSON WEB TOKEN\nShiro+JWT+Spring Boot Restfulç®€æ˜“æ•™ç¨‹\nGitHubæºç  springboot-jwt\n","date":"2018-07-20T21:00:00Z","image":"https://image.tianhui.xin/liveLearn/5/api-security.jpg","permalink":"https://tianhui.xin/p/springboot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90jwt%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/","title":"springBootç³»åˆ— - é›†æˆJWTå®ç°æ¥å£æƒé™è®¤è¯"},{"content":"æœ‰å¾ˆå¤šçš„ç”µå½±æƒ…èŠ‚ï¼Œæ€»è§¦åŠ¨ç€å¤šæ•°äººçš„å¿ƒå¼¦ï¼Œè€Œä½ æˆ‘ä¹Ÿåœ¨ç›¸é‡ç›¸çŸ¥çš„è·¯ä¸Šï¼Œè¶Šèµ°è¶Šè¿œâ€¦ï¼Œæˆ–è®¸æˆ‘ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ„Ÿæ€§çš„äººï¼Œå¯¹äºçˆ±æƒ…ï¼Œæˆ‘éš¾å…è¿˜æ˜¯æœ‰äº›ç¼“ä¸æµæ€¥ã€‚\nç”µå½±è®²è¿°ç€ä¸€å¯¹åŒ—æ¼‚çš„å¹´è½»äººï¼Œåå¹´çš„å…‰é˜´ï¼Œç›¸èšç›¸ç¦»ï¼Œä¹Ÿè®²è¿°äº†åŒ—æ¼‚çš„å¿ƒé…¸ã€‚\nå°æ™“ï¼šâ€œä¸ºä»€ä¹ˆä»æ¥æ²¡æœ‰ä¸€ä¸ªæ•…äº‹ï¼Œä»å¤´åˆ°å°¾éƒ½æ˜¯å¹¸ç¦çš„ï¼Ÿâ€\nè§æ¸…ï¼šâ€œå¹¸ç¦ä¸æ˜¯æ•…äº‹ï¼Œä¸å¹¸æ‰æ˜¯ã€‚â€\nå°æ™“ï¼šâ€œé‚£æˆ‘ä¸æƒ³å’Œä½ ä¹‹é—´å‘ç”Ÿä»€ä¹ˆæ•…äº‹äº†ã€‚\nè¿˜æœ‰åœ¨ä»–ä»¬åœ¨æ¡æ¥çš„æ²™å‘ä¸Š\nå°æ™“ï¼šâ€œæˆ‘ä»¬ç°åœ¨è¿™ä¹ˆå¥½ï¼Œå¦‚æœä»¥åæˆ‘ä»¬åˆ†æ‰‹äº†æˆ‘è¿‡çš„ä¸å¥½ï¼Œä½ ä¼šå¼€å¿ƒå—ï¼Ÿâ€\nè§æ¸…ï¼šâ€œä¸ä¼šã€‚â€\nå°æ™“ï¼šâ€œè¿‡å¾—å¼€å¿ƒå‘¢ï¼Ÿâ€\nè§æ¸…ï¼šâ€œä¹Ÿä¸ä¼šã€‚â€\nå°æ™“ï¼šâ€œä¸ºä»€ä¹ˆï¼Ÿâ€\nè§æ¸…ï¼šâ€œå› ä¸ºä¸æ˜¯æˆ‘è®©ä½ å¼€å¿ƒçš„ã€‚â€\næˆ‘ç›¸ä¿¡å¾ˆå¤šäººæ²¡æœ‰æœºä¼šè®¤çœŸå¯¹å‰ä»»è¯´è¿™æ ·çš„è¯ã€‚\næˆ‘ä»¬æ²¡æœ‰å‹‡æ°”åœ¨å†è§åˆ°å‰ä»»æ—¶é—®é‚£ä¹ˆå¤šâ€œå¦‚æœâ€\nå¦‚æœå½“æ—¶ä½ æ²¡èµ°ï¼Œåæ¥çš„æˆ‘ä»¬ä¼šä¸ä¼šä¸ä¸€æ ·\nå¦‚æœå½“æ—¶ä½ æœ‰å‹‡æ°”ä¸Šåœ°é“ï¼Œæˆ‘ä¼šè·Ÿä½ ä¸€è¾ˆå­\nå¦‚æœé‚£æ—¶ä½ æ²¡æœ‰è·Ÿæˆ‘åˆ†æ‰‹å‘¢\né‚£æˆ‘ä»¬ä¹‹åä¹Ÿä¼šåˆ†æ‰‹\nå¦‚æœæˆ‘ä»¬ä¸€èµ·åšæŒåˆ°æœ€åå‘¢\né‚£ä¹Ÿè®¸ä½ å°±ä¸ä¼šæˆåŠŸ\nå¦‚æœå½“æ—¶æˆ‘è¶³å¤Ÿæœ‰é’±ï¼Œæˆ‘ä»¬ä½è¿›ä¸€ä¸ªæœ‰å¤§æ²™å‘çš„å¤§æˆ¿å­\né‚£ä½ å¯èƒ½å·²ç»æ‰¾äº†ä¸ä¸‹åä¸ªå°ä¸‰\nå¦‚æœå½“æ—¶æˆ‘ä»¬å°±æ˜¯ä¸ç®¡ä¸é¡¾ï¼Œæˆ‘ä»¬å°±æ˜¯ç»“å©šäº†å‘¢\né‚£æˆ‘ä»¬ç¦»å©šå¥½å¤šå¹´äº†\nå¦‚æœæˆ‘ä»¬æ²¡æœ‰ç¦»å®¶å»åŒ—äº¬\nå¦‚æœæ²¡æœ‰å¦‚æœ\nåæ¥ä¹Ÿæ²¡æœ‰åæ¥\nåæ¥ï¼Œæˆ‘ä»¬ä»€ä¹ˆéƒ½æœ‰äº†\nå´æ²¡æœ‰äº†æˆ‘ä»¬\nçˆ±æƒ…å¾ˆç¾å¥½ï¼Œå¯æ˜¯ç”Ÿæ´»å´å¾ˆè‰°éš¾ã€‚å®¶é‡Œå¾ˆæ¸©æš–ï¼Œå¯æ˜¯è¯¥æ­»çš„æ¢¦æƒ³å´åœ¨è¿œæ–¹ã€‚\nåæ¥æˆ‘ä»¬ä»€ä¹ˆéƒ½æœ‰äº†ï¼Œå¯æ˜¯å´æ²¡æœ‰äº†å½¼æ­¤ã€‚\nåœ¨è¿™ä»½æ„Ÿæƒ…ä¸­ï¼Œå¥³å­©è¦æ±‚çš„è¶Šæ¥è¶Šå°‘ï¼Œæœ€ç»ˆè¦çš„ä¸è¿‡æ˜¯ä½ åœ¨æ„æˆ‘;\nç”·å­©å´æƒ³è¦çš„è¶Šæ¥è¶Šå¤šï¼Œé™¤äº†çˆ±ï¼Œè¿˜æœ‰è‡ªå°Šå¿ƒã€è™šè£å¿ƒï¼Œç”šè‡³æ˜¯æ–°é²œæ„Ÿã€‚\nåœ¨å›å®¶çš„è½¦ä¸­ï¼Œå…³å°æ™“å¯¹æ—è§æ¸…è¯´ï¼šI miss you\næ—è§æ¸…å›ç­”ï¼šæˆ‘ä¹Ÿæƒ³ä½ ã€‚\nè€Œå…³å°æ™“è¯´ï¼šæˆ‘æ˜¯è¯´æˆ‘é”™è¿‡äº†ä½ ã€‚\nå‘½è¿å¯èƒ½å°±æ˜¯è¿™æ ·é˜´å·®é˜³é”™ï¼Œå“ªæœ‰é‚£ä¹ˆå¤šä¸ºä»€ä¹ˆï¼Ÿæ—çˆ¶åœ¨ç»™å…³å°æ™“ä¸­çš„ä¿¡ä¸­å†™åˆ°â€œä½ ä»¬ä¸è´Ÿå½¼æ­¤ï¼Œä¸å¿…å¼ºæ±‚ä¸è´Ÿæ­¤ç”Ÿâ€ï¼Œæˆ‘ç›¸ä¿¡çœ‹å“­äº†å¾ˆå¤šäººï¼Œåˆå¬ä¸æ‡‚æ›²ä¸­æ„ï¼Œå¬æ‡‚å·²æ˜¯æ›²ä¸­äººã€‚\nçœ‹å®Œå¬å®Œï¼Œå¿ƒé‡Œè½»è½»åœ°ç–¼ä¸€ä¸‹ï¼Œç„¶åæ”¶æ‹¾å¿ƒæƒ…ï¼Œç»§ç»­å®Œæˆä½ ç°åœ¨çš„ç”Ÿæ´»ï¼Œä¹Ÿæ„¿ä½ æ‰¾åˆ°èƒ½ä¸ºä½ â€œä¸Šä¹å¤©æ½æœˆï¼Œä¸‹äº”æ´‹æ‰é³–â€çš„é‚£ä½ã€‚\nç´ ææ¥è‡ªå‡¯è¯´\n","date":"2018-04-30T23:00:00Z","image":"https://image.tianhui.xin/slowLife/8/4.jpg","permalink":"https://tianhui.xin/p/%E5%90%8E%E6%9D%A5%E7%9A%84%E6%88%91%E4%BB%AC/","title":"åæ¥çš„æˆ‘ä»¬"},{"content":"å››æœˆçš„å¤©ï¼Œé—å¤±ç€é»„æ˜çš„ç–²å€¦ï¼Œæ’’è½çš„å´æ˜¯èŠ±å¼€çš„å…‰é˜´ã€‚æœ€åçš„æ—¥å­é‡Œï¼Œæˆ‘ä»¬çš„å›å¿†ä¸æ•£ã€‚\nå·²æ˜¯äººé—´æœ€ç¾å››æœˆå¤©ï¼Œæˆ‘ä»¬æ¥åœºè¯´èµ°å°±èµ°çš„æ—…è¡Œï¼Œå››æœˆï¼Œè¿™ä¸ªä¸‡èŠ±ç››å¼€çš„å­£èŠ‚ï¼Œæˆ‘ä»¬å»äº†å“ªï¼Ÿ\näº‘è’™å±±å›½å®¶æ£®æ—å…¬å›­ä½äºå¯†äº‘åŸåŒºè¥¿éƒ¨ã€‚äº‘è’™å±±ï¼Œå¤ç§°äº‘æ¢¦å±±ï¼Œæ˜¯äº¬éƒŠæœ‰åçš„è‡ªç„¶é£æ™¯åŒºã€‚å…¬å›­æ€»é¢ç§¯2208å…¬é¡·ï¼Œä¸»å³°æµ·æ‹”1414ç±³ã€‚å›­å†…æ™¯è§‚èµ„æºä¸°å¯Œï¼Œæ˜¯ä¸€åº§å…·æœ‰å±±å²³é£å…‰ç‰¹å¾çš„åŒ—äº¬éƒŠå¤–é£æ™¯åèƒœåŒºï¼Œæœ‰åŒ—æ–¹â€œå°é»„å±±â€ç¾ç§°ã€‚ï¼ˆè£è‡ªæŸåº¦ï¼Œå˜¿å˜¿ï¼‰\næˆ‘ä»¬é€‰æ‹©äº†åŒ…è½¦å‡ºè¡Œï¼Œä¸€è¡ŒäºŒåå‡ äººï¼Œä»åŒ—äº¬åˆ°é™„è¿‘æ°‘å®¿ï¼Œä¹Ÿå°±1ä¸ªå¤šå°æ—¶çš„è¡Œç¨‹ï¼Œåƒå®Œæ—©é¥­æˆ‘ä»¬10ç‚¹åˆ°è¾¾å±±è„šï¼Œåœ¨è·¯ä¸Šé€‰æ‹©ç¾å›¢è´­ç¥¨ï¼Œå› ä¸ºæˆ‘ä»¬çœ‹åˆ°ç¾å›¢çš„ç¥¨æ˜¯æœ‰ä¼˜æƒ çš„ï¼Œåˆ°æ™¯ç‚¹é—®å·¥ä½œäººå‘˜æ‰çŸ¥ï¼Œç¾å›¢è´­ç¥¨å¿…é¡»æå‰ä¸¤å°æ—¶ï¼Œæœ€ç»ˆæˆ‘ä»¬æ— å¥ˆçš„é€‰æ‹©äº†è‡ªåŠ©è´­ç¥¨ã€‚\nè¿›å…¥æ™¯åŒºï¼Œæ­¤æ—¶æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯é«˜è€¸çš„å±±è„‰ï¼Œè‡ªæˆä¸€ä½“çš„å±±è„‰è®©å®ƒä»ä¼—å±±ä¸­è„±é¢–è€Œå‡ºï¼Œä¼—äººå£®å¿—è±ªè¨€ï¼Œè¦æ„Ÿå—ä¸€ä¸‹ä¸€è§ˆä¼—å±±å°çš„æ¿€æƒ…ï¼Œå…¶å®å´å²–çš„å±±è·¯ä¹Ÿè¿˜å¯ä»¥ï¼Œæœ‰ä¸“äººç”¨çŸ³å¤´æ­å»ºçš„çŸ³æ¢¯ï¼Œæœ‰ä½¿ç”¨æœ¨å¤´å’Œæ³¥åœŸæ­å»ºçš„ç®€æ˜“é“è·¯ï¼Œä¹Ÿæœ‰è‡ªç„¶è€Œæˆçš„è·¯ï¼Œå¤äººæœ‰äº‘ï¼Œä¸–ä¸Šæœ¬æ˜¯æ²¡æœ‰è·¯çš„ï¼Œèµ°çš„äººå¤šäº†ï¼Œå®ƒä¹Ÿå°±æˆä¸ºäº†è·¯ã€‚\næˆ‘ä»¬ä¸€è·¯å¬‰æˆï¼ŒæŒ‰ç…§æ™¯ç‚¹åœ°å›¾ä¸€è·¯å‰è¡Œç€ï¼Œè·¯é€”ä¸­ï¼Œèƒ½åœ¨å±±æ¶§ä¸­çœ‹åˆ°å±±æ°´å‡ç»“çš„å†°å—å¹¶æ²¡æœ‰éšç€åŒ—äº¬çš„å‡æ¸©è€ŒèåŒ–ï¼Œèƒ½çœ‹è§åšæŒºçš„é’æ¾ç»¿æ„ç›ç„¶ï¼Œæç™½æ›¾æœ‰è¯—å¥,â€œå‹—å›é’æ¾å¿ƒï¼ŒåŠªåŠ›ä¿éœœé›ªâ€ï¼Œèµæ‰¬ç€é’æ¾çš„å››å­£å¸¸é’ã€‚\nè§‚å…¶å½¢æ„ä¸‡åƒçš„å±±çŸ³ï¼Œå±±çŸ³å³¥åµ˜é™©å³­ï¼Œå±±è·¯ç‹­çª„åƒç¾Šè‚ ï¼Œé‚£æ˜¯å¤§è‡ªç„¶çš„é¬¼æ–§ç¥å·¥ï¼Œä»Šå¹´çš„åŒ—äº¬ï¼Œä¸‡èŠ±ç››å¼€ï¼Œå½·ä½›æœ‰äº›çŠçŠæ¥è¿Ÿï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°é‚£æ˜ å±±çº¢çš„ç»¿å¶è¡¬çº¢èŠ±ï¼Œå¿ƒä¸­æ€»æœ‰ä¸€ç§â€œäº‰å¥ˆç»“æ ¹æ·±çŸ³åº•ï¼Œæ— å› ç§»å¾—åˆ°äººå®¶â€çš„æ„Ÿè§¦ã€‚\nä¸€è·¯çš„ç©è€ï¼Œä¼´éšé¥¥æ¸´ï¼Œæˆ‘ä»¬å»åˆ°ä¸»å³°çš„å±±é¡¶ï¼Œé‚£é‡ŒçœŸçš„èƒ½ä¸€è§ˆçºµå±±å°å‘¢ï¼Œæµ·æ‹”1400å¤šç±³ï¼Œä»å±±è„šä¸Šå»ï¼Œæ€ä¹ˆä¹Ÿçˆ¬äº†200å±‚çš„æ ·å­ï¼Œæˆ‘å¹¶æ²¡æœ‰èƒ½ä¸Šå»ï¼Œäº‹å…ˆå¹¶æ²¡æœ‰çœ‹è¿‡æ”»ç•¥ï¼Œä¸€é‡äººæ¯äººå°±å¸¦äº†ä¸€ç“¶æ°´ï¼Œå´éƒ½æœ‰ç€â€œæ¬²ä¸å¤©å·¥è¯•æ¯”é«˜â€çš„è±ªæƒ…ï¼Œè·‘åˆ°åŠå±±çš„æ—¶å€™ä¼™ä¼´ä»¬å·²ç»é¥¿çš„ä¸æˆæ ·å­äº†ï¼Œè·¯ä¸Šçœ‹è§å…¶å®ƒç™»å±±äººå£«ï¼Œå¸¦ç€å„ç§åƒçš„å–å¾—ï¼Œæœ‰æ²¡æœ‰ä¸€ç§æƒ³å†²ä¸Šå»æš´åƒçš„å†²åŠ¨ï¼›åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œè€ç€é¥¥æ¸´ï¼Œä»–ä»¬é¡ºåˆ©åˆ°è¾¾äº†é¡¶å³°ï¼Œé€‰æ‹©äº†å¦ä¸€æ¡é“ä¸‹å±±ï¼Œè€Œæˆ‘å®åœ¨æ²¡äº†åŠ›æ°”ï¼Œæœ€ç»ˆé€‰æ‹©äº†åŸè·¯è¿”å›ã€‚åˆ°è¾¾ä¸»å³°å±±è„šçš„æ—¶å€™ï¼Œä¸‹åˆå››ç‚¹é’Ÿï¼Œä¼—äººé¥¿çš„ä¸è¡Œï¼Œå±±è„šä¸‹æœ‰å½“åœ°äººåœ¨å–ä¸œè¥¿ï¼Œä¸è¿‡ä¹°çš„æœ‰ç‚¹è´µï¼Œä½†å¯¹äºæ­¤æ—¶çš„æˆ‘ä»¬ï¼Œè´µç‚¹ä¹Ÿå¾—å……é¥¥å•Šï¼Œä¸ç„¶æˆ‘è§‰å¾—éƒ½éš¾é¡ºåˆ©çš„å¾€è¿”äº†ï¼›å•†åº—å¤§çˆ·äººæŒºå¥½ï¼Œæä¾›æ‰«ç æ”¯ä»˜ï¼Œä¸è¿‡æˆ‘è·Ÿä½ è®²ï¼Œä½ æœ€å¥½å¸¦ç‚¹ç°é‡‘ï¼Œå› ä¸ºå¤§å±±æ²¡ä¿¡å·ï¼Œo(âˆ©_âˆ©)o å“ˆå“ˆ\nå¥½äº†ï¼Œä»Šå¤©å°±æƒ³è¾£ä¹ˆå¤šäº†ï¼Œæˆ‘ä»¬ä¸‹æ¬¡æ±Ÿæ¹–è§ï¼Œè®°å¾—æˆ‘ä»¬çš„å£å·æ˜¯ï¼Œå¤©ç‹ç›–åœ°è™\u0026hellip;\n","date":"2018-04-28T22:00:00Z","image":"https://image.tianhui.xin/slowLife/1.jpg","permalink":"https://tianhui.xin/p/%E4%BA%91%E8%92%99%E5%B1%B1%E4%B8%80%E6%97%A5%E6%B8%B8/","title":"äº‘è’™å±±ä¸€æ—¥æ¸¸"}]