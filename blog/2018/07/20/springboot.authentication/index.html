<!doctype html><html lang=zh><head><meta charset=utf-8><title>springBoot系列 - 集成JWT实现接口权限认证</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content="怪咖晨,个人博客,java,spring cloud,spring boot,huangtianhui,springboot,Java"><meta name=description content="springBoot系列 - 集成JWT实现接口权限认证"><meta name=author content="huangtianhui"><meta name=generator content="Hugo 0.78.1"><link rel=stylesheet href=https://tianhui.xin/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://tianhui.xin/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://tianhui.xin/plugins/slick/slick.css><link href=https://tianhui.xin/css/animate.min.css rel=stylesheet media=screen><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@8.0.0/themes/reset-min.css integrity="sha256-2AeJLzExpZvqLUxMfcs+4DWcMwNfpnjUeAAvEtPr0wU=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@8.0.0/themes/satellite-min.css integrity="sha256-p/rGN4RGy6EDumyxF9t7LKxWGg6/MZfGhJM/asKkqvA=" crossorigin=anonymous><link href=https://tianhui.xin/css/style.min.aa098d6308cd50eb086d8a887786f77e.css rel=stylesheet media=screen><link rel="shortcut icon" href=https://tianhui.xin/images/favicon.png type=image/x-icon><link rel=icon href=https://tianhui.xin/images/favicon.png type=image/x-icon><meta property="og:image" content="https://image.tianhui.xin/liveLearn/5/api-security.jpg"><meta property="og:title" content="springBoot系列 - 集成JWT实现接口权限认证"><meta property="og:description" content="springBoot系列 - 集成JWT实现接口权限认证"><meta property="og:type" content="article"><meta property="og:url" content="https://tianhui.xin/blog/2018/07/20/springboot.authentication/"><meta property="article:published_time" content="2018-07-20T21:00:00+00:00"><meta property="article:modified_time" content="2018-07-20T21:00:00+00:00"></head><body><div class=preloader></div><header class=header-area><div class=main-header-area><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=nav-brand href=https://tianhui.xin/><img width=66px src=https://tianhui.xin/images/logo.png alt=怪咖晨></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navigation aria-expanded=false aria-label="Toggle navigation">
<i class=ti-menu></i></button><div class="collapse navbar-collapse" id=navigation><div class=navbar-close data-toggle=collapse data-target=#navigation><button class=navbar-toggler type=button>
<i class=ti-close></i></button></div><div class=navbar-warp><ul class="navbar-nav mx-auto"><li class=nav-item><a class=nav-link href=https://tianhui.xin/>首页</a></li><li class=nav-item><a class=nav-link href=https://tianhui.xin/blog>博客</a></li><li class=nav-item><a class=nav-link href=https://tianhui.xin/categories/%E5%AD%A6%E6%97%A0%E6%AD%A2%E5%A2%83/>学无止境</a></li><li class=nav-item><a class=nav-link href=https://tianhui.xin/about>关于我</a></li><li class=nav-item><a class=nav-link href=https://tianhui.xin/search>搜索</a></li></ul><a href=//github.com/homeant class="btn btn-sm btn-primary ml-3">关注我</a></div></div></nav></div></div></header><div class="banner-area bg-img" style=background-image:url(https://tianhui.xin/images/banner.png)><div class=container><div class="row justify-content-center"><div class="col-12 col-sm-9 col-xl-6"><div class="banner-content text-center"><h2>怪咖晨</h2><p>多年软件开发经验</p><p>致力于微服务、DDD实践</p></div></div></div></div></div><section class=section><div class=container><div class=row><div class="col-lg-10 mx-auto"><h2>springBoot系列 - 集成JWT实现接口权限认证</h2><div class=content><p>springBoot系列 - 集成JWT实现接口权限认证</p><p>一般来讲，对于RESTful API都会有认证(Authentication)和授权(Authorization)过程，保证API的安全性。</p><p><strong>Authentication vs. Authorization</strong></p><p>Authentication指的是确定这个用户的身份，Authorization是确定该用户拥有什么操作权限。</p><p><strong>认证方式一般有三种</strong></p><h4 id=basic-authentication><strong>Basic Authentication</strong></h4><p>这种方式是直接将用户名和密码放到Header中，使用Authorization: Basic Zm9vOmJhcg==，使用最简单但是最不安全。</p><h4 id=token认证><strong>TOKEN认证</strong></h4><p>这种方式也是再HTTP头中，使用Authorization: Bearer ，使用最广泛的TOKEN是JWT，通过签名过的TOKEN。</p><h4 id=oauth20><strong>OAuth2.0</strong></h4><p>这种方式安全等级最高，但是也是最复杂的。如果不是大型API平台或者需要给第三方APP使用的，没必要整这么复杂。
一般项目中的RESTful API使用JWT来做认证就足够了。</p><h2 id=什么是jwt>什么是JWT</h2><p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（(RFC 7519).该token被设计为紧凑且安全的， 特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息， 以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p><p>JWT官网：<a href=https://jwt.io/>https://jwt.io/</a></p><p>JWT是由三段信息构成的，将这三段信息文本用.链接一起就构成了Jwt字符串。就像这样:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span style=color:#000;font-weight:700>.</span><span style=color:teal>eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span>
</code></pre></td></tr></table></div></div><h3 id=jwt的构成>JWT的构成</h3><p>第一部分我们称它为头部（header),第二部分我们称其为载荷（payload, 类似于飞机上承载的物品)，第三部分是签证（signature)。</p><p><strong>header</strong></p><p>jwt的头部承载两部分信息：</p><ul><li>声明类型，这里是jwt</li><li>声明加密的算法 通常直接使用 HMAC SHA256</li></ul><p>这里的加密算法是单向函数散列算法，常见的有MD5、SHA、HAMC。这里使用基于密钥的Hash算法HMAC生成散列值。</p><ul><li>MD5 message-digest algorithm 5 （信息-摘要算法）缩写，广泛用于加密和解密技术，常用于文件校验。校验？不管文件多大，经过MD5后都能生成唯一的MD5值</li><li>SHA (Secure Hash Algorithm，安全散列算法），数字签名等密码学应用中重要的工具，安全性高于MD5</li><li>HMAC (Hash Message Authentication Code，散列消息鉴别码，基于密钥的Hash算法的认证协议。用公开函数和密钥产生一个固定长度的值作为认证标识，用这个标识鉴别消息的完整性。</li></ul><p>常用于接口签名验证完整的头部就像下面这样的JSON：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2>2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3>3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4>4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
<span style=color:#a61717;background-color:#e3d2d2>&#39;typ&#39;:</span> <span style=color:#a61717;background-color:#e3d2d2>&#39;JWT&#39;,</span>
<span style=color:#a61717;background-color:#e3d2d2>&#39;alg&#39;:</span> <span style=color:#a61717;background-color:#e3d2d2>&#39;HS256&#39;</span>
}
</code></pre></td></tr></table></div></div><p>然后将头部进行base64加密（该加密是可以对称解密的),构成了第一部分</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9
</code></pre></td></tr></table></div></div><p><strong>playload</strong></p><p>载荷就是存放有效信息的地方，这些有效信息包含三个部分：</p><ul><li>标准中注册的声明</li><li>公共的声明</li><li>私有的声明</li></ul><p>标准中注册的声明 (建议但不强制使用) ：</p><ul><li>iss: jwt签发者</li><li>sub: jwt所面向的用户</li><li>aud: 接收jwt的一方</li><li>exp: jwt的过期时间，这个过期时间必须要大于签发时间</li><li>nbf: 定义在什么时间之前，该jwt都是不可用的.</li><li>iat: jwt的签发时间</li><li>jti: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</li></ul><p>公共的声明：</p><p>公共的声明可以添加任何的信息，一般添加用户的相关信息或其他业务需要的必要信息.但不建议添加敏感信息，因为该部分在客户端可解密</p><p>私有的声明：</p><p>私有声明是提供者和消费者所共同定义的声明，一般不建议存放敏感信息，因为base64是对称解密的，意味着该部分信息可以归类为明文信息。</p><p>定义一个payload:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2>2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3>3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4>4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5>5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
<span style=color:navy>&#34;sub&#34;</span>: <span style=color:#d14>&#34;1234567890&#34;</span>,
<span style=color:navy>&#34;name&#34;</span>: <span style=color:#d14>&#34;John Doe&#34;</span>,
<span style=color:navy>&#34;admin&#34;</span>: <span style=color:#000;font-weight:700>true</span>
}
</code></pre></td></tr></table></div></div><p>然后将其进行base64加密，得到Jwt的第二部分：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9
</code></pre></td></tr></table></div></div><p><strong>signature</strong></p><p>jwt的第三部分是一个签证信息，这个签证信息由三部分组成：</p><ul><li>header (base64后的)</li><li>payload (base64后的)</li><li>secret</li></ul><p>这个部分需要base64加密后的header和base64加密后的payload使用.连接组成的字符串， 然后通过header中声明的加密方式进行加盐secret组合加密，然后就构成了jwt的第三部分。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2>2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3>3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#998;font-style:italic>// javascript
</span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>var</span> encodedString <span style=color:#000;font-weight:700>=</span> base64UrlEncode(header) <span style=color:#000;font-weight:700>+</span> <span style=color:#d14>&#39;.&#39;</span> <span style=color:#000;font-weight:700>+</span> base64UrlEncode(payload);
<span style=color:#000;font-weight:700>var</span> signature <span style=color:#000;font-weight:700>=</span> HMACSHA256(encodedString, <span style=color:#d14>&#39;secret&#39;</span>); <span style=color:#998;font-style:italic>// TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
</span></code></pre></td></tr></table></div></div><p>将这三部分用.连接成一个完整的字符串,构成了最终的jwt:</p><p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</p><p>==注意==：secret是保存在服务器端的，jwt的签发生成也是在服务器端的，secret就是用来进行jwt的签发和jwt的验证， 所以，它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了。</p><h2 id=如何应用>如何应用</h2><p>一般是在请求头里加入Authorization，并加上Bearer标注：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2>2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3>3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4>4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5>5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>fetch(<span style=color:#d14>&#39;api/user/1&#39;</span>, {
    headers<span style=color:#000;font-weight:700>:</span> {
        <span style=color:#d14>&#39;Authorization&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#d14>&#39;Bearer &#39;</span> <span style=color:#000;font-weight:700>+</span> token
    }
})
</code></pre></td></tr></table></div></div><p>服务器负责解析这个HTTP头来做用户认证和授权处理。大致流程如下：</p><p><img src=http://image.tianhui.xin/liveLearn/5/jwt20.png alt=流程></p><h2 id=安全相关>安全相关</h2><p>JWT协议本身不具备安全传输功能，所以必须借助于SSL/TLS的安全通道，所以建议如下：</p><ol><li>不应该在jwt的payload部分存放敏感信息，因为该部分是客户端可解密的部分。</li><li>保护好secret私钥，该私钥非常重要。</li><li>如果可以，请使用https协议</li></ol><h1 id=和springboot集成>和SpringBoot集成</h1><p>简要的说明下我们为什么要用JWT，因为我们要实现完全的前后端分离，所以不可能使用session，cookie的方式进行鉴权， 所以JWT就被派上了用场，可以通过一个加密密钥来进行前后端的鉴权。</p><p><strong>程序逻辑</strong></p><ol><li>我们POST用户名与密码到/login进行登入，如果成功返回一个加密token，失败的话直接返回401错误。</li><li>之后用户访问每一个需要权限的网址请求必须在header中添加Authorization字段，例如Authorization: token，token为密钥。</li><li>后台会进行token的校验，如果不通过直接返回401。</li></ol><p><strong>这里我讲一下如何在SpringBoot中使用JWT来做接口权限认证，安全框架依旧使用Shiro，JWT的实现使用 jjwt</strong></p><h3 id=添加maven依赖>添加Maven依赖</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33>33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34>34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35>35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36>36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37>37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38>38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39>39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40>40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41>41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42>42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43>43
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:navy>&lt;dependency&gt;</span> 
	<span style=color:navy>&lt;groupId&gt;</span>org.springframework.boot<span style=color:navy>&lt;/groupId&gt;</span>  
	<span style=color:navy>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:navy>&lt;/artifactId&gt;</span>  
	<span style=color:navy>&lt;exclusions&gt;</span> 
	  <span style=color:navy>&lt;exclusion&gt;</span> 
		<span style=color:navy>&lt;groupId&gt;</span>org.springframework.boot<span style=color:navy>&lt;/groupId&gt;</span>  
		<span style=color:navy>&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span style=color:navy>&lt;/artifactId&gt;</span> 
	  <span style=color:navy>&lt;/exclusion&gt;</span> 
	<span style=color:navy>&lt;/exclusions&gt;</span> 
<span style=color:navy>&lt;/dependency&gt;</span>  
<span style=color:navy>&lt;dependency&gt;</span> 
	<span style=color:navy>&lt;groupId&gt;</span>org.springframework.boot<span style=color:navy>&lt;/groupId&gt;</span>  
	<span style=color:navy>&lt;artifactId&gt;</span>spring-boot-starter-jetty<span style=color:navy>&lt;/artifactId&gt;</span> 
<span style=color:navy>&lt;/dependency&gt;</span>  
<span style=color:navy>&lt;dependency&gt;</span> 
	<span style=color:navy>&lt;groupId&gt;</span>com.auth0<span style=color:navy>&lt;/groupId&gt;</span>  
	<span style=color:navy>&lt;artifactId&gt;</span>java-jwt<span style=color:navy>&lt;/artifactId&gt;</span>  
	<span style=color:navy>&lt;version&gt;</span>3.3.0<span style=color:navy>&lt;/version&gt;</span> 
<span style=color:navy>&lt;/dependency&gt;</span>  
<span style=color:#998;font-style:italic>&lt;!-- shiro 权限控制 --&gt;</span>  
<span style=color:navy>&lt;dependency&gt;</span> 
	<span style=color:navy>&lt;groupId&gt;</span>org.apache.shiro<span style=color:navy>&lt;/groupId&gt;</span>  
	<span style=color:navy>&lt;artifactId&gt;</span>shiro-spring<span style=color:navy>&lt;/artifactId&gt;</span>  
	<span style=color:navy>&lt;version&gt;</span>1.4.0<span style=color:navy>&lt;/version&gt;</span>  
	<span style=color:navy>&lt;exclusions&gt;</span> 
	  <span style=color:navy>&lt;exclusion&gt;</span> 
		<span style=color:navy>&lt;artifactId&gt;</span>slf4j-api<span style=color:navy>&lt;/artifactId&gt;</span>  
		<span style=color:navy>&lt;groupId&gt;</span>org.slf4j<span style=color:navy>&lt;/groupId&gt;</span> 
	  <span style=color:navy>&lt;/exclusion&gt;</span> 
	<span style=color:navy>&lt;/exclusions&gt;</span> 
<span style=color:navy>&lt;/dependency&gt;</span>  
<span style=color:#998;font-style:italic>&lt;!-- shiro ehcache (shiro缓存)--&gt;</span>  
<span style=color:navy>&lt;dependency&gt;</span> 
	<span style=color:navy>&lt;groupId&gt;</span>org.apache.shiro<span style=color:navy>&lt;/groupId&gt;</span>  
	<span style=color:navy>&lt;artifactId&gt;</span>shiro-ehcache<span style=color:navy>&lt;/artifactId&gt;</span>  
	<span style=color:navy>&lt;version&gt;</span>1.4.0<span style=color:navy>&lt;/version&gt;</span>  
	<span style=color:navy>&lt;exclusions&gt;</span> 
	  <span style=color:navy>&lt;exclusion&gt;</span> 
		<span style=color:navy>&lt;artifactId&gt;</span>slf4j-api<span style=color:navy>&lt;/artifactId&gt;</span>  
		<span style=color:navy>&lt;groupId&gt;</span>org.slf4j<span style=color:navy>&lt;/groupId&gt;</span> 
	  <span style=color:navy>&lt;/exclusion&gt;</span> 
	<span style=color:navy>&lt;/exclusions&gt;</span> 
<span style=color:navy>&lt;/dependency&gt;</span> 
</code></pre></td></tr></table></div></div><h3 id=创建用户service>创建用户Service</h3><p>这个在shiro一节讲过如果创建角色权限表，添加用户Service来执行查找用户操作，这里就不多讲具体实现了，只列出关键代码：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>* 通过名称查找用户
</span><span style=color:#998;font-style:italic>*
</span><span style=color:#998;font-style:italic>* @param username
</span><span style=color:#998;font-style:italic>* @return
</span><span style=color:#998;font-style:italic>*/</span>
<span style=color:#000;font-weight:700>public</span> ManagerInfo <span style=color:#900;font-weight:700>findByUsername</span><span style=color:#000;font-weight:700>(</span>String username<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    ManagerInfo managerInfo <span style=color:#000;font-weight:700>=</span> managerInfoDao<span style=color:#000;font-weight:700>.</span><span style=color:teal>findByUsername</span><span style=color:#000;font-weight:700>(</span>username<span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>managerInfo <span style=color:#000;font-weight:700>==</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>throw</span> <span style=color:#000;font-weight:700>new</span> UnknownAccountException<span style=color:#000;font-weight:700>();</span>
    <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>return</span> managerInfo<span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><h3 id=用户信息类>用户信息类：</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>ManagerInfo</span> <span style=color:#000;font-weight:700>implements</span> Serializable <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>private</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#000;font-weight:700>final</span> <span style=color:#458;font-weight:700>long</span> serialVersionUID <span style=color:#000;font-weight:700>=</span> 1L<span style=color:#000;font-weight:700>;</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 主键ID
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> Integer id<span style=color:#000;font-weight:700>;</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 账号
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> String username<span style=color:#000;font-weight:700>;</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 密码
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> String password<span style=color:#000;font-weight:700>;</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * md5密码盐
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> String salt<span style=color:#000;font-weight:700>;</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 一个管理员具有多个角色
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> List<span style=color:#000;font-weight:700>&lt;</span>SysRole<span style=color:#000;font-weight:700>&gt;</span> roles<span style=color:#000;font-weight:700>;</span>
</code></pre></td></tr></table></div></div><h3 id=jwt工具类>JWT工具类</h3><p>我们写一个简单的JWT加密，校验工具，并且使用用户自己的密码充当加密密钥， 这样保证了token 即使被他人截获也无法破解。并且我们在token中附带了username信息，并且设置密钥5分钟就会过期。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33>33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34>34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35>35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36>36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37>37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38>38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39>39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40>40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41>41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42>42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43>43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44>44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45>45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46>46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47>47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48>48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49>49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=50>50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=51>51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=52>52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=53>53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=54>54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=55>55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=56>56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=57>57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=58>58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=59>59
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>JWTUtil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#998;font-style:italic>// 过期时间5分钟
</span><span style=color:#998;font-style:italic></span>    <span style=color:#000;font-weight:700>private</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#000;font-weight:700>final</span> <span style=color:#458;font-weight:700>long</span> EXPIRE_TIME <span style=color:#000;font-weight:700>=</span> 5 <span style=color:#000;font-weight:700>*</span> 60 <span style=color:#000;font-weight:700>*</span> 1000<span style=color:#000;font-weight:700>;</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 校验token是否正确
</span><span style=color:#998;font-style:italic>    *
</span><span style=color:#998;font-style:italic>    * @param token 密钥
</span><span style=color:#998;font-style:italic>    * @param secret 用户的密码
</span><span style=color:#998;font-style:italic>    * @return 是否正确
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#458;font-weight:700>boolean</span> <span style=color:#900;font-weight:700>verify</span><span style=color:#000;font-weight:700>(</span>String token<span style=color:#000;font-weight:700>,</span> String username<span style=color:#000;font-weight:700>,</span> String secret<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
            Algorithm algorithm <span style=color:#000;font-weight:700>=</span> Algorithm<span style=color:#000;font-weight:700>.</span><span style=color:teal>HMAC256</span><span style=color:#000;font-weight:700>(</span>secret<span style=color:#000;font-weight:700>);</span>
            JWTVerifier verifier <span style=color:#000;font-weight:700>=</span> JWT<span style=color:#000;font-weight:700>.</span><span style=color:teal>require</span><span style=color:#000;font-weight:700>(</span>algorithm<span style=color:#000;font-weight:700>)</span>
                                      <span style=color:#000;font-weight:700>.</span><span style=color:teal>withClaim</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;username&#34;</span><span style=color:#000;font-weight:700>,</span> username<span style=color:#000;font-weight:700>).</span><span style=color:teal>build</span><span style=color:#000;font-weight:700>();</span>
            DecodedJWT jwt <span style=color:#000;font-weight:700>=</span> verifier<span style=color:#000;font-weight:700>.</span><span style=color:teal>verify</span><span style=color:#000;font-weight:700>(</span>token<span style=color:#000;font-weight:700>);</span>

            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span>Exception exception<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 获得token中的信息无需secret解密也能获得
</span><span style=color:#998;font-style:italic>    *
</span><span style=color:#998;font-style:italic>    * @return token中包含的用户名
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>static</span> String <span style=color:#900;font-weight:700>getUsername</span><span style=color:#000;font-weight:700>(</span>String token<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
            DecodedJWT jwt <span style=color:#000;font-weight:700>=</span> JWT<span style=color:#000;font-weight:700>.</span><span style=color:teal>decode</span><span style=color:#000;font-weight:700>(</span>token<span style=color:#000;font-weight:700>);</span>

            <span style=color:#000;font-weight:700>return</span> jwt<span style=color:#000;font-weight:700>.</span><span style=color:teal>getClaim</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;username&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:teal>asString</span><span style=color:#000;font-weight:700>();</span>
        <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span>JWTDecodeException e<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 生成签名,5min后过期
</span><span style=color:#998;font-style:italic>    *
</span><span style=color:#998;font-style:italic>    * @param username 用户名
</span><span style=color:#998;font-style:italic>    * @param secret 用户的密码
</span><span style=color:#998;font-style:italic>    * @return 加密的token
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>static</span> String <span style=color:#900;font-weight:700>sign</span><span style=color:#000;font-weight:700>(</span>String username<span style=color:#000;font-weight:700>,</span> String secret<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
            Date date <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> Date<span style=color:#000;font-weight:700>(</span>System<span style=color:#000;font-weight:700>.</span><span style=color:teal>currentTimeMillis</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>+</span> EXPIRE_TIME<span style=color:#000;font-weight:700>);</span>
            Algorithm algorithm <span style=color:#000;font-weight:700>=</span> Algorithm<span style=color:#000;font-weight:700>.</span><span style=color:teal>HMAC256</span><span style=color:#000;font-weight:700>(</span>secret<span style=color:#000;font-weight:700>);</span>

            <span style=color:#998;font-style:italic>// 附带username信息
</span><span style=color:#998;font-style:italic></span>            <span style=color:#000;font-weight:700>return</span> JWT<span style=color:#000;font-weight:700>.</span><span style=color:teal>create</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>withClaim</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;username&#34;</span><span style=color:#000;font-weight:700>,</span> username<span style=color:#000;font-weight:700>)</span>
                      <span style=color:#000;font-weight:700>.</span><span style=color:teal>withExpiresAt</span><span style=color:#000;font-weight:700>(</span>date<span style=color:#000;font-weight:700>).</span><span style=color:teal>sign</span><span style=color:#000;font-weight:700>(</span>algorithm<span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span>UnsupportedEncodingException e<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><h3 id=编写登录接口>编写登录接口</h3><p>为了让用户登录的时候获取到正确的JWT Token，需要实现登录接口，这里我编写一个LoginController.java：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>RestController
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>LoginController</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>private</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#000;font-weight:700>final</span> Logger _logger <span style=color:#000;font-weight:700>=</span> LoggerFactory<span style=color:#000;font-weight:700>.</span><span style=color:teal>getLogger</span><span style=color:#000;font-weight:700>(</span>LoginController<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#3c5d5d;font-weight:700>@Resource</span>
    <span style=color:#000;font-weight:700>private</span> ManagerInfoService managerInfoService<span style=color:#000;font-weight:700>;</span>

    <span style=color:#3c5d5d;font-weight:700>@PostMapping</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;/login&#34;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>public</span> BaseResponse <span style=color:#900;font-weight:700>login</span><span style=color:#000;font-weight:700>(</span><span style=color:#3c5d5d;font-weight:700>@RequestParam</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;username&#34;</span><span style=color:#000;font-weight:700>)</span>
    String username<span style=color:#000;font-weight:700>,</span> <span style=color:#3c5d5d;font-weight:700>@RequestParam</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;password&#34;</span><span style=color:#000;font-weight:700>)</span>
    String password<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        ManagerInfo user <span style=color:#000;font-weight:700>=</span> managerInfoService<span style=color:#000;font-weight:700>.</span><span style=color:teal>findByUsername</span><span style=color:#000;font-weight:700>(</span>username<span style=color:#000;font-weight:700>);</span>

        <span style=color:#998;font-style:italic>//盐（用户名+随机数）
</span><span style=color:#998;font-style:italic></span>        String salt <span style=color:#000;font-weight:700>=</span> user<span style=color:#000;font-weight:700>.</span><span style=color:teal>getSalt</span><span style=color:#000;font-weight:700>();</span>

        <span style=color:#998;font-style:italic>//原密码
</span><span style=color:#998;font-style:italic></span>        String encodedPassword <span style=color:#000;font-weight:700>=</span> ShiroKit<span style=color:#000;font-weight:700>.</span><span style=color:teal>md5</span><span style=color:#000;font-weight:700>(</span>password<span style=color:#000;font-weight:700>,</span> username <span style=color:#000;font-weight:700>+</span> salt<span style=color:#000;font-weight:700>);</span>

        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>user<span style=color:#000;font-weight:700>.</span><span style=color:teal>getPassword</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>equals</span><span style=color:#000;font-weight:700>(</span>encodedPassword<span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> BaseResponse<span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Login success&#34;</span><span style=color:#000;font-weight:700>,</span>
                JWTUtil<span style=color:#000;font-weight:700>.</span><span style=color:teal>sign</span><span style=color:#000;font-weight:700>(</span>username<span style=color:#000;font-weight:700>,</span> encodedPassword<span style=color:#000;font-weight:700>));</span>
        <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>throw</span> <span style=color:#000;font-weight:700>new</span> UnauthorizedException<span style=color:#000;font-weight:700>();</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#3c5d5d;font-weight:700>@RequestMapping</span><span style=color:#000;font-weight:700>(</span>path <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;/401&#34;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#3c5d5d;font-weight:700>@ResponseStatus</span><span style=color:#000;font-weight:700>(</span>HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>UNAUTHORIZED</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>public</span> BaseResponse <span style=color:#900;font-weight:700>unauthorized</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> BaseResponse<span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Unauthorized&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><p>注意上面登录的时候，我会从数据库中把这个用户取出来，密码加盐算MD5值比较，通过之后再用密码作为密钥来签名生成JWT。</p><h3 id=编写restful接口>编写RESTful接口</h3><p>先编写一个通用的接口返回类：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>* API接口的基础返回类
</span><span style=color:#998;font-style:italic>*
</span><span style=color:#998;font-style:italic>* @author XiongNeng
</span><span style=color:#998;font-style:italic>* @version 1.0
</span><span style=color:#998;font-style:italic>* @since 2018/1/7
</span><span style=color:#998;font-style:italic>*/</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>BaseResponse</span><span style=color:#000;font-weight:700>&lt;</span>T<span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 是否成功
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> <span style=color:#458;font-weight:700>boolean</span> success<span style=color:#000;font-weight:700>;</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 说明
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> String msg<span style=color:#000;font-weight:700>;</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>    * 返回数据
</span><span style=color:#998;font-style:italic>    */</span>
    <span style=color:#000;font-weight:700>private</span> T data<span style=color:#000;font-weight:700>;</span>

    <span style=color:#000;font-weight:700>public</span> <span style=color:#900;font-weight:700>BaseResponse</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#000;font-weight:700>public</span> <span style=color:#900;font-weight:700>BaseResponse</span><span style=color:#000;font-weight:700>(</span><span style=color:#458;font-weight:700>boolean</span> success<span style=color:#000;font-weight:700>,</span> String msg<span style=color:#000;font-weight:700>,</span> T data<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>success</span> <span style=color:#000;font-weight:700>=</span> success<span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>msg</span> <span style=color:#000;font-weight:700>=</span> msg<span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>data</span> <span style=color:#000;font-weight:700>=</span> data<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><p>通过SpringMVC实现RESTful接口，这里我只写一个示例方法：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33>33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34>34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35>35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36>36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37>37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38>38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39>39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40>40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41>41
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#3c5d5d;font-weight:700>@RestController</span>
<span style=color:#3c5d5d;font-weight:700>@RequestMapping</span><span style=color:#000;font-weight:700>(</span>value <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;/api/v1&#34;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>PublicController</span> <span style=color:#000;font-weight:700>{</span>

    <span style=color:#3c5d5d;font-weight:700>@Resource</span>
    <span style=color:#000;font-weight:700>private</span> ApiService apiService<span style=color:#000;font-weight:700>;</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 请求入网接口
</span><span style=color:#998;font-style:italic>     *
</span><span style=color:#998;font-style:italic>     * @return 处理结果
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@RequestMapping</span><span style=color:#000;font-weight:700>(</span>value <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;/join&#34;</span><span style=color:#000;font-weight:700>,</span> method <span style=color:#000;font-weight:700>=</span> RequestMethod<span style=color:#000;font-weight:700>.</span><span style=color:teal>POST</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#3c5d5d;font-weight:700>@RequiresRoles</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;admin&#34;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>public</span> ResponseEntity<span style=color:#000;font-weight:700>&lt;</span>BaseResponse<span style=color:#000;font-weight:700>&gt;</span> <span style=color:#900;font-weight:700>doJoin</span><span style=color:#000;font-weight:700>(</span><span style=color:#3c5d5d;font-weight:700>@RequestBody</span> PosParam posParam<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        _logger<span style=color:#000;font-weight:700>.</span><span style=color:teal>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;请求入网接口 start....&#34;</span><span style=color:#000;font-weight:700>);</span>
        BaseResponse result <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> BaseResponse<span style=color:#000;font-weight:700>();</span>
        <span style=color:#998;font-style:italic>// imei码约束检查
</span><span style=color:#998;font-style:italic></span>        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>StringUtils<span style=color:#000;font-weight:700>.</span><span style=color:teal>isEmpty</span><span style=color:#000;font-weight:700>(</span>posParam<span style=color:#000;font-weight:700>.</span><span style=color:teal>getImei</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>||</span> posParam<span style=color:#000;font-weight:700>.</span><span style=color:teal>getImei</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>length</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>&gt;</span> 32<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            result<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSuccess</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>);</span>
            result<span style=color:#000;font-weight:700>.</span><span style=color:teal>setMsg</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;IMEI码长度不是1-32位，入网失败。&#34;</span><span style=color:#000;font-weight:700>);</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> ResponseEntity<span style=color:#000;font-weight:700>&lt;&gt;(</span>result<span style=color:#000;font-weight:700>,</span> HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>OK</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span>
        Pos pos <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> Pos<span style=color:#000;font-weight:700>();</span>
        Date now <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> Date<span style=color:#000;font-weight:700>();</span>
        pos<span style=color:#000;font-weight:700>.</span><span style=color:teal>setJointime</span><span style=color:#000;font-weight:700>(</span>now<span style=color:#000;font-weight:700>);</span>
        pos<span style=color:#000;font-weight:700>.</span><span style=color:teal>setBindtime</span><span style=color:#000;font-weight:700>(</span>now<span style=color:#000;font-weight:700>);</span>
        BeanUtils<span style=color:#000;font-weight:700>.</span><span style=color:teal>copyProperties</span><span style=color:#000;font-weight:700>(</span>posParam<span style=color:#000;font-weight:700>,</span> pos<span style=color:#000;font-weight:700>);</span>
        <span style=color:#998;font-style:italic>// 插入一条新纪录
</span><span style=color:#998;font-style:italic></span>        pos<span style=color:#000;font-weight:700>.</span><span style=color:teal>setProjectId</span><span style=color:#000;font-weight:700>(</span>project<span style=color:#000;font-weight:700>.</span><span style=color:teal>getId</span><span style=color:#000;font-weight:700>());</span>
        <span style=color:#458;font-weight:700>int</span> insert <span style=color:#000;font-weight:700>=</span> apiService<span style=color:#000;font-weight:700>.</span><span style=color:teal>insertPos</span><span style=color:#000;font-weight:700>(</span>pos<span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>insert <span style=color:#000;font-weight:700>&gt;</span> 0<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            result<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSuccess</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>true</span><span style=color:#000;font-weight:700>);</span>
            result<span style=color:#000;font-weight:700>.</span><span style=color:teal>setMsg</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;入网成功&#34;</span><span style=color:#000;font-weight:700>);</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> ResponseEntity<span style=color:#000;font-weight:700>&lt;&gt;(</span>result<span style=color:#000;font-weight:700>,</span> HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>CREATED</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
            result<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSuccess</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>);</span>
            result<span style=color:#000;font-weight:700>.</span><span style=color:teal>setMsg</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;入网失败，请联系管理员。&#34;</span><span style=color:#000;font-weight:700>);</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> ResponseEntity<span style=color:#000;font-weight:700>&lt;&gt;(</span>result<span style=color:#000;font-weight:700>,</span> HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>OK</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><h3 id=自定义异常>自定义异常</h3><p>为了实现我自己能够手动抛出异常，我自己写了一个<code>UnauthorizedException.java</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2>2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3>3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4>4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5>5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6>6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7>7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8>8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9>9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>UnauthorizedException</span> <span style=color:#000;font-weight:700>extends</span> RuntimeException <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>public</span> <span style=color:#900;font-weight:700>UnauthorizedException</span><span style=color:#000;font-weight:700>(</span>String msg<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>super</span><span style=color:#000;font-weight:700>(</span>msg<span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#000;font-weight:700>public</span> <span style=color:#900;font-weight:700>UnauthorizedException</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>super</span><span style=color:#000;font-weight:700>();</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><h3 id=处理框架异常>处理框架异常</h3><p>之前说过restful要统一返回的格式，所以我们也要全局处理Spring Boot的抛出异常。利用@RestControllerAdvice能很好的实现。 注意这个统一异常处理器只对认证过的用户调用接口中的异常有作用，对AuthenticationException没有用</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#3c5d5d;font-weight:700>@RestControllerAdvice</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>ExceptionController</span> <span style=color:#000;font-weight:700>{</span>

    <span style=color:#998;font-style:italic>// 捕捉shiro的异常
</span><span style=color:#998;font-style:italic></span>    <span style=color:#3c5d5d;font-weight:700>@ResponseStatus</span><span style=color:#000;font-weight:700>(</span>HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>UNAUTHORIZED</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#3c5d5d;font-weight:700>@ExceptionHandler</span><span style=color:#000;font-weight:700>(</span>ShiroException<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>public</span> BaseResponse <span style=color:#900;font-weight:700>handle401</span><span style=color:#000;font-weight:700>(</span>ShiroException e<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> BaseResponse<span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;shiro的异常&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>
    
    <span style=color:#998;font-style:italic>// 捕捉UnauthorizedException
</span><span style=color:#998;font-style:italic></span>    <span style=color:#3c5d5d;font-weight:700>@ResponseStatus</span><span style=color:#000;font-weight:700>(</span>HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>UNAUTHORIZED</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#3c5d5d;font-weight:700>@ExceptionHandler</span><span style=color:#000;font-weight:700>(</span>UnauthorizedException<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>public</span> BaseResponse <span style=color:#900;font-weight:700>handle401</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> BaseResponse<span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;UnauthorizedException&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>// 捕捉其他所有异常
</span><span style=color:#998;font-style:italic></span>    <span style=color:#3c5d5d;font-weight:700>@ExceptionHandler</span><span style=color:#000;font-weight:700>(</span>Exception<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#3c5d5d;font-weight:700>@ResponseStatus</span><span style=color:#000;font-weight:700>(</span>HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>BAD_REQUEST</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>public</span> BaseResponse <span style=color:#900;font-weight:700>globalException</span><span style=color:#000;font-weight:700>(</span>HttpServletRequest request<span style=color:#000;font-weight:700>,</span> Throwable ex<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> BaseResponse<span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;其他异常&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#000;font-weight:700>private</span> HttpStatus <span style=color:#900;font-weight:700>getStatus</span><span style=color:#000;font-weight:700>(</span>HttpServletRequest request<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        Integer statusCode <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>Integer<span style=color:#000;font-weight:700>)</span> request<span style=color:#000;font-weight:700>.</span><span style=color:teal>getAttribute</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;javax.servlet.error.status_code&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>statusCode <span style=color:#000;font-weight:700>==</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>return</span> HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>INTERNAL_SERVER_ERROR</span><span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>return</span> HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>valueOf</span><span style=color:#000;font-weight:700>(</span>statusCode<span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><h3 id=配置shiro>配置Shiro</h3><p>大家可以先看下官方的<a href=http://shiro.apache.org/spring.html>Spring-Shiro</a>整合教程，有个初步的了解。 不过既然我们用了SpringBoot，那我们肯定要争取零配置文件。</p><p><strong>实现JWTToken</strong></p><p>JWTToken差不多就是Shiro用户名密码的载体。因为我们是前后端分离，服务器无需保存用户状态，所以不需要RememberMe这类功能， 我们简单的实现下AuthenticationToken接口即可。因为token自己已经包含了用户名等信息，所以这里我就弄了一个字段。 如果你喜欢钻研，可以看看官方的UsernamePasswordToken是如何实现的。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>JWTToken</span> <span style=color:#000;font-weight:700>implements</span> AuthenticationToken <span style=color:#000;font-weight:700>{</span>

    <span style=color:#998;font-style:italic>// 密钥
</span><span style=color:#998;font-style:italic></span>    <span style=color:#000;font-weight:700>private</span> String token<span style=color:#000;font-weight:700>;</span>

    <span style=color:#000;font-weight:700>public</span> <span style=color:#900;font-weight:700>JWTToken</span><span style=color:#000;font-weight:700>(</span>String token<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>token</span> <span style=color:#000;font-weight:700>=</span> token<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>public</span> Object <span style=color:#900;font-weight:700>getPrincipal</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> token<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>public</span> Object <span style=color:#900;font-weight:700>getCredentials</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> token<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><p><strong>实现Realm</strong></p><p>realm的用于处理用户是否合法的这一块，需要我们自己实现。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1>  1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2>  2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3>  3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4>  4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5>  5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6>  6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7>  7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8>  8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9>  9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10> 10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11> 11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12> 12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13> 13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14> 14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15> 15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16> 16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17> 17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18> 18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19> 19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20> 20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21> 21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22> 22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23> 23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24> 24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25> 25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26> 26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27> 27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28> 28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29> 29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30> 30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31> 31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32> 32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33> 33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34> 34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35> 35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36> 36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37> 37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38> 38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39> 39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40> 40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41> 41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42> 42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43> 43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44> 44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45> 45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46> 46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47> 47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48> 48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49> 49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=50> 50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=51> 51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=52> 52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=53> 53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=54> 54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=55> 55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=56> 56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=57> 57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=58> 58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=59> 59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=60> 60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=61> 61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=62> 62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=63> 63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=64> 64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=65> 65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=66> 66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=67> 67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=68> 68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=69> 69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=70> 70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=71> 71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=72> 72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=73> 73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=74> 74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=75> 75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=76> 76
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=77> 77
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=78> 78
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=79> 79
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=80> 80
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=81> 81
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=82> 82
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=83> 83
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=84> 84
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=85> 85
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=86> 86
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=87> 87
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=88> 88
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=89> 89
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=90> 90
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=91> 91
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=92> 92
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=93> 93
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=94> 94
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=95> 95
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=96> 96
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=97> 97
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=98> 98
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=99> 99
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=100>100
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=101>101
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=102>102
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic> * Description  : 身份校验核心类
</span><span style=color:#998;font-style:italic> */</span>

<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>MyShiroRealm</span> <span style=color:#000;font-weight:700>extends</span> AuthorizingRealm <span style=color:#000;font-weight:700>{</span>

    <span style=color:#000;font-weight:700>private</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#000;font-weight:700>final</span> Logger _logger <span style=color:#000;font-weight:700>=</span> LoggerFactory<span style=color:#000;font-weight:700>.</span><span style=color:teal>getLogger</span><span style=color:#000;font-weight:700>(</span>MyShiroRealm<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#3c5d5d;font-weight:700>@Autowired</span>
    ManagerInfoService managerInfoService<span style=color:#000;font-weight:700>;</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * JWT签名密钥，这里没用。我使用的是用户的MD5密码作为签名密钥
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#000;font-weight:700>final</span> String SECRET <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;9281e268b77b7c439a20b46fd1483b9a&#34;</span><span style=color:#000;font-weight:700>;</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 必须重写此方法，不然Shiro会报错
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>boolean</span> <span style=color:#900;font-weight:700>supports</span><span style=color:#000;font-weight:700>(</span>AuthenticationToken token<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> token <span style=color:#000;font-weight:700>instanceof</span> JWTToken<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 认证信息(身份验证)
</span><span style=color:#998;font-style:italic>     * Authentication 是用来验证用户身份
</span><span style=color:#998;font-style:italic>     *
</span><span style=color:#998;font-style:italic>     * @param auth
</span><span style=color:#998;font-style:italic>     * @return
</span><span style=color:#998;font-style:italic>     * @throws AuthenticationException
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>protected</span> AuthenticationInfo <span style=color:#900;font-weight:700>doGetAuthenticationInfo</span><span style=color:#000;font-weight:700>(</span>AuthenticationToken auth<span style=color:#000;font-weight:700>)</span>
            <span style=color:#000;font-weight:700>throws</span> AuthenticationException <span style=color:#000;font-weight:700>{</span>
        _logger<span style=color:#000;font-weight:700>.</span><span style=color:teal>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;MyShiroRealm.doGetAuthenticationInfo()&#34;</span><span style=color:#000;font-weight:700>);</span>

        String token <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>String<span style=color:#000;font-weight:700>)</span> auth<span style=color:#000;font-weight:700>.</span><span style=color:teal>getCredentials</span><span style=color:#000;font-weight:700>();</span>
        <span style=color:#998;font-style:italic>// 解密获得username，用于和数据库进行对比
</span><span style=color:#998;font-style:italic></span>        String username <span style=color:#000;font-weight:700>=</span> JWTUtil<span style=color:#000;font-weight:700>.</span><span style=color:teal>getUsername</span><span style=color:#000;font-weight:700>(</span>token<span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>username <span style=color:#000;font-weight:700>==</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>throw</span> <span style=color:#000;font-weight:700>new</span> AuthenticationException<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;token invalid&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#998;font-style:italic>//通过username从数据库中查找 ManagerInfo对象
</span><span style=color:#998;font-style:italic></span>        <span style=color:#998;font-style:italic>//实际项目中，这里可以根据实际情况做缓存，如果不做，Shiro自己也是有时间间隔机制，2分钟内不会重复执行该方法
</span><span style=color:#998;font-style:italic></span>        ManagerInfo managerInfo <span style=color:#000;font-weight:700>=</span> managerInfoService<span style=color:#000;font-weight:700>.</span><span style=color:teal>findByUsername</span><span style=color:#000;font-weight:700>(</span>username<span style=color:#000;font-weight:700>);</span>

        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>managerInfo <span style=color:#000;font-weight:700>==</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>throw</span> <span style=color:#000;font-weight:700>new</span> AuthenticationException<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;User didn&#39;t existed!&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(!</span>JWTUtil<span style=color:#000;font-weight:700>.</span><span style=color:teal>verify</span><span style=color:#000;font-weight:700>(</span>token<span style=color:#000;font-weight:700>,</span> username<span style=color:#000;font-weight:700>,</span> managerInfo<span style=color:#000;font-weight:700>.</span><span style=color:teal>getPassword</span><span style=color:#000;font-weight:700>()))</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>throw</span> <span style=color:#000;font-weight:700>new</span> AuthenticationException<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Username or password error&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span>

        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> SimpleAuthenticationInfo<span style=color:#000;font-weight:700>(</span>token<span style=color:#000;font-weight:700>,</span> token<span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;my_realm&#34;</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 此方法调用hasRole,hasPermission的时候才会进行回调.
</span><span style=color:#998;font-style:italic>     * &lt;p&gt;
</span><span style=color:#998;font-style:italic>     * 权限信息.(授权):
</span><span style=color:#998;font-style:italic>     * 1、如果用户正常退出，缓存自动清空；
</span><span style=color:#998;font-style:italic>     * 2、如果用户非正常退出，缓存自动清空；
</span><span style=color:#998;font-style:italic>     * 3、如果我们修改了用户的权限，而用户不退出系统，修改的权限无法立即生效。
</span><span style=color:#998;font-style:italic>     * （需要手动编程进行实现；放在service进行调用）
</span><span style=color:#998;font-style:italic>     * 在权限修改后调用realm中的方法，realm已经由spring管理，所以从spring中获取realm实例，调用clearCached方法；
</span><span style=color:#998;font-style:italic>     * :Authorization 是授权访问控制，用于对用户进行的操作授权，证明该用户是否允许进行当前操作，如访问某个链接，某个资源文件等。
</span><span style=color:#998;font-style:italic>     *
</span><span style=color:#998;font-style:italic>     * @param principals
</span><span style=color:#998;font-style:italic>     * @return
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>protected</span> AuthorizationInfo <span style=color:#900;font-weight:700>doGetAuthorizationInfo</span><span style=color:#000;font-weight:700>(</span>PrincipalCollection principals<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#998;font-style:italic>/*
</span><span style=color:#998;font-style:italic>         * 当没有使用缓存的时候，不断刷新页面的话，这个代码会不断执行，
</span><span style=color:#998;font-style:italic>         * 当其实没有必要每次都重新设置权限信息，所以我们需要放到缓存中进行管理；
</span><span style=color:#998;font-style:italic>         * 当放到缓存中时，这样的话，doGetAuthorizationInfo就只会执行一次了，
</span><span style=color:#998;font-style:italic>         * 缓存过期之后会再次执行。
</span><span style=color:#998;font-style:italic>         */</span>
        _logger<span style=color:#000;font-weight:700>.</span><span style=color:teal>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;权限配置--&gt;MyShiroRealm.doGetAuthorizationInfo()&#34;</span><span style=color:#000;font-weight:700>);</span>
        String username <span style=color:#000;font-weight:700>=</span> JWTUtil<span style=color:#000;font-weight:700>.</span><span style=color:teal>getUsername</span><span style=color:#000;font-weight:700>(</span>principals<span style=color:#000;font-weight:700>.</span><span style=color:teal>toString</span><span style=color:#000;font-weight:700>());</span>

        <span style=color:#998;font-style:italic>// 下面的可以使用缓存提升速度
</span><span style=color:#998;font-style:italic></span>        ManagerInfo managerInfo <span style=color:#000;font-weight:700>=</span> managerInfoService<span style=color:#000;font-weight:700>.</span><span style=color:teal>findByUsername</span><span style=color:#000;font-weight:700>(</span>username<span style=color:#000;font-weight:700>);</span>

        SimpleAuthorizationInfo authorizationInfo <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> SimpleAuthorizationInfo<span style=color:#000;font-weight:700>();</span>

        <span style=color:#998;font-style:italic>//设置相应角色的权限信息
</span><span style=color:#998;font-style:italic></span>        <span style=color:#000;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span>SysRole role <span style=color:#000;font-weight:700>:</span> managerInfo<span style=color:#000;font-weight:700>.</span><span style=color:teal>getRoles</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#998;font-style:italic>//设置角色
</span><span style=color:#998;font-style:italic></span>            authorizationInfo<span style=color:#000;font-weight:700>.</span><span style=color:teal>addRole</span><span style=color:#000;font-weight:700>(</span>role<span style=color:#000;font-weight:700>.</span><span style=color:teal>getRole</span><span style=color:#000;font-weight:700>());</span>
            <span style=color:#000;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span>Permission p <span style=color:#000;font-weight:700>:</span> role<span style=color:#000;font-weight:700>.</span><span style=color:teal>getPermissions</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
                <span style=color:#998;font-style:italic>//设置权限
</span><span style=color:#998;font-style:italic></span>                authorizationInfo<span style=color:#000;font-weight:700>.</span><span style=color:teal>addStringPermission</span><span style=color:#000;font-weight:700>(</span>p<span style=color:#000;font-weight:700>.</span><span style=color:teal>getPermission</span><span style=color:#000;font-weight:700>());</span>
            <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>return</span> authorizationInfo<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><p>在<code>doGetAuthenticationInfo</code>中用户可以自定义抛出很多异常，详情见文档。</p><p><strong>重写Filter</strong></p><p>所有的请求都会先经过Filter，所以我们继承官方的BasicHttpAuthenticationFilter，并且重写鉴权的方法， 另外通过重写preHandle，实现跨越访问。</p><p>代码的执行流程<code>preHandle</code>-><code>isAccessAllowed</code>-><code>isLoginAttempt</code>-><code>executeLogin</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33>33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34>34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35>35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36>36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37>37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38>38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39>39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40>40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41>41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42>42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43>43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44>44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45>45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46>46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47>47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48>48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49>49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=50>50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=51>51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=52>52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=53>53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=54>54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=55>55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=56>56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=57>57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=58>58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=59>59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=60>60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=61>61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=62>62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=63>63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=64>64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=65>65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=66>66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=67>67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=68>68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=69>69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=70>70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=71>71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=72>72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=73>73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=74>74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=75>75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=76>76
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=77>77
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=78>78
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=79>79
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=80>80
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>JWTFilter</span> <span style=color:#000;font-weight:700>extends</span> BasicHttpAuthenticationFilter <span style=color:#000;font-weight:700>{</span>

    <span style=color:#000;font-weight:700>private</span> Logger LOGGER <span style=color:#000;font-weight:700>=</span> LoggerFactory<span style=color:#000;font-weight:700>.</span><span style=color:teal>getLogger</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>getClass</span><span style=color:#000;font-weight:700>());</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 判断用户是否想要登入。
</span><span style=color:#998;font-style:italic>     * 检测header里面是否包含Authorization字段即可
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>protected</span> <span style=color:#458;font-weight:700>boolean</span> <span style=color:#900;font-weight:700>isLoginAttempt</span><span style=color:#000;font-weight:700>(</span>ServletRequest request<span style=color:#000;font-weight:700>,</span> ServletResponse response<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        HttpServletRequest req <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>HttpServletRequest<span style=color:#000;font-weight:700>)</span> request<span style=color:#000;font-weight:700>;</span>
        String authorization <span style=color:#000;font-weight:700>=</span> req<span style=color:#000;font-weight:700>.</span><span style=color:teal>getHeader</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Authorization&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>return</span> authorization <span style=color:#000;font-weight:700>!=</span> <span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     *
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>protected</span> <span style=color:#458;font-weight:700>boolean</span> <span style=color:#900;font-weight:700>executeLogin</span><span style=color:#000;font-weight:700>(</span>ServletRequest request<span style=color:#000;font-weight:700>,</span> ServletResponse response<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>throws</span> Exception <span style=color:#000;font-weight:700>{</span>
        HttpServletRequest httpServletRequest <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>HttpServletRequest<span style=color:#000;font-weight:700>)</span> request<span style=color:#000;font-weight:700>;</span>
        String authorization <span style=color:#000;font-weight:700>=</span> httpServletRequest<span style=color:#000;font-weight:700>.</span><span style=color:teal>getHeader</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Authorization&#34;</span><span style=color:#000;font-weight:700>);</span>
        JWTToken token <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> JWTToken<span style=color:#000;font-weight:700>(</span>authorization<span style=color:#000;font-weight:700>);</span>
        <span style=color:#998;font-style:italic>// 提交给realm进行登入，如果错误他会抛出异常并被捕获
</span><span style=color:#998;font-style:italic></span>        getSubject<span style=color:#000;font-weight:700>(</span>request<span style=color:#000;font-weight:700>,</span> response<span style=color:#000;font-weight:700>).</span><span style=color:teal>login</span><span style=color:#000;font-weight:700>(</span>token<span style=color:#000;font-weight:700>);</span>
        <span style=color:#998;font-style:italic>// 如果没有抛出异常则代表登入成功，返回true
</span><span style=color:#998;font-style:italic></span>        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 这里我们详细说明下为什么最终返回的都是true，即允许访问
</span><span style=color:#998;font-style:italic>     * 例如我们提供一个地址 GET /article
</span><span style=color:#998;font-style:italic>     * 登入用户和游客看到的内容是不同的
</span><span style=color:#998;font-style:italic>     * 如果在这里返回了false，请求会被直接拦截，用户看不到任何东西
</span><span style=color:#998;font-style:italic>     * 所以我们在这里返回true，Controller中可以通过 subject.isAuthenticated() 来判断用户是否登入
</span><span style=color:#998;font-style:italic>     * 如果有些资源只有登入用户才能访问，我们只需要在方法上面加上 @RequiresAuthentication 注解即可
</span><span style=color:#998;font-style:italic>     * 但是这样做有一个缺点，就是不能够对GET,POST等请求进行分别过滤鉴权(因为我们重写了官方的方法)，但实际上对应用影响不大
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>protected</span> <span style=color:#458;font-weight:700>boolean</span> <span style=color:#900;font-weight:700>isAccessAllowed</span><span style=color:#000;font-weight:700>(</span>ServletRequest request<span style=color:#000;font-weight:700>,</span> ServletResponse response<span style=color:#000;font-weight:700>,</span> Object mappedValue<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>isLoginAttempt<span style=color:#000;font-weight:700>(</span>request<span style=color:#000;font-weight:700>,</span> response<span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
                executeLogin<span style=color:#000;font-weight:700>(</span>request<span style=color:#000;font-weight:700>,</span> response<span style=color:#000;font-weight:700>);</span>
            <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span>Exception e<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
                response401<span style=color:#000;font-weight:700>(</span>request<span style=color:#000;font-weight:700>,</span> response<span style=color:#000;font-weight:700>);</span>
            <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 对跨域提供支持
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Override</span>
    <span style=color:#000;font-weight:700>protected</span> <span style=color:#458;font-weight:700>boolean</span> <span style=color:#900;font-weight:700>preHandle</span><span style=color:#000;font-weight:700>(</span>ServletRequest request<span style=color:#000;font-weight:700>,</span> ServletResponse response<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>throws</span> Exception <span style=color:#000;font-weight:700>{</span>
        HttpServletRequest httpServletRequest <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>HttpServletRequest<span style=color:#000;font-weight:700>)</span> request<span style=color:#000;font-weight:700>;</span>
        HttpServletResponse httpServletResponse <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>HttpServletResponse<span style=color:#000;font-weight:700>)</span> response<span style=color:#000;font-weight:700>;</span>
        httpServletResponse<span style=color:#000;font-weight:700>.</span><span style=color:teal>setHeader</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Access-control-Allow-Origin&#34;</span><span style=color:#000;font-weight:700>,</span> httpServletRequest<span style=color:#000;font-weight:700>.</span><span style=color:teal>getHeader</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Origin&#34;</span><span style=color:#000;font-weight:700>));</span>
        httpServletResponse<span style=color:#000;font-weight:700>.</span><span style=color:teal>setHeader</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Access-Control-Allow-Methods&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;GET,POST,OPTIONS,PUT,DELETE&#34;</span><span style=color:#000;font-weight:700>);</span>
        httpServletResponse<span style=color:#000;font-weight:700>.</span><span style=color:teal>setHeader</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Access-Control-Allow-Headers&#34;</span><span style=color:#000;font-weight:700>,</span> httpServletRequest<span style=color:#000;font-weight:700>.</span><span style=color:teal>getHeader</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Access-Control-Request-Headers&#34;</span><span style=color:#000;font-weight:700>));</span>
        <span style=color:#998;font-style:italic>// 跨域时会首先发送一个option请求，这里我们给option请求直接返回正常状态
</span><span style=color:#998;font-style:italic></span>        <span style=color:#000;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span>httpServletRequest<span style=color:#000;font-weight:700>.</span><span style=color:teal>getMethod</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>equals</span><span style=color:#000;font-weight:700>(</span>RequestMethod<span style=color:#000;font-weight:700>.</span><span style=color:teal>OPTIONS</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>name</span><span style=color:#000;font-weight:700>()))</span> <span style=color:#000;font-weight:700>{</span>
            httpServletResponse<span style=color:#000;font-weight:700>.</span><span style=color:teal>setStatus</span><span style=color:#000;font-weight:700>(</span>HttpStatus<span style=color:#000;font-weight:700>.</span><span style=color:teal>OK</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>value</span><span style=color:#000;font-weight:700>());</span>
            <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span>
        <span style=color:#000;font-weight:700>}</span>
        <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>super</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>preHandle</span><span style=color:#000;font-weight:700>(</span>request<span style=color:#000;font-weight:700>,</span> response<span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 将非法请求跳转到 /401
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#000;font-weight:700>private</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>response401</span><span style=color:#000;font-weight:700>(</span>ServletRequest req<span style=color:#000;font-weight:700>,</span> ServletResponse resp<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
            HttpServletResponse httpServletResponse <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>HttpServletResponse<span style=color:#000;font-weight:700>)</span> resp<span style=color:#000;font-weight:700>;</span>
            httpServletResponse<span style=color:#000;font-weight:700>.</span><span style=color:teal>sendRedirect</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;/401&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span>IOException e<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            LOGGER<span style=color:#000;font-weight:700>.</span><span style=color:teal>error</span><span style=color:#000;font-weight:700>(</span>e<span style=color:#000;font-weight:700>.</span><span style=color:teal>getMessage</span><span style=color:#000;font-weight:700>());</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><p><strong>编写ShiroConfig配置类</strong></p><p>这里我还增加了EhCache缓存管理支持，不需要每次都调用数据库做授权。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=1> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=2> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=3> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=4> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=5> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=6> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=7> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=8> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=9> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=10>10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=11>11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=12>12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=13>13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=14>14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=15>15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=16>16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=17>17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=18>18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=19>19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=20>20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=21>21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=22>22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=23>23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=24>24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=25>25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=26>26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=27>27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=28>28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=29>29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=30>30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=31>31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=32>32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=33>33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=34>34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=35>35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=36>36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=37>37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=38>38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=39>39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=40>40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=41>41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=42>42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=43>43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=44>44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=45>45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=46>46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=47>47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=48>48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=49>49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=50>50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=51>51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=52>52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=53>53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=54>54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=55>55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=56>56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=57>57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=58>58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=59>59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=60>60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=61>61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=62>62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=63>63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=64>64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=65>65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=66>66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=67>67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=68>68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=69>69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=70>70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=71>71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=72>72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=73>73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=74>74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=75>75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=76>76
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=77>77
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=78>78
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=79>79
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=80>80
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=81>81
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=82>82
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=83>83
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=84>84
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=85>85
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=86>86
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=87>87
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=88>88
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=89>89
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=90>90
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=91>91
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#3c5d5d;font-weight:700>@Configuration</span>
<span style=color:#3c5d5d;font-weight:700>@Order</span><span style=color:#000;font-weight:700>(</span>1<span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>ShiroConfig</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * ShiroFilterFactoryBean 处理拦截资源文件问题。
</span><span style=color:#998;font-style:italic>     * 注意：单独一个ShiroFilterFactoryBean配置是或报错的，以为在
</span><span style=color:#998;font-style:italic>     * 初始化ShiroFilterFactoryBean的时候需要注入：SecurityManager Filter Chain定义说明
</span><span style=color:#998;font-style:italic>     * 1、一个URL可以配置多个Filter，使用逗号分隔
</span><span style=color:#998;font-style:italic>     * 2、当设置多个过滤器时，全部验证通过，才视为通过
</span><span style=color:#998;font-style:italic>     * 3、部分过滤器可指定参数，如perms，roles
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Bean</span>
    <span style=color:#000;font-weight:700>public</span> ShiroFilterFactoryBean <span style=color:#900;font-weight:700>shirFilter</span><span style=color:#000;font-weight:700>(</span>SecurityManager securityManager<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>

        ShiroFilterFactoryBean shiroFilterFactoryBean <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> ShiroFilterFactoryBean<span style=color:#000;font-weight:700>();</span>
        <span style=color:#998;font-style:italic>// 必须设置 SecurityManager
</span><span style=color:#998;font-style:italic></span>        shiroFilterFactoryBean<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSecurityManager</span><span style=color:#000;font-weight:700>(</span>securityManager<span style=color:#000;font-weight:700>);</span>
        <span style=color:#998;font-style:italic>//验证码过滤器
</span><span style=color:#998;font-style:italic></span>        Map<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>,</span> Filter<span style=color:#000;font-weight:700>&gt;</span> filtersMap <span style=color:#000;font-weight:700>=</span> shiroFilterFactoryBean<span style=color:#000;font-weight:700>.</span><span style=color:teal>getFilters</span><span style=color:#000;font-weight:700>();</span>
        filtersMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;jwt&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>new</span> JWTFilter<span style=color:#000;font-weight:700>());</span>
        shiroFilterFactoryBean<span style=color:#000;font-weight:700>.</span><span style=color:teal>setFilters</span><span style=color:#000;font-weight:700>(</span>filtersMap<span style=color:#000;font-weight:700>);</span>

        <span style=color:#998;font-style:italic>// 拦截器
</span><span style=color:#998;font-style:italic></span>        Map<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>,</span> String<span style=color:#000;font-weight:700>&gt;</span> filterChainDefinitionMap <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> LinkedHashMap<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>,</span> String<span style=color:#000;font-weight:700>&gt;();</span>

        <span style=color:#998;font-style:italic>// 其他的
</span><span style=color:#998;font-style:italic></span>        filterChainDefinitionMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;/**&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;jwt&#34;</span><span style=color:#000;font-weight:700>);</span>

        <span style=color:#998;font-style:italic>// 访问401和404页面不通过我们的Filter
</span><span style=color:#998;font-style:italic></span>        filterChainDefinitionMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;/401&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;anon&#34;</span><span style=color:#000;font-weight:700>);</span>
        filterChainDefinitionMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;/404&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;anon&#34;</span><span style=color:#000;font-weight:700>);</span>

        shiroFilterFactoryBean<span style=color:#000;font-weight:700>.</span><span style=color:teal>setFilterChainDefinitionMap</span><span style=color:#000;font-weight:700>(</span>filterChainDefinitionMap<span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>return</span> shiroFilterFactoryBean<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#3c5d5d;font-weight:700>@Bean</span>
    <span style=color:#000;font-weight:700>public</span> SecurityManager <span style=color:#900;font-weight:700>securityManager</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        DefaultWebSecurityManager securityManager <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> DefaultWebSecurityManager<span style=color:#000;font-weight:700>();</span>
        <span style=color:#998;font-style:italic>// 设置realm.
</span><span style=color:#998;font-style:italic></span>        securityManager<span style=color:#000;font-weight:700>.</span><span style=color:teal>setRealm</span><span style=color:#000;font-weight:700>(</span>myShiroRealm<span style=color:#000;font-weight:700>());</span>
        <span style=color:#998;font-style:italic>//注入缓存管理器
</span><span style=color:#998;font-style:italic></span>        securityManager<span style=color:#000;font-weight:700>.</span><span style=color:teal>setCacheManager</span><span style=color:#000;font-weight:700>(</span>ehCacheManager<span style=color:#000;font-weight:700>());</span>
        <span style=color:#998;font-style:italic>// 关闭shiro自带的session
</span><span style=color:#998;font-style:italic></span>        DefaultSubjectDAO subjectDAO <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> DefaultSubjectDAO<span style=color:#000;font-weight:700>();</span>
        DefaultSessionStorageEvaluator defaultSessionStorageEvaluator <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> DefaultSessionStorageEvaluator<span style=color:#000;font-weight:700>();</span>
        defaultSessionStorageEvaluator<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSessionStorageEnabled</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>false</span><span style=color:#000;font-weight:700>);</span>
        subjectDAO<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSessionStorageEvaluator</span><span style=color:#000;font-weight:700>(</span>defaultSessionStorageEvaluator<span style=color:#000;font-weight:700>);</span>
        securityManager<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSubjectDAO</span><span style=color:#000;font-weight:700>(</span>subjectDAO<span style=color:#000;font-weight:700>);</span>

        <span style=color:#000;font-weight:700>return</span> securityManager<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 身份认证realm; (这个需要自己写，账号密码校验；权限等)
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Bean</span>
    <span style=color:#000;font-weight:700>public</span> MyShiroRealm <span style=color:#900;font-weight:700>myShiroRealm</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        MyShiroRealm myShiroRealm <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> MyShiroRealm<span style=color:#000;font-weight:700>();</span>
        <span style=color:#000;font-weight:700>return</span> myShiroRealm<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * 开启shiro aop注解支持. 使用代理方式; 所以需要开启代码支持;
</span><span style=color:#998;font-style:italic>     *
</span><span style=color:#998;font-style:italic>     * @param securityManager 安全管理器
</span><span style=color:#998;font-style:italic>     * @return 授权Advisor
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Bean</span>
    <span style=color:#000;font-weight:700>public</span> AuthorizationAttributeSourceAdvisor <span style=color:#900;font-weight:700>authorizationAttributeSourceAdvisor</span><span style=color:#000;font-weight:700>(</span>SecurityManager securityManager<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> AuthorizationAttributeSourceAdvisor<span style=color:#000;font-weight:700>();</span>
        authorizationAttributeSourceAdvisor<span style=color:#000;font-weight:700>.</span><span style=color:teal>setSecurityManager</span><span style=color:#000;font-weight:700>(</span>securityManager<span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>return</span> authorizationAttributeSourceAdvisor<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#998;font-style:italic>/**
</span><span style=color:#998;font-style:italic>     * shiro缓存管理器;
</span><span style=color:#998;font-style:italic>     * 需要注入对应的其它的实体类中：
</span><span style=color:#998;font-style:italic>     * 1、安全管理器：securityManager
</span><span style=color:#998;font-style:italic>     * 可见securityManager是整个shiro的核心；
</span><span style=color:#998;font-style:italic>     *
</span><span style=color:#998;font-style:italic>     * @return
</span><span style=color:#998;font-style:italic>     */</span>
    <span style=color:#3c5d5d;font-weight:700>@Bean</span>
    <span style=color:#000;font-weight:700>public</span> EhCacheManager <span style=color:#900;font-weight:700>ehCacheManager</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
        EhCacheManager cacheManager <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> EhCacheManager<span style=color:#000;font-weight:700>();</span>
        cacheManager<span style=color:#000;font-weight:700>.</span><span style=color:teal>setCacheManagerConfigFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;classpath:ehcache.xml&#34;</span><span style=color:#000;font-weight:700>);</span>
        <span style=color:#000;font-weight:700>return</span> cacheManager<span style=color:#000;font-weight:700>;</span>
    <span style=color:#000;font-weight:700>}</span>

<span style=color:#000;font-weight:700>}</span>
</code></pre></td></tr></table></div></div><p>里面URL规则自己参考文档<a href=http://shiro.apache.org/web.html>http://shiro.apache.org/web.html</a> ，这个在shiro那篇说的很清楚了。</p><h2 id=运行验证>运行验证</h2><p>最后是将代码跑起来验证这一切是否正常。</p><p>启动SpringBoot后，先通过POST请求登录拿到token</p><p><img src=http://image.tianhui.xin/liveLearn/5/jwt21.png alt=登录拿到token></p><p>然后在调用入网接口的时候在header中带上这个token认证：</p><p><img src=http://image.tianhui.xin/liveLearn/5/jwt22.png alt=token认证></p><p>如果token认证不正确会报异常：</p><p><img src=http://image.tianhui.xin/liveLearn/5/jwt23.png alt=token异常></p><p>如果使用普通用户登录，认证正确但是授权访问接口失败，会返回如下的未授权结果：</p><p><img src=http://image.tianhui.xin/liveLearn/5/jwt24.png alt=授权访问接口失败></p><h2 id=参考文章>参考文章</h2><ul><li><p><a href=http://blog.restcase.com/restful-api-authentication-basics/>RESTful API Authentication Basics</a></p></li><li><p><a href=https://www.jianshu.com/p/576dbf44b2ae>什么是 JWT – JSON WEB TOKEN</a></p></li><li><p><a href=https://juejin.im/post/59f1b2766fb9a0450e755993>Shiro+JWT+Spring Boot Restful简易教程</a></p></li></ul><h2 id=github源码>GitHub源码</h2><p><a href=https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-jwt>springboot-jwt</a></p></div></div></div></div><div class=container><div class=row><div class="col-lg-10 mx-auto"><div id=gitalk-comments></div><link href=//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css rel=stylesheet><script src=//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script type=application/javascript>const gitalk=new Gitalk({clientID:'6c2478e5c574adadad50',clientSecret:'0aecf2c4c0d2f26b9e277f1a6c45f27b617e4e4a',repo:'comment.tianhui.xin',owner:'homeant',admin:['homeant'],id:'d0af0ea16d1a3b8d226265cc7d53021e',distractionFreeMode:true})
gitalk.render('gitalk-comments')</script></div></div></div></section><footer class="bg-light section pb-0"><div class=container><div class=row><div class="col-md-3 col-sm-6 mb-5"><h3 class=mb-4>个人链接</h3><ul class="list-unstyled footer-list"><li><a href=https://tianhui.xin/about>关于我</a></li><li><a href=//github.com/homeant>GitHub</a></li></ul></div><div class="col-md-3 col-sm-6 mb-5"><h3 class=mb-4>最新文章</h3><ul class="list-unstyled footer-list"><li><a href=https://tianhui.xin/blog/2022/01/02/spring-boot-admin-kubernetes/>Spring Boot Admin On Kubernetes</a></li><li><a href=https://tianhui.xin/blog/2021/09/16/spring-conditional-annotations/>Spring Conditional详解</a></li><li><a href=https://tianhui.xin/blog/2021/04/03/mybatis_data_encryption/>mybatis对数据进行加密</a></li><li><a href=https://tianhui.xin/blog/2020/06/27/spring_cloud_nacos/>跟我学SpringCloud 之 nacos</a></li><li><a href=https://tianhui.xin/blog/2020/06/21/mapstruct/>一见倾心之初遇MapStruct</a></li><li><a href=https://tianhui.xin/blog/2020/05/31/mybatisinterceptorofdatamasking/>Mybatis Interceptor 实现数据脱敏</a></li></ul></div><div class="col-md-3 col-sm-6 mb-5"><h3 class=mb-4>友情链接</h3><ul class="list-unstyled footer-list"><li><a href=http://xujin.org/>玹霖志</a></li><li><a href=https://itachi.xyz/>昨夜梦 今辰你 明日思</a></li></ul></div><div class="col-md-3 col-sm-6 mb-5"><a class="d-block mb-3" href=https://tianhui.xin/><img width=66px class=img-fluid src=https://tianhui.xin/images/logo.png alt=怪咖晨></a><p class=mb-4>有智者立长志，无志者长立志。</p><ul class="list-inline social-icons"><li class=list-inline-item><a href=//github.com/homeant><i class=ti-github></i></a></li></ul></div></div><div class="border-top border-default text-center py-4 mt-4"><small class=content>© 2009-2020 <a href=//tianhui.xin>tianhui.xin</a> 版权所有 ICP证：<a href=http://www.beian.miit.gov.cn>京16046477</a></small>
您是本站第<span id=busuanzi_value_site_uv></span>位访客</div></div></footer><script src=https://tianhui.xin/plugins/jQuery/jquery.min.js></script><script src=https://tianhui.xin/plugins/bootstrap/bootstrap.min.js></script><script src=https://tianhui.xin/plugins/slick/slick.min.js></script><script src=https://tianhui.xin/plugins/love-click.js></script><script src=https://cdn.bootcdn.net/ajax/libs/jquery.sticky/1.0.4/jquery.sticky.min.js></script><script src=https://tianhui.xin/plugins/scrollUp/scrollUp.min.js></script><script src=https://tianhui.xin/plugins/clipboard/clipboard.js></script><script src=https://cdn.jsdelivr.net/npm/algoliasearch@4.5.1/dist/algoliasearch-lite.umd.js integrity="sha256-EXPXz4W6pQgfYY3yTpnDa3OH8/EPn16ciVsPQ/ypsjk=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4.8.3/dist/instantsearch.production.min.js integrity="sha256-LAGhRRdtVoD6RLo2qDQsU2mp+XVSciKRC8XPOBWmofM=" crossorigin=anonymous></script><script src=https://tianhui.xin/js/app.c626aab600fdfdf0c064234dd1dc543b.js></script><script src=https://tianhui.xin/js/post.2ce597fd293e38d5be795230098b93c0.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><div class=scrollUp><i class=ti-angle-up></i></div></body></html>